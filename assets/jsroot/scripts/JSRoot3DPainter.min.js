(function(){if(typeof JSROOT!="object"){var a=new Error("JSROOT is not defined");a.source="JSRoot3DPainter.js";throw a}if(typeof d3!="object"){var a=new Error("This extension requires d3.v3.js");a.source="JSRoot3DPainter.js";throw a}if(typeof JSROOT.Painter!="object"){var a=new Error("JSROOT.Painter is not defined");a.source="JSRoot3DPainter.js";throw a}JSROOT.Painter.add3DInteraction=function(j,e,i,o,m){var d,c,f=false;var h={x:0,y:0},l;var p=function(){var r="tt";var D=3;var u=3;var C=150;var v=10;var s=20;var y=95;var w=0;var z,E,A,B,x;var q=document.all?true:false;return{show:function(F,t){if(z==null){z=document.createElement("div");z.setAttribute("id",r);E=document.createElement("div");E.setAttribute("id",r+"top");A=document.createElement("div");A.setAttribute("id",r+"cont");B=document.createElement("div");B.setAttribute("id",r+"bot");z.appendChild(E);z.appendChild(A);z.appendChild(B);document.body.appendChild(z);z.style.opacity=0;z.style.filter="alpha(opacity=0)";document.onmousemove=this.pos}z.style.display="block";A.innerHTML=F;z.style.width=t?t+"px":"auto";z.style.width="auto";if(!t&&q){E.style.display="none";B.style.display="none";z.style.width=z.offsetWidth;E.style.display="block";B.style.display="block"}x=parseInt(z.offsetHeight)+D;clearInterval(z.timer);z.timer=setInterval(function(){p.fade(1)},s)},pos:function(G){var F=q?event.clientY+document.documentElement.scrollTop:G.pageY;var t=q?event.clientX+document.documentElement.scrollLeft:G.pageX;z.style.top=F+15+"px";z.style.left=(t+u)+"px"},fade:function(G){var t=w;if((t!=y&&G==1)||(t!=0&&G==-1)){var F=v;if(y-t<v&&G==1){F=y-t}else{if(w<v&&G==-1){F=t}}w=t+(F*G);z.style.opacity=w*0.01;z.style.filter="alpha(opacity="+w+")"}else{clearInterval(z.timer);if(G==-1){z.style.display="none"}}},hide:function(){if(z==null){return}clearInterval(z.timer);z.timer=setInterval(function(){p.fade(-1)},s)}}}();var g=100;var b=0;var k=new THREE.Projector();function n(){if(f){if(l){l.material.emissive.setHex(l.currentHex);j.render(e,i)}l=null;if(JSROOT.gStyle.Tooltip){p.hide()}return}var q=new THREE.Vector3(h.x,h.y,1);k.unprojectVector(q,i);var r=new THREE.Raycaster(i.position,q.sub(i.position).normalize());var u=r.intersectObjects(e.children,true);if(u.length>0){var t=null;for(var s=0;s<u.length;++s){if("emissive" in u[s].object.material){t=u[s];break}}if(t&&l!=t.object){if(l){l.material.emissive.setHex(l.currentHex)}l=t.object;l.currentHex=l.material.emissive.getHex();l.material.emissive.setHex(6250335);j.render(e,i);if(JSROOT.gStyle.Tooltip){p.show(l.name.length>0?l.name:l.parent.name,200)}}}else{if(l){l.material.emissive.setHex(l.currentHex);j.render(e,i)}l=null;if(JSROOT.gStyle.Tooltip){p.hide()}}}$(j.domElement).on("touchstart mousedown",function(q){if(JSROOT.gStyle.Tooltip){p.hide()}q.preventDefault();var r=q;if("changedTouches" in q){r=q.changedTouches[0]}else{if("touches" in q){r=q.touches[0]}else{if("originalEvent" in q){if("changedTouches" in q.originalEvent){r=q.originalEvent.changedTouches[0]}else{if("touches" in q.originalEvent){r=q.originalEvent.touches[0]}}}}}d=r.pageX;c=r.pageY;f=true});$(j.domElement).on("touchmove mousemove",function(u){if(f){var v=u;if("changedTouches" in u){v=u.changedTouches[0]}else{if("touches" in u){v=u.touches[0]}else{if("originalEvent" in u){if("changedTouches" in u.originalEvent){v=u.originalEvent.changedTouches[0]}else{if("touches" in u.originalEvent){v=u.originalEvent.touches[0]}}}}}var t=v.pageX-d;var s=v.pageY-c;if((s>0&&o.rotation.x<Math.PI*3/4)||(s<0&&o.rotation.x>-Math.PI/4)){o.rotation.x+=s*0.02}o.rotation.y+=t*0.02;j.render(e,i);d=v.pageX;c=v.pageY}else{u.preventDefault();var r="offsetX" in u.originalEvent?u.originalEvent.offsetX:u.originalEvent.layerX;var q="offsetY" in u.originalEvent?u.originalEvent.offsetY:u.originalEvent.layerY;h.x=(r/j.domElement.width)*2-1;h.y=-(q/j.domElement.height)*2+1;n()}});$(j.domElement).on("touchend mouseup",function(q){f=false});$(j.domElement).on("mousewheel",function(q,r){q.preventDefault();i.position.z+=r*20;j.render(e,i)});$(j.domElement).on("contextmenu",function(q){q.preventDefault();if(JSROOT.gStyle.Tooltip){p.hide()}JSROOT.Painter.createMenu(function(r){if(m){r.add("header:"+m.histo.fName)}r.add(JSROOT.gStyle.Tooltip?"Disable tooltip":"Enable tooltip",function(){JSROOT.gStyle.Tooltip=!JSROOT.gStyle.Tooltip;p.hide()});if(m){r.add("Switch to 2D",function(){$(m.svg_pad().node()).show().parent().find(j.domElement).remove();p.hide();m.Draw2D()})}r.add("Close");r.show(q.originalEvent)})})};JSROOT.Painter.real_drawHistogram2D=function(l){var aa=l.pad_width(),ai=l.pad_height(),n=100;var q=l.xmin,Y=l.xmax;if(l.zoom_xmin!=l.zoom_xmax){q=l.zoom_xmin;Y=l.zoom_xmax}var R=l.ymin,f=l.ymax;if(l.zoom_ymin!=l.zoom_ymax){R=l.zoom_ymin;f=l.zoom_ymax}var ag,E,ae,D,ac,B;if(l.options.Logx){ag=d3.scale.log().domain([q,Y]).range([-n,n]);E=d3.scale.log().domain([-n,n]).range([q,Y])}else{ag=d3.scale.linear().domain([q,Y]).range([-n,n]);E=d3.scale.linear().domain([-n,n]).range([q,Y])}if(l.options.Logy){ae=d3.scale.log().domain([R,f]).range([-n,n]);D=d3.scale.log().domain([n,-n]).range([R,f])}else{ae=d3.scale.linear().domain([R,f]).range([-n,n]);D=d3.scale.linear().domain([n,-n]).range([R,f])}if(l.options.Logz){ac=d3.scale.log().domain([l.gminbin,Math.ceil(l.gmaxbin/100)*105]).range([0,n*2]);B=d3.scale.log().domain([0,n*2]).range([l.gminbin,Math.ceil(l.gmaxbin/100)*105])}else{ac=d3.scale.linear().domain([l.gminbin,Math.ceil(l.gmaxbin/100)*105]).range([0,n*2]);B=d3.scale.linear().domain([0,n*2]).range([l.gminbin,Math.ceil(l.gmaxbin/100)*105])}var M=(n*2/l.nbinsx)/l.gmaxbin;var L=(n*2/l.nbinsy)/l.gmaxbin;var V=(l.options.Color>0);var o=d3.rgb(JSROOT.Painter.root_colors[l.histo.fFillColor]);var K=l.CreateDrawBins(100,100,2,(JSROOT.gStyle.Tooltip?1:0));var N=new THREE.Scene();var A=new THREE.Object3D();A.rotation.x=30*Math.PI/180;A.rotation.y=30*Math.PI/180;N.add(A);var b=new THREE.MeshBasicMaterial({color:0,wireframe:true,wireframeLinewidth:0.5,side:THREE.DoubleSide});var c=new THREE.Mesh(new THREE.BoxGeometry(n*2,n*2,n*2),b);var t=new THREE.BoxHelper(c);t.material.color.set(0);var m=new THREE.Object3D();m.add(t);m.position.y=n;A.add(m);var z=new THREE.MeshBasicMaterial({color:0});var C=new THREE.Geometry();var P,aj,J=3,G,H=Math.sin(45);var F,O;var y=ag.ticks(8);var X=ag.ticks(50);for(var ah=-n,af=0,ad=0;ah<n;++ah){var ab=(E(ah)<=y[af]&&E(ah+1)>y[af])?true:false;var S=(E(ah)<=X[ad]&&E(ah+1)>X[ad])?true:false;G=(ab?J+2:J)*H;if(ab){F=new THREE.TextGeometry(y[af],{size:7,height:0,curveSegments:10});++af;F.computeBoundingBox();var d=0.5*(F.boundingBox.max.x-F.boundingBox.min.x);O=new THREE.Mesh(F,z);O.position.set(ah-d,-13,n+G);A.add(O);O=new THREE.Mesh(F,z);O.position.set(ah+d,-13,-n-G);O.rotation.y=Math.PI;A.add(O)}if(ab||S){++ad;C.vertices.push(new THREE.Vector3(ah,0,n));C.vertices.push(new THREE.Vector3(ah,-G,n+G));C.vertices.push(new THREE.Vector3(ah,0,-n));C.vertices.push(new THREE.Vector3(ah,-G,-n-G))}}var x=ae.ticks(8);var W=ae.ticks(50);for(var ah=n,af=0,ad=0;ah>-n;--ah){var ab=(D(ah)<=x[af]&&D(ah-1)>x[af])?true:false;var S=(D(ah)<=W[ad]&&D(ah-1)>W[ad])?true:false;G=(ab?J+2:J)*H;if(ab){F=new THREE.TextGeometry(x[af],{size:7,height:0,curveSegments:10});++af;F.computeBoundingBox();var d=0.5*(F.boundingBox.max.x-F.boundingBox.min.x);O=new THREE.Mesh(F,z);O.position.set(n+G,-13,ah+d);O.rotation.y=Math.PI/2;A.add(O);O=new THREE.Mesh(F,z);O.position.set(-n-G,-13,ah-d);O.rotation.y=-Math.PI/2;A.add(O)}if(ab||S){++ad;C.vertices.push(new THREE.Vector3(n,0,ah));C.vertices.push(new THREE.Vector3(n+G,-G,ah));C.vertices.push(new THREE.Vector3(-n,0,ah));C.vertices.push(new THREE.Vector3(-n-G,-G,ah))}}var v=ac.ticks(8);var U=ac.ticks(50);for(var ah=0,af=0,ad=0;ah<(n*2);++ah){var ab=(B(ah)<=v[af]&&B(ah+1)>v[af])?true:false;var S=(B(ah)<=U[ad]&&B(ah+1)>U[ad])?true:false;G=(ab?J+2:J)*H;if(ab){F=new THREE.TextGeometry(v[af],{size:7,height:0,curveSegments:10});++af;F.computeBoundingBox();var Z=0.8*(F.boundingBox.max.x-F.boundingBox.min.x);O=new THREE.Mesh(F,z);O.position.set(n+Z+5,ah-2.5,n+Z+5);O.rotation.y=Math.PI*3/4;A.add(O);O=new THREE.Mesh(F,z);O.position.set(n+Z+5,ah-2.5,-n-Z-5);O.rotation.y=-Math.PI*3/4;A.add(O);O=new THREE.Mesh(F,z);O.position.set(-n-Z-5,ah-2.5,n+Z+5);O.rotation.y=Math.PI/4;A.add(O);O=new THREE.Mesh(F,z);O.position.set(-n-Z-5,ah-2.5,-n-Z-5);O.rotation.y=-Math.PI/4;A.add(O)}if(ab||S){++ad;C.vertices.push(new THREE.Vector3(n,ah,n));C.vertices.push(new THREE.Vector3(n+G,ah,n+G));C.vertices.push(new THREE.Vector3(n,ah,-n));C.vertices.push(new THREE.Vector3(n+G,ah,-n-G));C.vertices.push(new THREE.Vector3(-n,ah,n));C.vertices.push(new THREE.Vector3(-n-G,ah,n+G));C.vertices.push(new THREE.Vector3(-n,ah,-n));C.vertices.push(new THREE.Vector3(-n-G,ah,-n-G))}}var u=new THREE.LineBasicMaterial({color:0});var p=new THREE.Line(C,u);p.type=THREE.LinePieces;A.add(p);var s=new THREE.Color(14540253);s.setRGB(o.r/255,o.g/255,o.b/255);var r,g,ak;for(var ah=0;ah<K.length;++ah){ak=K[ah];g=ac(ak.z);r=THREE.SceneUtils.createMultiMaterialObject(new THREE.BoxGeometry(2*n/l.nbinsx,g,2*n/l.nbinsy),[new THREE.MeshLambertMaterial({color:s.getHex(),shading:THREE.NoShading}),b]);r.position.x=ag(ak.x);r.position.y=g/2;r.position.z=-(ae(ak.y));if(JSROOT.gStyle.Tooltip){r.name=ak.tip}A.add(r)}delete K;K=null;var e=new THREE.PointLight(13619151);e.position.set(0,50,250);N.add(e);var I=new THREE.PerspectiveCamera(45,aa/ai,1,1000);I.position.set(0,n/2,500);I.lookat=c;var Q={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{return !!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(h){return false}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob};var T=Q.webgl?new THREE.WebGLRenderer({antialias:true}):new THREE.CanvasRenderer({antialias:true});T.setClearColor(16777215,1);T.setSize(aa,ai);$(l.svg_pad().node()).hide().parent().append(T.domElement);T.render(N,I);JSROOT.Painter.add3DInteraction(T,N,I,A,l)};JSROOT.Painter.real_drawHistogram3D=function(ae,f,ak){var aC=false,aB=false,aA=false,I=false,G=false,E=false;var ac=new JSROOT.TObjectPainter();ac.SetDivId(ae,-1);var q=ac.root_pad();var g;if(!ac.svg_pad().empty()){g=$(ac.svg_pad().node()).hide().parent()}else{g=$("#"+ae)}var ak=f.fOption.toLowerCase();if(q){aC=q.fLogx;aB=q.fLogy;aA=q.fLogz;I=q.fGridx;G=q.fGridy;E=q.fGridz}var ad=JSROOT.Painter.root_colors[f.fFillColor];var az=JSROOT.Painter.root_colors[f.fLineColor];if(f.fFillColor==0){ad="#4572A7"}if(f.fLineColor==0){az="#4572A7"}var ai=f.fXaxis["fNbins"];var ah=f.fYaxis["fNbins"];var ag=f.fZaxis["fNbins"];var J=(f.fXaxis["fXmax"]-f.fXaxis["fXmin"])/f.fXaxis["fNbins"];var H=(f.fYaxis["fXmax"]-f.fYaxis["fXmin"])/f.fYaxis["fNbins"];var F=(f.fZaxis["fXmax"]-f.fZaxis["fXmin"])/f.fZaxis["fNbins"];var o=-1e+32,D=1e+32;o=d3.max(f.fArray);D=d3.min(f.fArray);var ao=new Array();for(var Q=0;Q<=ai+2;++Q){for(var P=0;P<ah+2;++P){for(var N=0;N<ag+2;++N){var K=f.getBinContent(Q,P,N);if(K>D){var c={x:f.fXaxis["fXmin"]+(Q*J),y:f.fYaxis["fXmin"]+(P*H),z:f.fZaxis["fXmin"]+(N*F),n:K};ao.push(c)}}}}var A=g.width(),S=g.height(),B=100;if(S<10){g.height(0.66*A);S=g.height()}if(aC){var X=d3.scale.log().domain([f.fXaxis["fXmin"],f.fXaxis["fXmax"]]).range([-B,B]);var at=d3.scale.log().domain([-B,B]).range([f.fXaxis["fXmin"],f.fXaxis["fXmax"]])}else{var X=d3.scale.linear().domain([f.fXaxis["fXmin"],f.fXaxis["fXmax"]]).range([-B,B]);var at=d3.scale.linear().domain([-B,B]).range([f.fXaxis["fXmin"],f.fXaxis["fXmax"]])}if(aB){var W=d3.scale.log().domain([f.fYaxis["fXmin"],f.fYaxis["fXmax"]]).range([-B,B]);var ar=d3.scale.log().domain([B,-B]).range([f.fYaxis["fXmin"],f.fYaxis["fXmax"]])}else{var W=d3.scale.linear().domain([f.fYaxis["fXmin"],f.fYaxis["fXmax"]]).range([-B,B]);var ar=d3.scale.linear().domain([B,-B]).range([f.fYaxis["fXmin"],f.fYaxis["fXmax"]])}if(aA){var V=d3.scale.log().domain([f.fZaxis["fXmin"],f.fZaxis["fXmax"]]).range([-B,B]);var aq=d3.scale.log().domain([-B,B]).range([f.fZaxis["fXmin"],f.fZaxis["fXmax"]])}else{var V=d3.scale.linear().domain([f.fZaxis["fXmin"],f.fZaxis["fXmax"]]).range([-B,B]);var aq=d3.scale.linear().domain([-B,B]).range([f.fZaxis["fXmin"],f.fZaxis["fXmax"]])}var z=new THREE.Scene();var L=new THREE.Object3D();L.rotation.x=30*Math.PI/180;L.rotation.y=30*Math.PI/180;z.add(L);var Y=new THREE.MeshBasicMaterial({color:0,wireframe:true,wireframeLinewidth:0.5,side:THREE.DoubleSide});var T=new THREE.Mesh(new THREE.BoxGeometry(B*2,B*2,B*2),Y);var U=new THREE.BoxHelper(T);U.material.color.set(0);L.add(U);var R=new THREE.MeshBasicMaterial({color:0});var aj=new THREE.Geometry();var ay,ab,af=3,Z,av=Math.sin(45);var al,an;var O=X.ticks(5);var b=X.ticks(25);for(var Q=-B,P=0,N=0;Q<=B;++Q){var s=(at(Q)<=O[P]&&at(Q+1)>O[P])?true:false;var C=(at(Q)<=b[N]&&at(Q+1)>b[N])?true:false;Z=(s?af+2:af)*av;if(s){al=new THREE.TextGeometry(O[P],{size:7,height:0,curveSegments:10});++P;al.computeBoundingBox();var e=0.5*(al.boundingBox.max.x-al.boundingBox.min.x);an=new THREE.Mesh(al,R);an.position.set(Q-e,-B-13,B+Z);L.add(an);an=new THREE.Mesh(al,R);an.position.set(Q+e,-B-13,-B-Z);an.rotation.y=Math.PI;L.add(an)}if(s||C){++N;aj.vertices.push(new THREE.Vector3(Q,-B,B));aj.vertices.push(new THREE.Vector3(Q,-B-Z,B+Z));aj.vertices.push(new THREE.Vector3(Q,-B,-B));aj.vertices.push(new THREE.Vector3(Q,-B-Z,-B-Z))}}var t=W.ticks(5);var aw=W.ticks(25);for(var Q=B,P=0,N=0;Q>-B;--Q){var s=(ar(Q)<=t[P]&&ar(Q-1)>t[P])?true:false;var C=(ar(Q)<=aw[N]&&ar(Q-1)>aw[N])?true:false;Z=(s?af+2:af)*av;if(s){al=new THREE.TextGeometry(t[P],{size:7,height:0,curveSegments:10});++P;al.computeBoundingBox();var e=0.5*(al.boundingBox.max.x-al.boundingBox.min.x);an=new THREE.Mesh(al,R);an.position.set(B+Z,-B-13,Q+e);an.rotation.y=Math.PI/2;L.add(an);an=new THREE.Mesh(al,R);an.position.set(-B-Z,-B-13,Q-e);an.rotation.y=-Math.PI/2;L.add(an)}if(s||C){++N;aj.vertices.push(new THREE.Vector3(B,-B,Q));aj.vertices.push(new THREE.Vector3(B+Z,-B-Z,Q));aj.vertices.push(new THREE.Vector3(-B,-B,Q));aj.vertices.push(new THREE.Vector3(-B-Z,-B-Z,Q))}}var p=V.ticks(5);var am=V.ticks(25);for(var Q=-B,P=0,N=0;Q<=B;++Q){var s=(aq(Q)<=p[P]&&aq(Q+1)>p[P])?true:false;var C=(aq(Q)<=am[N]&&aq(Q+1)>am[N])?true:false;Z=(s?af+2:af)*av;if(s){al=new THREE.TextGeometry(p[P],{size:7,height:0,curveSegments:10});++P;al.computeBoundingBox();var n=0.6*(al.boundingBox.max.x-al.boundingBox.min.x);an=new THREE.Mesh(al,R);an.position.set(B+n+7,Q-2.5,B+n+7);an.rotation.y=Math.PI*3/4;L.add(an);an=new THREE.Mesh(al,R);an.position.set(B+n+7,Q-2.5,-B-n-7);an.rotation.y=-Math.PI*3/4;L.add(an);an=new THREE.Mesh(al,R);an.position.set(-B-n-7,Q-2.5,B+n+7);an.rotation.y=Math.PI/4;L.add(an);an=new THREE.Mesh(al,R);an.position.set(-B-n-7,Q-2.5,-B-n-7);an.rotation.y=-Math.PI/4;L.add(an)}if(s||C){++N;aj.vertices.push(new THREE.Vector3(B,Q,B));aj.vertices.push(new THREE.Vector3(B+Z,Q,B+Z));aj.vertices.push(new THREE.Vector3(B,Q,-B));aj.vertices.push(new THREE.Vector3(B+Z,Q,-B-Z));aj.vertices.push(new THREE.Vector3(-B,Q,B));aj.vertices.push(new THREE.Vector3(-B-Z,Q,B+Z));aj.vertices.push(new THREE.Vector3(-B,Q,-B));aj.vertices.push(new THREE.Vector3(-B-Z,Q,-B-Z))}}var au=new THREE.LineBasicMaterial({color:0});var l=new THREE.Line(aj,au);l.type=THREE.LinePieces;L.add(l);var y=(B*2/f.fXaxis["fNbins"])/o;var v=(B*2/f.fYaxis["fNbins"])/o;var u=(B*2/f.fZaxis["fNbins"])/o;var ax=(ak.indexOf("colz")!=-1||ak.indexOf("col")!=-1);var m=d3.rgb(JSROOT.Painter.root_colors[f.fFillColor]);var ad=new THREE.Color(14540253);ad.setRGB(m.r/255,m.g/255,m.b/255);var r,x;for(var Q=0;Q<ao.length;++Q){x=(ax?o:ao[Q].n);if(ak.indexOf("box1")!=-1){r=new THREE.Mesh(new THREE.SphereGeometry(0.5*x*y),new THREE.MeshPhongMaterial({color:ad.getHex(),specular:12566463}))}else{r=THREE.SceneUtils.createMultiMaterialObject(new THREE.BoxGeometry(x*y,x*u,x*v),[new THREE.MeshLambertMaterial({color:ad.getHex(),shading:THREE.NoShading}),Y])}r.position.x=X(ao[Q].x-(J/2));r.position.y=V(ao[Q].z-(F/2));r.position.z=-(W(ao[Q].y-(H/2)));r.name="x: ["+ao[Q].x.toPrecision(4)+", "+(ao[Q].x+J).toPrecision(4)+"]<br/>y: ["+ao[Q].y.toPrecision(4)+", "+(ao[Q].y+H).toPrecision(4)+"]<br/>z: ["+ao[Q].z.toPrecision(4)+", "+(ao[Q].z+F).toPrecision(4)+"]<br/>entries: "+ao[Q].n.toFixed();L.add(r)}var M=new THREE.PointLight(13619151);M.position.set(0,50,250);z.add(M);var ap=new THREE.PerspectiveCamera(45,A/S,1,1000);ap.position.set(0,0,500);ap.lookat=T;var d={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{return !!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(h){return false}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob};var aa=d.webgl?new THREE.WebGLRenderer({antialias:true}):new THREE.CanvasRenderer({antialias:true});aa.setClearColor(16777215,1);aa.setSize(A,S);g.append(aa.domElement);aa.render(z,ap);JSROOT.Painter.add3DInteraction(aa,z,ap,L,null)}})();