(function(){if(typeof JSROOT!="object"){var a=new Error("JSROOT is not defined");a.source="JSRootPainter.js";throw a}if(typeof d3!="object"){var a=new Error("This extension requires d3.v3.js");a.source="JSRootPainter.js";throw a}if(typeof JSROOT.Painter=="object"){var a=new Error("JSROOT.Painter already defined");a.source="JSRootPainter.js";throw a}JSROOT.fDrawFunc=new Array;JSROOT.addDrawFunc=function(b,c,d){if((arguments.length==1)&&(typeof arguments[0]=="object")){JSROOT.fDrawFunc.push(arguments[0])}else{JSROOT.fDrawFunc.push({name:b,func:c,opt:d})}};JSROOT.gStyle={Tooltip:true,ContextMenu:true,Zooming:true,MoveResize:true,DragAndDrop:true,OptimizeDraw:1,DefaultCol:1,AutoStat:true,OptStat:1111,StatNDC:{fX1NDC:0.78,fY1NDC:0.75,fX2NDC:0.98,fY2NDC:0.91},StatText:{fTextAngle:0,fTextSize:9,fTextAlign:12,fTextColor:1,fTextFont:42},StatFill:{fFillColor:0,fFillStyle:1001},TimeOffset:788918400000,StatFormat:function(b){return(Math.abs(b)<100000)?b.toFixed(5):b.toExponential(7)},StatEntriesFormat:function(b){return(Math.abs(b)<10000000)?b.toFixed(0):b.toExponential(7)},MathJax:0};JSROOT.Painter={};JSROOT.Painter.createMenu=function(b,c){document.body.style.cursor="wait";JSROOT.AssertPrerequisites("jq2d",function(){document.body.style.cursor="auto";JSROOT.Painter.createMenu(b,c)})};JSROOT.Painter.closeMenu=function(c){if(!c){c="root_ctx_menu"}var b=document.getElementById(c);if(b){b.parentNode.removeChild(b)}};JSROOT.Painter.readStyleFromURL=function(d){var e=JSROOT.GetUrlOption("optimize",d);if(e==""){JSROOT.gStyle.OptimizeDraw=2}else{if(e!=null){JSROOT.gStyle.OptimizeDraw=parseInt(e);if(JSROOT.gStyle.OptimizeDraw==NaN){JSROOT.gStyle.OptimizeDraw=2}}}var b=JSROOT.GetUrlOption("interactive",d);if((b=="")||(b=="1")){b="11111"}else{if(b=="0"){b="00000"}}if((b!=null)&&(b.length==5)){JSROOT.gStyle.Tooltip=(b.charAt(0)!="0");JSROOT.gStyle.ContextMenu=(b.charAt(1)!="0");JSROOT.gStyle.Zooming=(b.charAt(2)!="0");JSROOT.gStyle.MoveResize=(b.charAt(3)!="0");JSROOT.gStyle.DragAndDrop=(b.charAt(4)!="0")}var c=JSROOT.GetUrlOption("col",d);if(c!=null){c=parseInt(c);if((c!=NaN)&&(c>0)&&(c<4)){JSROOT.gStyle.DefaultCol=c}}if(JSROOT.GetUrlOption("mathjax",d)!=null){JSROOT.MathJax=1}};JSROOT.Painter.Coord={kCARTESIAN:1,kPOLAR:2,kCYLINDRICAL:3,kSPHERICAL:4,kRAPIDITY:5};JSROOT.Painter.root_colors=function(){var p=new Array("white","black","red","green","blue","rgb(255,255,0)","rgb(255,0,255)","rgb(0,255,255)","rgb(89, 211,84)","rgb(89,84,216)","rgb(254,254,254)","rgb(191,181,173)","rgb(76,76,76)","rgb(102,102,102)","rgb(127,127,127)","rgb(153,153,153)","rgb(178,178,178)","rgb(204,204,204)","rgb(229,229,229)","rgb(242,242,242)","rgb(204,198,170)","rgb(204,198,170)","rgb(193,191,168)","rgb(186,181,163)","rgb(178,165,150)","rgb(183,163,155)","rgb(173,153,140)","rgb(155,142,130)","rgb(135,102,86)","rgb(175,206,198)","rgb(132,193,163)","rgb(137,168,160)","rgb(130,158,140)","rgb(173,188,198)","rgb(122,142,153)","rgb(117,137,145)","rgb(104,130,150)","rgb(109,122,132)","rgb(124,153,209)","rgb(127,127,155)","rgb(170,165,191)","rgb(211,206,135)","rgb(221,186,135)","rgb(188,158,130)","rgb(198,153,124)","rgb(191,130,119)","rgb(206,94,96)","rgb(170,142,147)","rgb(165,119,122)","rgb(147,104,112)","rgb(211,89,84)");var b=[632,416,600,400,616,432];var v=[800,820,840,860,880,900];var n=[255,204,204,255,153,153,204,153,153,255,102,102,204,102,102,153,102,102,255,51,51,204,51,51,153,51,51,102,51,51,255,0,0,204,0,0,153,0,0,102,0,0,51,0,0];var m=[204,255,204,153,255,153,153,204,153,102,255,102,102,204,102,102,153,102,51,255,51,51,204,51,51,153,51,51,102,51,0,255,0,0,204,0,0,153,0,0,102,0,0,51,0];var l=[204,204,255,153,153,255,153,153,204,102,102,255,102,102,204,102,102,153,51,51,255,51,51,204,51,51,153,51,51,102,0,0,255,0,0,204,0,0,153,0,0,102,0,0,51];var k=[255,255,204,255,255,153,204,204,153,255,255,102,204,204,102,153,153,102,255,255,51,204,204,51,153,153,51,102,102,51,255,255,0,204,204,0,153,153,0,102,102,0,51,51,0];var h=[255,204,255,255,153,255,204,153,204,255,102,255,204,102,204,153,102,153,255,51,255,204,51,204,153,51,153,102,51,102,255,0,255,204,0,204,153,0,153,102,0,102,51,0,51];var f=[204,255,255,153,255,255,153,204,204,102,255,255,102,204,204,102,153,153,51,255,255,51,204,204,51,153,153,51,102,102,0,255,255,0,204,204,0,153,153,0,102,102,0,51,51];var w=new Array(n,m,l,k,h,f);var e=[255,204,153,204,153,102,153,102,51,153,102,0,204,153,51,255,204,102,255,153,0,255,204,51,204,153,0,255,204,0,255,153,51,204,102,0,102,51,0,153,51,0,204,102,51,255,153,102,255,102,0,255,102,51,204,51,0,255,51,0];var d=[153,255,51,102,204,0,51,102,0,51,153,0,102,204,51,153,255,102,102,255,0,102,255,51,51,204,0,51,255,0,204,255,153,153,204,102,102,153,51,102,153,0,153,204,51,204,255,102,153,255,0,204,255,51,153,204,0,204,255,0];var c=[153,255,204,102,204,153,51,153,102,0,153,102,51,204,153,102,255,204,0,255,102,51,255,204,0,204,153,0,255,204,51,255,153,0,204,102,0,102,51,0,153,51,51,204,102,102,255,153,0,255,153,51,255,102,0,204,51,0,255,51];var u=[153,204,255,102,153,204,51,102,153,0,51,153,51,102,204,102,153,255,0,102,255,51,102,255,0,51,204,0,51,255,51,153,255,0,102,204,0,51,102,0,102,153,51,153,204,102,204,255,0,153,255,51,204,255,0,153,204,0,204,255];var t=[204,153,255,153,102,204,102,51,153,102,0,153,153,51,204,204,102,255,153,0,255,204,51,255,153,0,204,204,0,255,153,51,255,102,0,204,51,0,102,51,0,153,102,51,204,153,102,255,102,0,255,102,51,255,51,0,204,51,0,255];var s=[255,51,153,204,0,102,102,0,51,153,0,51,204,51,102,255,102,153,255,0,102,255,51,102,204,0,51,255,0,51,255,153,204,204,102,153,153,51,102,153,0,102,204,51,153,255,102,204,255,0,153,204,0,153,255,51,204,255,0,153];var g=new Array(e,d,c,u,t,s);for(var r=0;r<6;r++){for(var q=0;q<15;q++){var o=b[r]+q-10;p[o]="rgb("+w[r][3*q]+","+w[r][3*q+1]+","+w[r][3*q+2]+")";o=v[r]+q-9;p[o]="rgb("+g[r][3*q]+","+g[r][3*q+1]+","+g[r][3*q+2]+")"}}return p}();JSROOT.Painter.adoptRootColors=function(e){if(!e||!e.arr){return}for(var f in e.arr){var d=e.arr[f];if((d==null)||(d._typename!="TColor")){continue}var c=d.fNumber;if((c<0)||(c>4096)){continue}var b="rgb("+(d.fRed*255).toFixed(0)+","+(d.fGreen*255).toFixed(0)+","+(d.fBlue*255).toFixed(0)+")";if(b=="rgb(255,255,255)"){b="white"}while(c>JSROOT.Painter.root_colors.length){JSROOT.Painter.root_colors.push(b)}if(JSROOT.Painter.root_colors[c]!=b){JSROOT.Painter.root_colors[c]=b}}};JSROOT.Painter.root_line_styles=new Array("","","3, 3","1, 2","3, 4, 1, 4","5, 3, 1, 3","5, 3, 1, 3, 1, 3, 1, 3","5, 5","5, 3, 1, 3, 1, 3","20, 5","20, 10, 1, 10","1, 2");JSROOT.Painter.root_markers=new Array("fcircle","fcircle","fcross","dcross","ocircle","gcross","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fcircle","fsquare","ftriangle-up","ftriangle-down","ocircle","osquare","otriangle-up","odiamond","ocross","fstar","ostar","dcross","otriangle-down","fdiamond","fcross");JSROOT.Painter.createAttMarker=function(g){var c=JSROOT.Painter.root_markers[g.fMarkerStyle];var f={shape:0,toFill:true,toRotate:false};if(typeof(c)!="undefined"){switch(c.charAt(0)){case"d":f.shape=7;break;case"o":f.toFill=false;break;case"g":f.toRotate=true;break}switch(c.substr(1)){case"circle":f.shape=0;break;case"cross":f.shape=1;break;case"diamond":f.shape=2;break;case"square":f.shape=3;break;case"triangle-up":f.shape=4;break;case"triangle-down":f.shape=5;break;case"star":f.shape=6;break}}var h=g.fMarkerSize;var e=(f.shape==0)?32:64;if(g.fMarkerStyle==1){e=1}var d=JSROOT.Painter.root_colors[g.fMarkerColor];var b={stroke:d,fill:d,marker:""};if(!f.toFill){b.fill="none"}if(f.shape==6){b.marker="M "+(-4*h)+" "+(-1*h)+" L "+4*h+" "+(-1*h)+" L "+(-2.4*h)+" "+4*h+" L 0 "+(-4*h)+" L "+2.8*h+" "+4*h+" z"}else{if(f.shape==7){b.marker="M "+(-4*h)+" "+(-4*h)+" L "+4*h+" "+4*h+" M 0 "+(-4*h)+" 0 "+4*h+" M "+4*h+" "+(-4*h)+" L "+(-4*h)+" "+4*h+" M "+(-4*h)+" 0 L "+4*h+" 0"}else{b.marker=d3.svg.symbol().type(d3.svg.symbolTypes[f.shape]).size(h*e)}}b.SetMarker=function(i){i.style("fill",this.fill).style("stroke",this.stroke).attr("d",this.marker)};b.func=b.SetMarker.bind(b);return b};JSROOT.Painter.createAttLine=function(g,e){var d=0,b=0,f=0;if(g=="black"){d=1;b=1}else{if(g=="none"){b=0}else{if(typeof g=="object"){if("fLineColor" in g){d=g.fLineColor}if("fLineWidth" in g){b=g.fLineWidth}if("fLineStyle" in g){f=g.fLineStyle}}}}if(e!=null){b=e}var c={color:JSROOT.Painter.root_colors[d],width:b,dash:JSROOT.Painter.root_line_styles[f]};if((b==0)||(d==0)){c.color="none"}c.SetLine=function(h){h.style("stroke",this.color);if(this.color!="none"){h.style("stroke-width",this.width);h.style("stroke-dasharray",this.dash)}};c.func=c.SetLine.bind(c);return c};JSROOT.Painter.clearCuts=function(b){var e=b.indexOf("[");var d=b.indexOf("]");if((e>=0)&&(d>=0)&&(e<d)){for(var c=e;c<=d;c++){b[c]=" "}}return b};JSROOT.Painter.root_fonts=new Array("Arial","Times New Roman","bold Times New Roman","bold italic Times New Roman","Arial","oblique Arial","bold Arial","bold oblique Arial","Courier New","oblique Courier New","bold Courier New","bold oblique Courier New","Symbol","Times New Roman","Wingdings","Symbol");JSROOT.Painter.getFontDetails=function(e,c){var d=JSROOT.Painter.root_fonts[Math.floor(e/10)];var b={name:"Arial",size:11,weight:null,style:null};if(c!=null){b.size=Math.round(c)}if(d==null){d=""}if(d.indexOf("bold")!=-1){b.weight="bold";d=d.substring(5,d.length)}if(d.charAt(0)=="i"){b.style="italic";d=d.substring(7,d.length)}else{if(d.charAt(0)=="o"){b.style="oblique";d=d.substring(8,d.length)}}if(name=="Symbol"){b.weight=null;b.style=null}b.name=d;b.SetFont=function(f){f.attr("font-family",this.name).attr("font-size",this.size).attr("xml:space","preserve");if(this.weight!=null){f.attr("font-weight",this.weight)}if(this.style!=null){f.attr("font-style",this.style)}};b.asStyle=function(f){return((f!=null)?f:this.size)+"px "+this.name};b.stringWidth=function(h,g){var i=h.append("svg:text").attr("class","temp_text").attr("xml:space","preserve").style("opacity",0).text(g);this.SetFont(i);var f=i.node().getBBox().width;i.remove();return f};b.func=b.SetFont.bind(b);return b};JSROOT.Painter.padtoX=function(c,b){if(c.fLogx&&b<50){return Math.exp(2.302585092994*b)}return b};JSROOT.Painter.ytoPad=function(c,b){if(b.fLogy){if(c>0){c=JSROOT.Math.log10(c)}else{c=b.fUymin}}return c};JSROOT.Painter.HLStoRGB=function(j,i,n){var c,k,m;if(n<1e-300){c=k=m=i}else{function f(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var d=i<0.5?i*(1+n):i+n-i*n;var e=2*i-d;c=f(e,d,j+1/3);k=f(e,d,j);m=f(e,d,j-1/3)}return"rgb("+Math.round(c*255)+","+Math.round(k*255)+","+Math.round(m*255)+")"};JSROOT.Painter.chooseTimeFormat=function(c,d){if(d<1){d=1}var e=c/d;var b=0;if(e>=0.5){b=1;if(e>=30){e/=60;b=2;if(e>=30){e/=60;b=3;if(e>=12){e/=24;b=4;if(e>=15.218425){e/=30.43685;b=5;if(e>=6){e/=12;b=6;if(e>=2){e/=12;b=7}}}}}}}switch(b){case 0:return"%S";case 1:return"%Mm%S";case 2:return"%Hh%M";case 3:return"%d-%Hh";case 4:return"%d/%m";case 5:return"%d/%m/%y";case 6:return"%d/%m/%y";case 7:return"%m/%y"}return"%Y"};JSROOT.Painter.getTimeFormat=function(b){var d=b.fTimeFormat;var c=d.indexOf("%F");if(c>=0){return d.substr(0,c)}return d};JSROOT.Painter.getTimeOffset=function(f){var j=f.fTimeFormat;var n=j.indexOf("%F");if(n>=0){var c=j.length;var e=j.substr(n+2,c);for(var k=0;k<3;++k){e=e.replace("-","/")}if((e=="0")||(e=="")){return 0}var l=new Date(e);var m=l.getTime();var b=e.indexOf("s");if(b>=0){var d=e.length;var h=e.substr(b+1,d);var g=parseFloat(h);m+=g}return m}return JSROOT.gStyle.TimeOffset};JSROOT.Painter.formatExp=function(k){var i=k;if(parseFloat(i)==1){return"1"}if(parseFloat(i)==10){return"10"}var i=i.replace("e+","x10@");var i=i.replace("e-","x10@-");var d=i.substring(0,i.indexOf("@"));var f=i.substr(i.indexOf("@"));d=d.replace("@","");f=f.replace("@","");var l,m=f.length;for(var b=0;b<m;++b){var l,h=f.charAt(b);if(h=="+"){l="\u207A"}else{if(h=="-"){l="\u207B"}else{var g=parseInt(h);if(g==1){l=String.fromCharCode(185)}else{if(g>1&&g<4){l=String.fromCharCode(176+g)}else{l=String.fromCharCode(8304+g)}}}}f=f.replace(h,l)}d=d.replace("1x","");return d+f};JSROOT.Painter.translateExp=function(l){var g=l.match(/\^{[0-9]*}/gi);if(g!=null){var b="";for(var f=0;f<g.length;++f){b=g[f].replace(" ","");b=b.replace("^{","");b=b.replace("}","");var n=b.length;for(var d=0;d<n;++d){var k=b.charAt(d);var m,h=parseInt(k);if(h==1){m=String.fromCharCode(185)}else{if(h>1&&h<4){m=String.fromCharCode(176+h)}else{m=String.fromCharCode(8304+h)}}b=b.replace(k,m)}l=l.replace(g[f],b)}}return l};JSROOT.Painter.symbols_map={"#alpha":"\u03B1","#beta":"\u03B2","#chi":"\u03C7","#delta":"\u03B4","#varepsilon":"\u03B5","#phi":"\u03C6","#gamma":"\u03B3","#eta":"\u03B7","#iota":"\u03B9","#varphi":"\u03C6","#kappa":"\u03BA","#lambda":"\u03BB","#mu":"\u03BC","#nu":"\u03BD","#omicron":"\u03BF","#pi":"\u03C0","#theta":"\u03B8","#rho":"\u03C1","#sigma":"\u03C3","#tau":"\u03C4","#upsilon":"\u03C5","#varomega":"\u03D6","#omega":"\u03C9","#xi":"\u03BE","#psi":"\u03C8","#zeta":"\u03B6","#Alpha":"\u0391","#Beta":"\u0392","#Chi":"\u03A7","#Delta":"\u0394","#Epsilon":"\u0395","#Phi":"\u03A6","#Gamma":"\u0393","#Eta":"\u0397","#Iota":"\u0399","#vartheta":"\u03D1","#Kappa":"\u039A","#Lambda":"\u039B","#Mu":"\u039C","#Nu":"\u039D","#Omicron":"\u039F","#Pi":"\u03A0","#Theta":"\u0398","#Rho":"\u03A1","#Sigma":"\u03A3","#Tau":"\u03A4","#Upsilon":"\u03A5","#varsigma":"\u03C2","#Omega":"\u03A9","#Xi":"\u039E","#Psi":"\u03A8","#Zeta":"\u0396","#varUpsilon":"\u03D2","#epsilon":"\u03B5","#sqrt":"\u221A","#leq":"\u2264","#/":"\u2044","#infty":"\u221E","#voidb":"\u0192","#club":"\u2663","#diamond":"\u2666","#heart":"\u2665","#spade":"\u2660","#leftrightarrow":"\u2194","#leftarrow":"\u2190","#uparrow":"\u2191","#rightarrow":"\u2192","#downarrow":"\u2193","#circ":"\u02C6","#pm":"\xB1","#doublequote":"\u2033","#geq":"\u2265","#times":"\xD7","#propto":"\u221D","#partial":"\u2202","#bullet":"\u2022","#divide":"\xF7","#neq":"\u2260","#equiv":"\u2261","#approx":"\u2248","#3dots":"\u2026","#cbar":"\u007C","#topbar":"\xAF","#downleftarrow":"\u21B5","#aleph":"\u2135","#Jgothic":"\u2111","#Rgothic":"\u211C","#voidn":"\u2118","#otimes":"\u2297","#oplus":"\u2295","#oslash":"\u2205","#cap":"\u2229","#cup":"\u222A","#supseteq":"\u2287","#supset":"\u2283","#notsubset":"\u2284","#subseteq":"\u2286","#subset":"\u2282","#int":"\u222B","#in":"\u2208","#notin":"\u2209","#angle":"\u2220","#nabla":"\u2207","#oright":"\xAE","#ocopyright":"\xA9","#trademark":"\u2122","#prod":"\u220F","#surd":"\u221A","#upoint":"\u22C5","#corner":"\xAC","#wedge":"\u2227","#vee":"\u2228","#Leftrightarrow":"\u21D4","#Leftarrow":"\u21D0","#Uparrow":"\u21D1","#Rightarrow":"\u21D2","#Downarrow":"\u21D3","#LT":"\x3C","#void1":"\xAE","#copyright":"\xA9","#void3":"\u2122","#sum":"\u2211","#arctop":"","#lbar":"","#arcbottom":"","#void8":"","#bottombar":"\u230A","#arcbar":"","#ltbar":"","#AA":"\u212B","#aa":"\u00E5","#void06":"","#GT":"\x3E","#forall":"\u2200","#exists":"\u2203","#bar":"","#vec":"","#dot":"\u22C5","#hat":"\xB7","#ddot":"","#acute":"acute","#grave":"","#check":"\u2713","#tilde":"\u02DC","#slash":"\u2044","#hbar":"\u0127","#box":"","#Box":"","#parallel":"","#perp":"\u22A5","#odot":"","#left":"","#right":""};JSROOT.Painter.translateLaTeX=function(c){var g=c;g=this.translateExp(g);while(g.indexOf("^{o}")!=-1){g=g.replace("^{o}","\xBA")}var e=g.match(/\#sqrt{(.*?)}/gi);if(e!=null){for(var d=0;d<e.length;++d){var f=e[d].replace(" ","");f=f.replace("#sqrt{","#sqrt");f=f.replace("}","");g=g.replace(e[d],f)}}e=g.match(/\_{(.*?)}/gi);if(e!=null){for(var d=0;d<e.length;++d){var f=e[d].replace(" ","");f=f.replace("_{","");f=f.replace("}","");g=g.replace(e[d],f)}}e=g.match(/\^{(.*?)}/gi);if(e!=null){for(d=0;d<e.length;++d){var f=e[d].replace(" ","");f=f.replace("^{","");f=f.replace("}","");g=g.replace(e[d],f)}}while(g.indexOf("#/")!=-1){g=g.replace("#/",JSROOT.Painter.symbols_map["#/"])}for(var b in JSROOT.Painter.symbols_map){while(g.indexOf(b)!=-1){g=g.replace(b,JSROOT.Painter.symbols_map[b])}}return g};JSROOT.Painter.isAnyLatex=function(b){return(b.indexOf("#")>=0)||(b.indexOf("\\")>=0)||(b.indexOf("{")>=0)};JSROOT.Painter.translateMath=function(d,c){if(c!=2){d=d.replace(/#frac/g,"\\frac");d=d.replace(/#left{/g,"\\left\\{");d=d.replace(/#right}/g,"\\right\\}");d=d.replace(/#left/g,"\\left");d=d.replace(/#right/g,"\\right");d=d.replace(/#\[\]/g,"\\[]");for(var b in JSROOT.Painter.symbols_map){var e="\\"+b.substr(1);d=d.replace(new RegExp(b,"g"),e)}}else{d=d.replace(/\\\^/g,"\\hat")}return"\\("+d+"\\)"};JSROOT.TBasePainter=function(){};JSROOT.TBasePainter.prototype.Cleanup=function(){};JSROOT.TBasePainter.prototype.GetObject=function(){return null};JSROOT.TBasePainter.prototype.UpdateObject=function(b){return false};JSROOT.TBasePainter.prototype.RedrawPad=function(b){};JSROOT.TBasePainter.prototype.RedrawObject=function(c){if(this.UpdateObject(c)){var b=document.body.style.cursor;document.body.style.cursor="wait";this.RedrawPad();document.body.style.cursor=b}};JSROOT.TBasePainter.prototype.CheckResize=function(b){};JSROOT.TBasePainter.prototype.SetDivId=function(c){this["divid"]=c;var b=d3.select("#"+c);if(b.node()&&b.node().firstChild){b.node().firstChild.painter=this}};JSROOT.TBasePainter.prototype.SetItemName=function(b){if(b==null){delete this["_hitemname"]}else{this["_hitemname"]=b}};JSROOT.TBasePainter.prototype.GetItemName=function(){return("_hitemname" in this)?this["_hitemname"]:null};JSROOT.TObjectPainter=function(b){JSROOT.TBasePainter.call(this);this.obj_typename=(b!=null)&&("_typename" in b)?b._typename:"";this.draw_g=null;this.pad_name="";this.main=null};JSROOT.TObjectPainter.prototype=Object.create(JSROOT.TBasePainter.prototype);JSROOT.TObjectPainter.prototype.CheckResize=function(d){var b=this.svg_canvas();var c=b.empty()?null:b.property("pad_painter");if(c){c.CheckCanvasResize()}};JSROOT.TObjectPainter.prototype.RemoveDrawG=function(){if(this.draw_g!=null){this.draw_g.remove();this.draw_g=null}};JSROOT.TObjectPainter.prototype.RecreateDrawG=function(c,d,f){if(this.draw_g){this.draw_g.selectAll("*").remove()}if(c){if(d==null){d=".text_layer"}if(!this.draw_g){this.draw_g=this.svg_pad().select(d).append("svg:g")}}else{var g=this.svg_frame();var b=g.attr("width");var e=g.attr("height");if(!this.draw_g){if(d==null){d=".main_layer"}if(f){this.draw_g=g.select(d).append("g")}else{this.draw_g=g.select(d).append("svg")}}if(!f){this.draw_g.attr("x",0).attr("y",0).attr("width",b).attr("height",e).attr("viewBox","0 0 "+b+" "+e).attr("overflow","hidden")}}};JSROOT.TObjectPainter.prototype.svg_canvas=function(){return d3.select("#"+this.divid+" .root_canvas")};JSROOT.TObjectPainter.prototype.svg_pad=function(){var b=this.svg_canvas();if((this.pad_name!="")&&!b.empty()){b=b.select("[pad="+this.pad_name+"]")}return b};JSROOT.TObjectPainter.prototype.root_pad=function(){var c=this.svg_pad();var b=c.empty()?null:c.property("pad_painter");return b?b.pad:null};JSROOT.TObjectPainter.prototype.svg_frame=function(){return this.svg_pad().select(".root_frame")};JSROOT.TObjectPainter.prototype.pad_width=function(){var b=parseInt(this.svg_pad().attr("width"));return(b==NaN)?0:b};JSROOT.TObjectPainter.prototype.pad_height=function(){var b=parseInt(this.svg_pad().attr("height"));return(b==NaN)?0:b};JSROOT.TObjectPainter.prototype.frame_width=function(){var b=parseInt(this.svg_frame().attr("width"));return(b==NaN)?0:b};JSROOT.TObjectPainter.prototype.frame_height=function(){var b=parseInt(this.svg_frame().attr("height"));return(b==NaN)?0:b};JSROOT.TObjectPainter.prototype.main_painter=function(){if(!this.main){var b=this.svg_pad();if(!b.empty()){this.main=b.property("mainpainter")}}return this.main};JSROOT.TObjectPainter.prototype.is_main_painter=function(){return this==this.main_painter()};JSROOT.TObjectPainter.prototype.SetDivId=function(f,e){this["divid"]=f;if(e==null){e=0}this["create_canvas"]=false;var d=this.svg_canvas();if(d.empty()&&(e>0)){JSROOT.Painter.drawCanvas(f,null);d=this.svg_canvas();this["create_canvas"]=true}if(d.empty()){if((e<0)||(this.obj_typename=="TCanvas")){return}console.log("Special case for "+this.obj_typename+" assign painter to first DOM element");var b=d3.select("#"+f);if(b.node()&&b.node().firstChild){b.node().firstChild.painter=this}return}this.pad_name=d.property("current_pad");if(e<0){return}if((e>0)&&this.svg_frame().empty()){JSROOT.Painter.drawFrame(f,null);if(this.svg_frame().empty()){return alert("Fail to draw dummy TFrame")}this["create_canvas"]=true}var c=this.svg_pad();if(c.empty()){return}if(c.property("pad_painter")!=this){c.property("pad_painter").painters.push(this)}if((e>0)&&(c.property("mainpainter")==null)){c.property("mainpainter",this)}};JSROOT.TObjectPainter.prototype.SetForeignObjectPosition=function(c,b,e){var d=c;if(JSROOT.browser.isWebKit){this.svg_canvas().property("redraw_by_resize",true);while(d&&d.attr("class")!="root_canvas"){if((d.attr("class")=="root_frame")||(d.attr("class")=="root_pad")){b+=parseInt(d.attr("x"));e+=parseInt(d.attr("y"))}d=d3.select(d.node().parentNode)}}c.attr("x",b).attr("y",e)};JSROOT.TObjectPainter.prototype.createAttFill=function(e,f,c){if((f==null)&&e){f=e.fFillStyle}if((c==null)&&e){c=e.fFillColor}var g={color:"none"};g.SetFill=function(i){i.style("fill",this.color);if("antialias" in this){i.style("antialias",this.antialias)}};g.func=g.SetFill.bind(g);if(typeof e=="string"){g.color=e;return g}if((f<1001)||((f>=4000)&&(f<=4100))){return g}g.color=JSROOT.Painter.root_colors[c];if(typeof g.color!="string"){g.color="none"}var b=this.svg_canvas();if((f<3000)||(f>3025)||b.empty()){return g}var h="pat_"+f+"_"+c;g.color="url(#"+h+")";g.antialias=false;if(document.getElementById(h)!=null){return g}var d=JSROOT.Painter.root_colors[c];switch(f){case 3001:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","3px").attr("height","2px").style("stroke",d).append("svg:rect").attr("x",0).attr("y",0).attr("width",1).attr("height",1).style("stroke",d).append("svg:rect").attr("x",2).attr("y",0).attr("width",1).attr("height",1).style("stroke",d).append("svg:rect").attr("x",1).attr("y",1).attr("width",1).attr("height",1).style("stroke",d);break;case 3002:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","4px").attr("height","2px").style("stroke",d).append("svg:rect").attr("x",1).attr("y",0).attr("width",1).attr("height",1).style("stroke",d).append("svg:rect").attr("x",3).attr("y",1).attr("width",1).attr("height",1).style("stroke",d);break;case 3003:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","4px").attr("height","4px").style("stroke",d).append("svg:rect").attr("x",2).attr("y",1).attr("width",1).attr("height",1).style("stroke",d).append("svg:rect").attr("x",0).attr("y",3).attr("width",1).attr("height",1).style("stroke",d);break;case 3004:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","8px").attr("height","8px").style("stroke",d).append("svg:line").attr("x1",8).attr("y1",0).attr("x2",0).attr("y2",8).style("stroke",d).style("stroke-width",1);break;case 3005:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","8px").attr("height","8px").style("stroke",d).append("svg:line").attr("x1",0).attr("y1",0).attr("x2",8).attr("y2",8).style("stroke",d).style("stroke-width",1);break;case 3006:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","4px").attr("height","4px").style("stroke",d).append("svg:line").attr("x1",1).attr("y1",0).attr("x2",1).attr("y2",3).style("stroke",d).style("stroke-width",1);break;case 3007:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","4px").attr("height","4px").style("stroke",d).append("svg:line").attr("x1",0).attr("y1",1).attr("x2",3).attr("y2",1).style("stroke",d).style("stroke-width",1);break;default:b.append("svg:pattern").attr("id",h).attr("patternUnits","userSpaceOnUse").attr("width","8px").attr("height","8px").style("stroke",d).append("svg:line").attr("x1",8).attr("y1",0).attr("x2",0).attr("y2",8).style("stroke",d).style("stroke-width",1);break}return g};JSROOT.TObjectPainter.prototype.ForEachPainter=function(e){var b=d3.select("#"+this.divid);var c=(b.node()&&b.node().firstChild)?b.node().firstChild.painter:null;if(c!=null){e(c);return}var f=this.svg_canvas();if(f.empty()){return}e(f.property("pad_painter"));var g=f.property("pad_painter").painters;for(var d in g){e(g[d])}};JSROOT.TObjectPainter.prototype.Cleanup=function(){d3.select("#"+this.divid).html("")};JSROOT.TObjectPainter.prototype.RedrawPad=function(){var c=this.svg_pad();var b=c.empty()?null:c.property("pad_painter");if(b){b.Redraw()}};JSROOT.TObjectPainter.prototype.AddDrag=function(k){if(!JSROOT.gStyle.MoveResize){return}var c=this;var b=function(){return Number(c.draw_g.attr("width"))};var m=function(){return Number(c.draw_g.attr("height"))};var n=0,l=0,g=1,d=1;function i(o){if("buttons" in o){return o.buttons===2}else{if("which" in o){return o.which===2}else{if("button" in o){return o.button===2}}}return false}var e=c.draw_g.append("rect").style("opacity","0").style("cursor","se-resize").attr("x",b()-20).attr("y",m()-20).attr("width",20).attr("height",20);var f=null;var j=d3.behavior.drag().origin(Object).on("dragstart",function(){if(i(d3.event.sourceEvent)){return}d3.event.sourceEvent.preventDefault();n=0;l=0;g=c.pad_width()-b();d=c.pad_height()-m();f=c.draw_g.append("rect").attr("class","zoom").attr("x",0).attr("y",0).attr("width",b()).attr("height",m()).style("cursor","move")}).on("drag",function(){if(f==null){return}d3.event.sourceEvent.preventDefault();var o=Number(f.attr("x"));var t=Number(f.attr("y"));var s=Number(c.draw_g.attr("x"))+o;var r=Number(c.draw_g.attr("y"))+t;var q=d3.event.dx,p=d3.event.dy;if(((n<0)&&(q>0))||((n>0)&&(q<0))){n+=q;q=0}if(((l<0)&&(p>0))||((l>0)&&(p<0))){l+=p;p=0}if((s+q<0)||(s+q>g)){n+=q}else{o+=q}if((r+p<0)||(r+p>d)){l+=p}else{t+=p}f.attr("x",o).attr("y",t);d3.event.sourceEvent.stopPropagation()}).on("dragend",function(){if(f==null){return}d3.event.sourceEvent.preventDefault();f.style("cursor","auto");var q=Number(f.attr("x"));var p=Number(f.attr("y"));var o=Number(c.draw_g.attr("x"))+q;var r=Number(c.draw_g.attr("y"))+p;f.remove();f=null;c.draw_g.attr("x",o).attr("y",r);c.draw_g.attr("transform","translate("+o+","+r+")");e.attr("x",b()-20).attr("y",m()-20);if("move" in k){k.move(o,r,q,p)}else{if("obj" in k){k.obj.fX1NDC+=q/c.pad_width();k.obj.fX2NDC+=q/c.pad_width();k.obj.fY1NDC-=p/c.pad_height();k.obj.fY2NDC-=p/c.pad_height()}}});var h=d3.behavior.drag().origin(Object).on("dragstart",function(){if(i(d3.event.sourceEvent)){return}d3.event.sourceEvent.stopPropagation();d3.event.sourceEvent.preventDefault();n=0;l=0;g=c.pad_width()-Number(c.draw_g.attr("x"));d=c.pad_height()-Number(c.draw_g.attr("y"));f=c.draw_g.append("rect").attr("class","zoom").attr("x",0).attr("y",0).attr("width",b()).attr("height",m()).style("cursor","se-resize")}).on("drag",function(){if(f==null){return}d3.event.sourceEvent.preventDefault();var p=Number(f.attr("width"));var r=Number(f.attr("height"));var q=d3.event.dx,o=d3.event.dy;if((n>0)&&(q<0)){n+=q;q=0}if((l>0)&&(o<0)){l+=o;o=0}if(p+q>g){n+=q}else{p+=q}if(r+o>d){l+=o}else{r+=o}f.attr("width",p).attr("height",r);d3.event.sourceEvent.stopPropagation()}).on("dragend",function(){if(f==null){return}d3.event.sourceEvent.preventDefault();f.style("cursor","auto");var o=Number(f.attr("width"));var p=Number(f.attr("height"));c.draw_g.attr("width",o).attr("height",p);f.remove();f=null;e.attr("x",o-20).attr("y",p-20);if("resize" in k){k.resize(o,p)}else{if("obj" in k){k.obj.fX2NDC=k.obj.fX1NDC+o/c.pad_width();k.obj.fY1NDC=k.obj.fY2NDC-p/c.pad_height()}if(("redraw" in k)&&(typeof c[k.redraw]=="function")){c[k.redraw]()}}});c.draw_g.style("cursor","move").call(j);e.call(h)};JSROOT.TObjectPainter.prototype.FindPainterFor=function(b,f){var d=this.svg_pad();var e=d.empty()?null:d.property("pad_painter").painters;if(e==null){return null}for(var g in e){var c=e[g].GetObject();if(c==null){continue}if(b&&(c===b)){return e[g]}if(f&&("fName" in c)&&(c.fName==f)){return e[g]}}return null};JSROOT.TObjectPainter.prototype.Redraw=function(){};JSROOT.TObjectPainter.prototype.StartTextDrawing=function(d,b,e){if(!e){e=this.draw_g}var c=JSROOT.Painter.getFontDetails(d,b);e.call(c.func);e.property("text_font",c);e.property("mathjax_use",false);e.property("text_factor",0);e.property("max_text_width",0)};JSROOT.TObjectPainter.prototype.TextScaleFactor=function(c,b){if(!b){b=this.draw_g}if(c&&(c>b.property("text_factor"))){b.property("text_factor",c)}};JSROOT.TObjectPainter.prototype.FinishTextDrawing=function(e){if(!e){e=this.draw_g}var h=null;if(e.property("mathjax_use")){e.property("mathjax_use",false);e.property("_painter",this);var d=false;h=e.selectAll(".math_svg");h.each(function(){var i=d3.select(this);if(i.node().parentNode!==e.node()){return}var f=i.property("_element");if(d3.select(f).select("svg").empty()){d=true}});if(d){return JSROOT.AssertPrerequisites("mathjax",{_this:e,func:function(){if(typeof MathJax!="object"){return}MathJax.Hub.Queue(["FinishTextDrawing",this.property("_painter"),this])}})}}if(h==null){h=e.selectAll(".math_svg")}var b=this;h.each(function(){var k=d3.select(this);if(k.node().parentNode!==e.node()){return}var j=k.property("_element");k.property("_element",null);var l=d3.select(j).select("svg");if(l.empty()){console.log("MathJax SVG ouptut error");return}l.remove();document.body.removeChild(j);k.append(function(){return l.node()});if(k.property("_scale")){var i=k.node().getBBox();var f=parseInt(i.width),m=parseInt(i.height);b.TextScaleFactor(1*f/parseInt(k.attr("width")),e);b.TextScaleFactor(1*m/parseInt(k.attr("height")),e)}});var g=e.property("text_factor");var c=e.property("text_font");if((g>0)&&((g<0.9)||(g>1))){c.size=Math.floor(c.size/g);e.call(c.func)}h.each(function(){var p=d3.select(this);if(p.node().parentNode!==e.node()){return}var l=p.node().getBBox();var f=parseInt(l.width),n=parseInt(l.height);var m=p.property("_align");var k=parseInt(p.attr("width")),o=parseInt(p.attr("height"));var j=parseInt(p.attr("x")),i=parseInt(p.attr("y"));if(p.property("_scale")){if(m[0]=="middle"){j+=(k-f)/2}else{if(m[0]=="end"){j+=(k-f)}}if(m[1]=="middle"){i+=(o-n)/2}else{if(m[1]=="bottom"){i+=(o-n)}}}else{if(m[0]=="middle"){j-=f/2}else{if(m[0]=="end"){j-=f}}if(m[1]=="middle"){i-=n/2}else{if(m[1]=="top"){i-=n}}}p.attr("x",j).attr("y",i).attr("width",f+10).attr("height",n+10).attr("visibility",null)});return e.property("max_text_width")};JSROOT.TObjectPainter.prototype.DrawText=function(n,g,f,j,r,e,s,k,t){if(!t){t=this.draw_g}var p;if(typeof n=="string"){p=n.split(";");if(p.length==1){p.push("middle")}}else{p=["start","middle"];if((n/10)>=3){p[0]="end"}else{if((n/10)>=2){p[0]="middle"}}if((n%10)==0){p[1]="top"}else{if((n%10)==1){p[1]="top"}else{if((n%10)==3){p[1]="bottom"}}}}var u=(j>0)&&(r>0);if(k==null){k=1}if(k<2){if(!JSROOT.Painter.isAnyLatex(e)){k=0}}if(((JSROOT.MathJax<1)&&(k!=2))||(k<1)){if(k>0){e=JSROOT.Painter.translateLaTeX(e)}var b=g.toFixed(1);if(u){if(p[0]=="middle"){b=(g+j*0.5).toFixed(1)}else{if(p[0]=="end"){b=(g+j).toFixed(1)}}}var l=t.append("text").attr("text-anchor",p[0]).attr("x",b).attr("fill",s?s:null).text(e);if(p[1]=="middle"){l.attr("dominant-baseline","middle")}if(u){if(p[1]=="middle"){l.attr("y",(f+r*0.5).toFixed(1))}else{l.attr("y",f.toFixed(1))}}else{l.attr("y",f.toFixed(1));if(r==-270){l.attr("transform","rotate(270, 0, 0)")}}var i=l.node().getBBox();var d=parseInt(i.width),m=parseInt(i.height);if(!u){if((p[1]=="bottom")&&(r==0)){l.attr("y",(f+m).toFixed(1))}}if(d>t.property("max_text_width")){t.property("max_text_width",d)}if((j>0)&&u){this.TextScaleFactor(d/j,t)}if((r>0)&&u){this.TextScaleFactor(m/r,t)}return d}j=Math.round(j);r=Math.round(r);g=Math.round(g);f=Math.round(f);var q=false;if(!u){if(r==-270){q=true}j=this.pad_width();r=this.pad_height()}var o=t.append("svg").attr("x",g).attr("y",f).attr("width",j).attr("height",r).attr("class","math_svg").attr("visibility","hidden").property("_scale",u).property("_rotate",q).property("_align",p);if(q){o.attr("transform","rotate(270, 0, 0)")}var c=document.createElement("div");d3.select(c).style("visibility","hidden").style("overflow","hidden").style("position","absolute").html(JSROOT.Painter.translateMath(e,k));document.body.appendChild(c);t.property("mathjax_use",true);o.property("_element",c);JSROOT.AssertPrerequisites("mathjax",{_this:c,func:function(){if(typeof MathJax=="object"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,this])}}});return 0};JSROOT.TFramePainter=function(b){JSROOT.TObjectPainter.call(this,b);this.tframe=b};JSROOT.TFramePainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TFramePainter.prototype.GetObject=function(){return this.tframe};JSROOT.TFramePainter.prototype.Shrink=function(d,b){var c=this.svg_frame().property("NDC");if(c){c.x1+=d;c.x2-=b}};JSROOT.TFramePainter.prototype.DrawFrameSvg=function(){var s=this.pad_width(),r=this.pad_height();var m=s,y=r;var x=this.svg_frame().empty()?null:this.svg_frame().property("NDC");if(x==null){x={x1:0.07,y1:0.12,x2:0.95,y2:0.88}}var C=this.root_pad();var l=s*x.x1;var n=s*(1-x.x2);var e=r*x.y1;var b=r*(1-x.y2);var q=this.createAttFill("white"),B=JSROOT.Painter.createAttLine("black"),f=0,i=0;if(this.tframe){f=this.tframe.fBorderMode;i=this.tframe.fBorderSize;B=JSROOT.Painter.createAttLine(this.tframe);if(C){var z=s/Math.abs(C.fX2-C.fX1);var k=r/Math.abs(C.fY2-C.fY1);var v=(this.tframe.fX1-C.fX1)*z;var d=(this.tframe.fY1-C.fY1)*k;var u=(this.tframe.fX2-C.fX1)*z;var c=(this.tframe.fY2-C.fY1)*k;var o,j,A,t;if(v<u){o=v;j=u}else{o=u;j=v}if(d<c){A=d;t=c}else{A=c;t=d}l=o;b=A;m=j-o;y=t-A;e=r-t;n=s-j}else{l=this.tframe.fX1*s;e=this.tframe.fY1*r;b=(1-this.tframe.fY2)*r;n=(1-this.tframe.fX2+shrink_right)*s;m-=(l+n);y-=(e+b)}q=this.createAttFill(this.tframe)}else{if(C){q=this.createAttFill(null,C.fFrameFillStyle,C.fFrameFillColor)}m-=(l+n);y-=(e+b)}if(q.color=="none"){q.color="white"}var p=this.svg_pad().select(".root_frame");var g=null;if(p.empty()){p=this.svg_pad().select(".frame_layer").append("svg:g").attr("class","root_frame");g=p.append("svg:rect");p.append("svg:g").attr("class","grid_layer");p.append("svg:g").attr("class","main_layer");p.append("svg:g").attr("class","axis_layer");p.append("svg:g").attr("class","upper_layer")}else{g=p.select("rect")}p.property("NDC",{x1:l/s,x2:(l+m)/s,y1:e/r,y2:(e+y)/r});p.property("frame_painter",this);l=Math.round(l);e=Math.round(e);m=Math.round(m);y=Math.round(y);p.attr("x",l).attr("y",e).attr("width",m).attr("height",y).attr("transform","translate("+l+","+e+")");g.attr("x",0).attr("y",0).attr("width",m).attr("height",y).call(q.func).call(B.func)};JSROOT.TFramePainter.prototype.Redraw=function(){this.DrawFrameSvg()};JSROOT.Painter.drawFrame=function(d,c){var b=new JSROOT.TFramePainter(c);b.SetDivId(d);b.DrawFrameSvg();return b};JSROOT.TF1Painter=function(b){JSROOT.TObjectPainter.call(this,b);this.tf1=b};JSROOT.TF1Painter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TF1Painter.prototype.GetObject=function(){return this.tf1};JSROOT.TF1Painter.prototype.Redraw=function(){this.DrawBins()};JSROOT.TF1Painter.prototype.Eval=function(b){return this.tf1.evalPar(b)};JSROOT.TF1Painter.prototype.CreateDummyHisto=function(){var b=0,k=0,m=0,c=0;if(this.tf1.fNsave>0){var f=this.tf1.fNpx;for(var j=0;j<f;++j){var l=this.tf1.fSave[j];if((j==0)||(l>c)){c=l}if((j==0)||(l<m)){m=l}}b=this.tf1.fSave[f+1];k=this.tf1.fSave[f+2]}else{if(this.tf1.fNpfits<=103){this.tf1.fNpfits=103}b=this.tf1.fXmin;k=this.tf1.fXmax;var f=Math.max(this.tf1.fNpx,this.tf1.fNpfits);var e=(k-b)/f;var d=-1,n=-1;for(var j=0;j<f;++j){var l=this.Eval(b+(j*e));if(isNaN(l)){continue}if(d<0){d=j;c=l;m=l}if((n<0)||(n==j-1)){n=j}if(l>c){c=l}if(l<m){m=l}}if(d<n){k=b+n*e;b=b+d*e}}if(c>0){c*=1.05}if(m<0){m*=1.05}var g=JSROOT.Create("TH1I");g.fName=this.tf1.fName+"_hist";g.fTitle=this.tf1.fTitle;g.fXaxis["fXmin"]=b;g.fXaxis["fXmax"]=k;g.fYaxis["fXmin"]=m;g.fYaxis["fXmax"]=c;return g};JSROOT.TF1Painter.prototype.CreateBins=function(){var b=this;if(this.tf1.fNsave>0){var f=this.tf1.fNpx;var e=this.tf1.fSave[f+1];var c=this.tf1.fSave[f+2];var d=(c-e)/f;this["bins"]=d3.range(f).map(function(g){return{x:e+(g*d),y:b.tf1.fSave[g]}});this["interpolate_method"]="monotone"}else{if(this.tf1.fNpfits<=103){this.tf1.fNpfits=333}var e=this.tf1.fXmin;var c=this.tf1.fXmax;var f=Math.max(this.tf1.fNpx,this.tf1.fNpfits);var d=(c-e)/f;this["bins"]=d3.range(f).map(function(g){var h=e+(g*d);var i=b.Eval(h);if(isNaN(i)){i=0}return{x:h,y:i}});this["interpolate_method"]="cardinal-open"}};JSROOT.TF1Painter.prototype.DrawBins=function(){var d=this.frame_width(),f=this.frame_height();this.RecreateDrawG();var e=this;var c=this.main_painter();var j=JSROOT.Painter.createAttLine(this.tf1);var i=this.createAttFill(this.tf1);if(i.color=="white"){i.color="none"}var b=d3.svg.line().x(function(h){return c.grx(h.x).toFixed(1)}).y(function(h){return c.gry(h.y).toFixed(1)}).interpolate(this.interpolate_method);var g=d3.svg.area().x(function(h){return c.grx(h.x).toFixed(1)}).y1(f).y0(function(h){return c.gry(h.y).toFixed(1)});if(j.color!="none"){this.draw_g.append("svg:path").attr("class","line").attr("d",b(e.bins)).style("fill","none").call(j.func)}if(i.color!="none"){this.draw_g.append("svg:path").attr("class","area").attr("d",g(e.bins)).style("stroke","none").style("pointer-events","none").call(i.func)}if(JSROOT.gStyle.Tooltip){this.draw_g.selectAll().data(this.bins).enter().append("svg:circle").attr("cx",function(h){return c.grx(h.x).toFixed(1)}).attr("cy",function(h){return c.gry(h.y).toFixed(1)}).attr("r",4).style("opacity",0).append("svg:title").text(function(h){return"x = "+c.AxisAsText("x",h.x)+" \ny = "+c.AxisAsText("y",h.y)})}};JSROOT.TF1Painter.prototype.UpdateObject=function(b){if(b._typename!=this.tf1._typename){return false}this.tf1=b;this.CreateBins();return true};JSROOT.Painter.drawFunction=function(e,d){var b=new JSROOT.TF1Painter(d);b.SetDivId(e,-1);if(b.main_painter()==null){var c=b.CreateDummyHisto();JSROOT.Painter.drawHistogram1D(e,c)}b.SetDivId(e);b.CreateBins();b.DrawBins();return b};JSROOT.TGraphPainter=function(b){JSROOT.TObjectPainter.call(this,b);this.graph=b;this.ownhisto=false};JSROOT.TGraphPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TGraphPainter.prototype.GetObject=function(){return this.graph};JSROOT.TGraphPainter.prototype.Redraw=function(){this.DrawBins()};JSROOT.TGraphPainter.prototype.DecodeOptions=function(b){this.draw_all=true;this.optionLine=0;this.optionAxis=0;this.optionCurve=0;this.optionStar=0;this.optionMark=0;this.optionBar=0;this.optionR=0;this.optionOne=0;this.optionE=0;this.optionFill=0;this.optionZ=0;this.optionCurveFill=0;this.draw_errors=true;this.optionNone=0;this.opt="LP";if((b!=null)&&(b!="")){this.opt=b.toUpperCase();this.opt.replace("SAME","")}if(this.opt.indexOf("L")!=-1){this.optionLine=1}if(this.opt.indexOf("A")!=-1){this.optionAxis=1}if(this.opt.indexOf("C")!=-1){this.optionCurve=1}if(this.opt.indexOf("*")!=-1){this.optionStar=1}if(this.opt.indexOf("P")!=-1){this.optionMark=1}if(this.opt.indexOf("B")!=-1){this.optionBar=1}if(this.opt.indexOf("R")!=-1){this.optionR=1}if(this.opt.indexOf("1")!=-1){this.optionOne=1}if(this.opt.indexOf("F")!=-1){this.optionFill=1}if(this.opt.indexOf("2")!=-1||this.opt.indexOf("3")!=-1||this.opt.indexOf("4")!=-1||this.opt.indexOf("5")!=-1){this.optionE=1}if(this.optionLine+this.optionFill+this.optionCurve+this.optionStar+this.optionMark+this.optionBar+this.optionE==0){if(this.opt.length==0){this.optionLine=1}else{this.optionNone=1;return}}if(this.optionStar){this.graph.fMarkerStyle=3}if(this.optionCurve&&this.optionFill){this.optionCurveFill=1;this.optionFill=0}if(this.graph._typename=="TGraphErrors"){var d=d3.max(this.graph.fEX);var c=d3.max(this.graph.fEY);if(d<1e-300&&c<1e-300){this.draw_errors=false}}this.seriesType="scatter";if(this.optionBar==1){this.seriesType="bar"}this.showMarker=false;if(this.optionMark==1||this.optionStar==1){this.showMarker=true}if(this.optionLine==1||this.optionCurve==1||this.optionFill==1){this.seriesType="line"}if(this.optionBar==1){this.binwidthx=(this.graph.fHistogram["fXaxis"]["fXmax"]-this.graph.fHistogram["fXaxis"]["fXmin"])/(this.graph.fNpoints-1)}};JSROOT.TGraphPainter.prototype.CreateBins=function(){var A=this;var b=this.graph.fNpoints;if((this.graph._typename=="TCutG")&&(b>3)){b--}this.lineatt=JSROOT.Painter.createAttLine(this.graph);this.bins=d3.range(b).map(function(h){if(A.optionBar==1){return{x:A.graph.fX[h]-(A.binwidthx/2),y:A.graph.fY[h],bw:A.binwidthx,bh:A.graph.fY[h]}}else{if(A.graph._typename=="TGraphErrors"){return{x:A.graph.fX[h],y:A.graph.fY[h],exlow:A.graph.fEX[h],exhigh:A.graph.fEX[h],eylow:A.graph.fEY[h],eyhigh:A.graph.fEY[h]}}else{if(A.graph._typename=="TGraphAsymmErrors"||A.graph._typename.match(/^RooHist/)){return{x:A.graph.fX[h],y:A.graph.fY[h],exlow:A.graph.fEXlow[h],exhigh:A.graph.fEXhigh[h],eylow:A.graph.fEYlow[h],eyhigh:A.graph.fEYhigh[h]}}else{return{x:A.graph.fX[h],y:A.graph.fY[h]}}}}});this.exclusionGraph=false;if(this.lineatt.width<=99){return}this.exclusionGraph=true;var x,v;var P=this.graph.fNpoints;var G=new Array(P+2),u=new Array(P+2),E=new Array(P+2),q=new Array(P+2),K=new Array(2*P+2),y=new Array(2*P+2);var T,R,Q,c,d=1;if(this.lineatt.width>32767){this.lineatt.width=65536-this.lineatt.width;d=-1}d*=(this.lineatt.width/100)*0.005;this.lineatt.width=this.lineatt.width%100;if(this.lineatt.width>0){this.optionLine=1}var I=this.frame_width(),S=this.frame_height();var J=I/S;var p=this.main_painter().xmin,H=this.main_painter().xmax,F=this.main_painter().ymin,f=this.main_painter().ymax;for(R=0;R<P;R++){G[R]=(this.graph.fX[R]-p)/(H-p);u[R]=(this.graph.fY[R]-F)/(f-F);if(I>S){u[R]=u[R]/J}else{if(S>I){G[R]=G[R]/J}}}K[0]=G[0];y[0]=u[0];c=0;for(R=1;R<P;R++){if(G[R]==G[R-1]&&u[R]==u[R-1]){continue}c++;K[c]=G[R];if(K[R]==K[R-1]){K[R]+=0.000001}y[c]=u[R]}if(K[1]==K[0]){T=Math.PI/2}else{T=Math.atan((y[1]-y[0])/(K[1]-K[0]))}if(K[0]<=K[1]){E[0]=K[0]-d*Math.sin(T);q[0]=y[0]+d*Math.cos(T)}else{E[0]=K[0]+d*Math.sin(T);q[0]=y[0]-d*Math.cos(T)}if(K[c]==K[c-1]){T=Math.PI/2}else{T=Math.atan((y[c]-y[c-1])/(K[c]-K[c-1]))}if(K[c]>=K[c-1]){E[c]=K[c]-d*Math.sin(T);q[c]=y[c]+d*Math.cos(T)}else{E[c]=K[c]+d*Math.sin(T);q[c]=y[c]-d*Math.cos(T)}var O,N,M,t,o,s,m,r,l;for(R=1;R<c;R++){t=K[R];o=y[R];s=K[R+1];m=y[R+1];r=K[R-1];l=y[R-1];if(s==t){O=Math.PI/2}else{O=Math.atan((m-o)/(s-t))}if(s<t){O=O+Math.PI}if(r==t){N=Math.PI/2}else{N=Math.atan((o-l)/(t-r))}if(t<r){N=N+Math.PI}x1=t-d*Math.sin(O);y1=o+d*Math.cos(O);x2=t-d*Math.sin(N);y2=o+d*Math.cos(N);xm=(x1+x2)*0.5;ym=(y1+y2)*0.5;if(xm==t){M=Math.PI/2}else{M=Math.atan((ym-o)/(xm-t))}x3=t-d*Math.sin(M+(Math.PI/2));y3=o+d*Math.cos(M+(Math.PI/2));if((xm-t)*(x3-t)<0&&(ym-o)*(y3-o)<0){x3=2*t-x3;y3=2*o-y3}if((xm==x1)&&(ym==y1)){x3=xm;y3=ym}E[R]=x3;q[R]=y3}if(K[c]==K[0]&&y[c]==y[0]){xm=(E[c]+E[0])*0.5;ym=(q[c]+q[0])*0.5;if(xm==K[0]){M=Math.PI/2}else{M=Math.atan((ym-y[0])/(xm-K[0]))}x3=K[0]+d*Math.sin(M+(Math.PI/2));y3=y[0]-d*Math.cos(M+(Math.PI/2));if((xm-K[0])*(x3-K[0])<0&&(ym-y[0])*(y3-y[0])<0){x3=2*K[0]-x3;y3=2*y[0]-y3}E[c]=x3;E[0]=x3;q[c]=y3;q[0]=y3}var L,B,k,D,g,C;var e=false;var z=c;for(R=z;R>0;R--){for(Q=R-1;Q>0;Q--){if(E[R-1]==E[R]||E[Q-1]==E[Q]){continue}k=(q[R-1]-q[R])/(E[R-1]-E[R]);D=q[R]-k*E[R];g=(q[Q-1]-q[Q])/(E[Q-1]-E[Q]);C=q[Q]-g*E[Q];if(k!=g){L=(C-D)/(k-g);B=k*L+D;if(L>Math.min(E[R],E[R-1])&&L<Math.max(E[R],E[R-1])&&L>Math.min(E[Q],E[Q-1])&&L<Math.max(E[Q],E[Q-1])&&B>Math.min(q[R],q[R-1])&&B<Math.max(q[R],q[R-1])&&B>Math.min(q[Q],q[Q-1])&&B<Math.max(q[Q],q[Q-1])){c++;K[c]=E[R];y[c]=q[R];c++;K[c]=L;y[c]=B;R=Q;e=true;break}else{continue}}else{continue}}if(!e){c++;K[c]=E[R];y[c]=q[R]}e=false}c++;K[c]=E[0];y[c]=q[0];c++;for(R=0;R<c;R++){if(I>S){K[R]=p+(K[R]*(H-p));y[R]=F+(y[R]*(f-F))*J}else{if(S>I){K[R]=p+(K[R]*(H-p))*J;y[R]=F+(y[R]*(f-F))}else{K[R]=p+(K[R]*(H-p));y[R]=F+(y[R]*(f-F))}}if((K[R]<=0)&&this.main_painter().options.Logx){K[R]=p}if((y[R]<=0)&&this.main_painter().options.Logy){y[R]=F}}this.excl=d3.range(c).map(function(h){return{x:K[h],y:y[h]}});this.excl_ff=1;G.splice(0,G.length);u.splice(0,u.length);G=null;u=null;E.splice(0,E.length);q.splice(0,q.length);E=null;q=null;K.splice(0,K.length);y.splice(0,y.length);K=null;y=null};JSROOT.TGraphPainter.prototype.DrawBins=function(){var m=this.frame_width(),r=this.frame_height();this.RecreateDrawG();var e=this;var k=this.main_painter();var p=this.createAttFill(this.graph);function s(i){var h="x = "+k.AxisAsText("x",i.x)+"\ny = "+k.AxisAsText("y",i.y);if(e.draw_errors&&!k.x_time&&("exlow" in i)&&((i.exlow!=0)||(i.exhigh!=0))){h+="\nerror x = -"+k.AxisAsText("x",i.exlow)+"/+"+k.AxisAsText("x",i.exhigh)}if(e.draw_errors&&!k.y_time&&("eylow" in i)&&((i.eylow!=0)||(i.eyhigh!=0))){h+="\nerror y = -"+k.AxisAsText("y",i.eylow)+"/+"+k.AxisAsText("y",i.eyhigh)}return h}var l=d3.svg.line().x(function(h){return k.grx(h.x).toFixed(1)}).y(function(h){return k.gry(h.y).toFixed(1)});if(this.seriesType=="bar"){var v=JSROOT.Painter.root_colors[this.graph.fFillColor];if(typeof(v)=="undefined"){v="rgb(204,204,204)"}var n=k.x.domain();var j=n[1]-n[0];this.draw_errors=false;var o=this.draw_g.selectAll("bar_graph").data(e.bins).enter().append("svg:rect").attr("x",function(h){return k.grx(h.x).toFixed(1)}).attr("y",function(h){return k.gry(h.y).toFixed(1)}).attr("width",function(h){return(m/(n[1]-n[0]))-1}).attr("height",function(h){return k.gry(h.y)-k.gry(h.y+h.bh)}).style("fill",v);if(JSROOT.gStyle.Tooltip){o.append("svg:title").text(function(h){return"x = "+h.x.toPrecision(4)+" \nentries = "+h.y.toPrecision(4)})}}if(this.exclusionGraph){this.showMarker=false;this.draw_g.append("svg:path").attr("d",l(e.excl)).style("stroke","none").style("stroke-width",e.excl_ff).call(p.func).style("opacity",0.75)}if(this.seriesType=="line"){var b="";if(this.graph._typename=="TCutG"){b=" Z"}var u=this.lineatt;if(this.optionLine==0){u=JSROOT.Painter.createAttLine("none")}if(this.optionFill!=1){p.color="none"}this.draw_g.append("svg:path").attr("d",l(e.bins)+b).attr("class","draw_line").style("pointer-events","none").call(u.func).call(p.func);if(JSROOT.gStyle.Tooltip&&!this.showMarker){this.draw_g.selectAll("draw_line").data(e.bins).enter().append("svg:circle").attr("cx",function(h){return k.grx(h.x).toFixed(1)}).attr("cy",function(h){return Math.round(k.gry(h.y))}).attr("r",3).style("opacity",0).append("svg:title").text(s)}}if(this.draw_errors){this.draw_errors=(this.graph._typename=="TGraphErrors"||this.graph._typename=="TGraphAsymmErrors"||this.graph._typename.match(/^RooHist/))&&!this.optionBar}var o=null;if(this.draw_errors||this.showMarker){var c=new Array;for(var q in this.bins){var t=this.bins[q];var f=k.grx(t.x);var d=k.gry(t.y);if((f<0)||(f>m)||(d<0)||(d>r)){continue}t.grx1=f.toFixed(1);t.gry1=d.toFixed(1);if(t.exlow>0){t.grx0=(k.grx(t.x-t.exlow)-f).toFixed(1)}if(t.exhigh>0){t.grx2=(k.grx(t.x+t.exhigh)-f).toFixed(1)}if(t.eylow>0){t.gry0=(k.gry(t.y-t.eylow)-d).toFixed(1)}if(t.eyhigh>0){t.gry2=(k.gry(t.y+t.eyhigh)-d).toFixed(1)}c.push(t)}o=this.draw_g.selectAll("g.node").data(c).enter().append("svg:g").attr("transform",function(h){return"translate("+h.grx1+","+h.gry1+")"})}if(JSROOT.gStyle.Tooltip&&o){o.append("svg:title").text(s)}if(this.draw_errors){o.filter(function(h){return(h.exlow>0)||(h.exhigh>0)}).append("svg:line").attr("x1",function(h){return h.grx0}).attr("y1",0).attr("x2",function(h){return h.grx2}).attr("y2",0).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.filter(function(h){return(h.exlow>0)}).append("svg:line").attr("y1",-3).attr("x1",function(h){return h.grx0}).attr("y2",3).attr("x2",function(h){return h.grx0}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.filter(function(h){return(h.exhigh>0)}).append("svg:line").attr("y1",-3).attr("x1",function(h){return h.grx2}).attr("y2",3).attr("x2",function(h){return h.grx2}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.filter(function(h){return(h.eylow>0)||(h.eyhigh>0)}).append("svg:line").attr("x1",0).attr("y1",function(h){return h.gry0}).attr("x2",0).attr("y2",function(h){return h.gry2}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.filter(function(h){return(h.eylow>0)}).append("svg:line").attr("x1",-3).attr("y1",function(h){return h.gry0}).attr("x2",3).attr("y2",function(h){return h.gry0}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width);o.filter(function(h){return(h.eyhigh>0)}).append("svg:line").attr("x1",-3).attr("y1",function(h){return h.gry2}).attr("x2",3).attr("y2",function(h){return h.gry2}).style("stroke",this.lineatt.color).style("stroke-width",this.lineatt.width)}if(this.showMarker){var g=JSROOT.Painter.createAttMarker(this.graph);o.append("svg:path").call(g.func)}};JSROOT.TGraphPainter.prototype.UpdateObject=function(b){if(b._typename!=this.graph._typename){return false}if(this.ownhisto){this.main_painter().UpdateObject(b.fHistogram)}this.graph.fX=b.fX;this.graph.fY=b.fY;this.graph.fNpoints=b.fNpoints;this.CreateBins();return true};JSROOT.Painter.drawGraph=function(e,d,c){var b=new JSROOT.TGraphPainter(d);b.SetDivId(e,-1);if(b.main_painter()==null){if(d.fHistogram==null){alert("drawing first graph without fHistogram field, not (yet) supported");return null}JSROOT.Painter.drawHistogram1D(e,d.fHistogram);b.ownhisto=true}b.SetDivId(e);b.DecodeOptions(c);b.CreateBins();b.DrawBins();return b};JSROOT.TPavePainter=function(b){JSROOT.TObjectPainter.call(this,b);this.pavetext=b;this.Enabled=true};JSROOT.TPavePainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TPavePainter.prototype.GetObject=function(){return this.pavetext};JSROOT.TPavePainter.prototype.DrawPaveText=function(){var q=this.pavetext;var p=this.pad_width(),E=this.pad_height();if((q.fOption.indexOf("NDC")<0)&&!q.fInit){q.fInit=1;var H=this.root_pad();if(H!=null){if(H.fLogx){if(q.fX1>0){q.fX1=JSROOT.Math.log10(q.fX1)}if(q.fX2>0){q.fX2=JSROOT.Math.log10(q.fX2)}}if(H.fLogy){if(q.fY1>0){q.fY1=JSROOT.Math.log10(q.fY1)}if(q.fY2>0){q.fY2=JSROOT.Math.log10(q.fY2)}}q.fX1NDC=(q.fX1-H.fX1)/(H.fX2-H.fX1);q.fY1NDC=(q.fY1-H.fY1)/(H.fY2-H.fY1);q.fX2NDC=(q.fX2-H.fX1)/(H.fX2-H.fX1);q.fY2NDC=(q.fY2-H.fY1)/(H.fY2-H.fY1)}else{q.fX1NDC=0.1;q.fX2NDC=0.9;q.fY1NDC=0.1;q.fY2NDC=0.9}}var e=Math.round(q.fX1NDC*p);var b=Math.round((1-q.fY1NDC)*E);var A=Math.round(Math.abs(q.fX2NDC-q.fX1NDC)*p);var t=Math.round(Math.abs(q.fY2NDC-q.fY1NDC)*E);b-=t;var s=q.fLines.arr.length;var K=JSROOT.Painter.root_colors[q.fTextColor];var G=JSROOT.Painter.root_colors[q.fShadowColor];var k=this.createAttFill(q);var I=q.fBorderSize?q.fBorderSize:0;var d=JSROOT.Painter.createAttLine(q,I>0?1:0);var L=0,F=0;var f=new Array;for(var D=0;D<s;++D){var o=q.fLines.arr[D]["fTitle"];f.push(o);if(!this.IsStats()||(D==0)||(o.indexOf("|")<0)){continue}if(L===0){L=D}var z=o.split("|");if(z.length>F){F=z.length}}var l=this;this.RecreateDrawG(true,".stat_layer");this.draw_g.attr("x",e).attr("y",b).attr("width",A).attr("height",t).attr("transform","translate("+e+","+b+")");var g=this.draw_g.append("rect").attr("x",0).attr("y",0).attr("width",A).attr("height",t).call(k.func).call(d.func);var y=t/s;var J=q.fMargin*A;this.StartTextDrawing(q.fTextFont,t/(s*1.2));if(s==1){this.DrawText(q.fTextAlign,0,0,A,t,f[0],K)}else{for(var D=0;D<s;++D){var C=JSROOT.Painter.root_colors[q.fLines.arr[D]["fTextColor"]];if(q.fLines.arr[D]["fTextColor"]==0){C=K}var x=D*y;if(this.IsStats()){if((L>0)&&(D>=L)){var z=f[D].split("|");for(var v=0;v<z.length;v++){this.DrawText("middle",A*v/F,x,A/F,y,z[v],C)}}else{if((D==0)||(f[D].indexOf("=")<0)){this.DrawText((D==0)?"middle":"start",J,x,A-2*J,y,f[D],C)}else{var z=f[D].split("="),m=0;for(var v=0;v<2;v++){m+=this.DrawText((v==0)?"start":"end",J,x,A-2*J,y,z[v],C)}this.TextScaleFactor(m/(A-2*J),this.draw_g)}}}else{this.DrawText(q.fTextAlign,J,x,A-2*J,y,f[D],C)}}}var c=this.FinishTextDrawing();if(q.fBorderSize&&(q._typename=="TPaveStats")){this.draw_g.append("svg:line").attr("class","pavedraw").attr("x1",0).attr("y1",y.toFixed(1)).attr("x2",A).attr("y2",y.toFixed(1)).call(d.func)}if((L>0)&&(F>1)){for(var B=L;B<s;B++){this.draw_g.append("svg:line").attr("x1",0).attr("y1",(B*y).toFixed(1)).attr("x2",A).attr("y2",(B*y).toFixed(1)).call(d.func)}for(var u=0;u<F-1;u++){this.draw_g.append("svg:line").attr("x1",(A/F*(u+1)).toFixed(1)).attr("y1",(L*y).toFixed(1)).attr("x2",(A/F*(u+1)).toFixed(1)).attr("y2",t).call(d.func)}}if(I&&I>1){this.draw_g.append("svg:line").attr("x1",A+(I/2)).attr("y1",I+1).attr("x2",A+(I/2)).attr("y2",t+I-1).style("stroke",d.color).style("stroke-width",I);this.draw_g.append("svg:line").attr("x1",I+1).attr("y1",t+(I/2)).attr("x2",A+I-1).attr("y2",t+(I/2)).style("stroke",d.color).style("stroke-width",I)}if((q.fLabel.length>0)&&!this.IsStats()){var i=this.draw_g.append("svg:g").attr("x",A*0.25).attr("y",-E*0.02).attr("width",A*0.5).attr("height",E*0.04).attr("transform","translate("+A*0.25+","+-E*0.02+")");var r=i.append("rect").attr("x",0).attr("y",0).attr("width",A*0.5).attr("height",E*0.04).call(k.func).call(d.func);this.StartTextDrawing(q.fTextFont,E*0.04/1.5,i);this.DrawText(22,0,0,A*0.5,E*0.04,q.fLabel,K,1,i);this.FinishTextDrawing(i)}this.AddDrag({obj:q,redraw:"DrawPaveText"})};JSROOT.TPavePainter.prototype.AddLine=function(b){this.pavetext.AddText(b)};JSROOT.TPavePainter.prototype.IsStats=function(){if(!this.pavetext){return false}return(this.pavetext.fName=="stats")&&(this.pavetext._typename=="TPaveStats")};JSROOT.TPavePainter.prototype.FillStatistic=function(){if(!this.IsStats()){return}var b=new Number(this.pavetext.fOptStat);if(!b){b=new Number(JSROOT.gStyle.OptStat)}if("FillStatistic" in this.main_painter()){this.pavetext.fLines.arr.length=0;this.main_painter().FillStatistic(this,b)}};JSROOT.TPavePainter.prototype.UpdateObject=function(b){if(b._typename!="TPaveText"){return false}this.pavetext.fLines=JSROOT.clone(b.fLines);return true};JSROOT.TPavePainter.prototype.Redraw=function(){if(this.Enabled){this.FillStatistic();this.DrawPaveText()}else{this.RemoveDrawG()}};JSROOT.Painter.drawPaveText=function(d,c){var b=new JSROOT.TPavePainter(c);b.SetDivId(d);b.FillStatistic();b.DrawPaveText();return b};JSROOT.TPadPainter=function(c,b){JSROOT.TObjectPainter.call(this,c);if(this.obj_typename==""){this.obj_typename=b?"TCanvas":"TPad"}this.pad=c;this.iscan=b;this.painters=new Array};JSROOT.TPadPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TPadPainter.prototype.CreateCanvasSvg=function(d){var c=d3.select("#"+this.divid);var j=c.node().getBoundingClientRect();var k=j.width,e=j.height,i=null;var f=null;if(d>0){f=this.svg_canvas();var g=f.property("last_width");var b=f.property("last_height");if(d==1){if((f.attr("width")==k)&&(f.attr("height")==e)){return false}if((g==k)&&(b==e)){return false}}i=f.property("height_factor");if(i!=null){e=Math.round(k*i);c.style("height",e+"px")}if((d==1)&&(g>0)&&(b>0)&&!f.property("redraw_by_resize")){if((k/g>0.5)&&(k/g<2)&&(e/b>0.5)&&(e/b<2)){f.attr("width",k).attr("height",e);return false}}}else{if(e<10){i=0.66;if((this.pad!=null)&&("fCw" in this.pad)&&("fCh" in this.pad)&&(this.pad.fCw>0)){i=this.pad.fCh/this.pad.fCw;if((i<0.1)||(i>10)){i=0.66}}e=Math.round(k*i);c.style("height",e+"px")}var l=null;if(this.pad&&"fFillColor" in this.pad){l=this.createAttFill(this.pad)}else{l=this.createAttFill("white")}c.style("background-color",l.color);f=d3.select("#"+this.divid).append("svg").attr("class","root_canvas").style("background-color",l.color).property("pad_painter",this).property("mainpainter",null).property("current_pad","");f.append("svg:g").attr("class","frame_layer");f.append("svg:g").attr("class","text_layer");f.append("svg:g").attr("class","stat_layer")}f.attr("width",k).attr("height",e).attr("viewBox","0 0 "+k+" "+e).attr("preserveAspectRatio","none").property("height_factor",i).property("last_width",k).property("last_height",e).property("redraw_by_resize",false);return true};JSROOT.TPadPainter.prototype.CreatePadSvg=function(m){var c=Number(this.svg_canvas().attr("width")),k=Number(this.svg_canvas().attr("height"));var i=Math.round(this.pad.fAbsXlowNDC*c);var g=Math.round(k-this.pad.fAbsYlowNDC*k);var j=Math.round(this.pad.fAbsWNDC*c);var f=Math.round(this.pad.fAbsHNDC*k);g-=f;var l=this.createAttFill(this.pad);var b=JSROOT.Painter.createAttLine(this.pad);if(this.pad.fBorderMode==0){b.color="none"}var d=null,e=null;if(m){d=this.svg_pad();e=d.select(".root_pad_border")}else{d=this.svg_canvas().append("g").attr("class","root_pad").attr("pad",this.pad.fName).property("pad_painter",this).property("mainpainter",null);e=d.append("svg:rect").attr("class","root_pad_border");d.append("svg:g").attr("class","frame_layer");d.append("svg:g").attr("class","text_layer");d.append("svg:g").attr("class","stat_layer")}d.attr("width",j).attr("height",f).attr("viewBox",i+" "+g+" "+(i+j)+" "+(g+f)).attr("transform","translate("+i+","+g+")");e.attr("x",0).attr("y",0).attr("width",j).attr("height",f).call(l.func).call(b.func)};JSROOT.TPadPainter.prototype.CheckColors=function(c){if(c==null){return}for(var b in c.fPrimitives.arr){var d=c.fPrimitives.arr[b];if(d==null){continue}if((d._typename=="TObjArray")&&(d.name=="ListOfColors")){JSROOT.Painter.adoptRootColors(d);c.fPrimitives.arr.splice(b,1);c.fPrimitives.opt.splice(b,1);return}}};JSROOT.TPadPainter.prototype.DrawPrimitives=function(){if(this.pad==null){return}for(var c in this.pad.fPrimitives.arr){var b=JSROOT.draw(this.divid,this.pad.fPrimitives.arr[c],this.pad.fPrimitives.opt[c]);if(b){b._primitive=true}}};JSROOT.TPadPainter.prototype.Redraw=function(){if(this.iscan){this.CreateCanvasSvg(2)}else{this.CreatePadSvg(true)}for(var b in this.painters){this.painters[b].Redraw()}};JSROOT.TPadPainter.prototype.CheckCanvasResize=function(){if(!this.iscan){return}var c=this.CreateCanvasSvg(1);if(c){for(var b in this.painters){this.painters[b].Redraw()}}};JSROOT.TPadPainter.prototype.UpdateObject=function(f){if((f==null)||!("fPrimitives" in f)){return false}if(this.iscan){this.CheckColors(f)}if(f.fPrimitives.arr.length!=this.pad.fPrimitives.arr.length){return false}var d=false,e=0;for(var g in f.fPrimitives.arr){var c=f.fPrimitives.arr[g];while(e<this.painters.length){var b=this.painters[e++];if(!("_primitive" in b)){continue}if(b.UpdateObject(c)){d=true}break}}return d};JSROOT.Painter.drawCanvas=function(d,c){var b=new JSROOT.TPadPainter(c,true);b.SetDivId(d,-1);b.CreateCanvasSvg(0);b.SetDivId(d);if(c==null){JSROOT.Painter.drawFrame(d,null)}else{b.CheckColors(c);b.DrawPrimitives()}return b};JSROOT.Painter.drawPad=function(e,d){var b=new JSROOT.TPadPainter(d,false);b.SetDivId(e);b.CreatePadSvg();b.pad_name=d.fName;var c=b.svg_canvas().property("current_pad");b.svg_canvas().property("current_pad",d.fName);b.DrawPrimitives();b.svg_canvas().property("current_pad",c);return b};JSROOT.TColzPalettePainter=function(b){JSROOT.TObjectPainter.call(this,b);this.palette=b};JSROOT.TColzPalettePainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TColzPalettePainter.prototype.GetObject=function(){return this.palette};JSROOT.TColzPalettePainter.prototype.DrawPalette=function(){var s=this.palette;var d=s.fAxis;var g=this.main_painter().minbin;var p=this.main_painter().maxbin;var k=d.fNdiv%100;if(k<=0){k=8}var o=this.pad_width(),m=this.pad_height();var t=Math.round(Math.abs(s.fY2NDC-s.fY1NDC)*m);var f=d.fLabelOffset*o;var n=d.fTickSize*o;var l=d3.scale.linear().clamp(true).domain([g,p]).range([t,0]).nice();var e=JSROOT.Painter.getFontDetails(d.fLabelFont,d.fLabelSize*m);var c=Math.round(s.fX1NDC*o);var b=Math.round(m*(1-s.fY1NDC));var j=Math.round(Math.abs(s.fX2NDC-s.fX1NDC)*o);b-=t;this.RecreateDrawG(true,".text_layer");this.draw_g.attr("x",c).attr("y",b).attr("width",j).attr("height",t).attr("transform","translate("+c+", "+b+")");var h=this.main_painter().paletteColors;var q=1*t/h.length;this.draw_g.selectAll("colorRect").data(h).enter().append("svg:rect").attr("class","colorRect").attr("x",0).attr("y",function(x,w){return(t-(w+1)*q).toFixed(1)}).attr("width",j).attr("height",q.toFixed(1)).attr("fill",function(w){return w}).attr("stroke",function(w){return w});var r=d3.svg.axis().scale(l).orient("right").tickPadding(f).tickSize(-n,-n/2,0).ticks(k);var u=this.draw_g.append("svg:g").attr("class","zaxis").attr("transform","translate("+j+", 0)").call(r);u.selectAll("text").call(e.func).attr("fill",JSROOT.Painter.root_colors[d.fLabelColor]);var v=d.fTitle;if(v!=""&&typeof(d.fTitleFont)!="undefined"){var i=JSROOT.Painter.getFontDetails(d.fTitleFont,d.fTitleSize*m);this.draw_g.append("text").attr("class","Z axis label").attr("x",j+e.size).attr("y",t).attr("text-anchor","end").call(i.func)}this.AddDrag({obj:s,redraw:"DrawPalette"})};JSROOT.TColzPalettePainter.prototype.Redraw=function(){var b=true;if("options" in this.main_painter()){b=(this.main_painter().options.Zscale>0)&&(this.main_painter().options.Color>0)}if(b){this.DrawPalette()}else{this.RemoveDrawG()}};JSROOT.Painter.drawPaletteAxis=function(d,c){var b=new JSROOT.TColzPalettePainter(c);b.SetDivId(d);b.DrawPalette();return b};JSROOT.THistPainter=function(b){JSROOT.TObjectPainter.call(this,b);this.histo=b;this.shrink_frame_left=0;this.draw_content=true;this.nbinsx=0;this.nbinsy=0};JSROOT.THistPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.THistPainter.prototype.GetObject=function(){return this.histo};JSROOT.THistPainter.prototype.IsTProfile=function(){return this.histo&&this.histo._typename=="TProfile"};JSROOT.THistPainter.prototype.IsTH2Poly=function(){return this.histo&&this.histo._typename.match(/^TH2Poly/)};JSROOT.THistPainter.prototype.Dimension=function(){if(!this.histo){return 0}if("fDimension" in this.histo){return this.histo.fDimension}if(this.histo._typename.match(/^TH2/)){return 2}if(this.histo._typename.match(/^TH3/)){return 3}return 1};JSROOT.THistPainter.prototype.DecodeOptions=function(c){if((c==null)||(c=="")){c=this.histo.fOption}var f=this.Dimension();var h={Axis:0,Bar:0,Curve:0,Error:0,Hist:0,Line:0,Mark:0,Fill:0,Same:0,Scat:0,Func:0,Star:0,Arrow:0,Box:0,Text:0,Char:0,Color:0,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:0,Pie:0,List:0,Zscale:0,FrontBox:1,BackBox:1,System:JSROOT.Painter.Coord.kCARTESIAN,AutoColor:0,NoStat:0,AutoZoom:false,HighRes:0,Zero:0,Logx:0,Logy:0,Logz:0,Gridx:0,Gridy:0};var g=c.toUpperCase();g=JSROOT.Painter.clearCuts(g);if(f>1){h.Scat=1}if(this.IsTProfile()){h.Error=2}if("fFunctions" in this.histo){h.Func=1}if(g.indexOf("AUTOCOL")!=-1){h.AutoColor=1;h.Hist=1;g=g.replace("AUTOCOL","")}if(g.indexOf("AUTOZOOM")!=-1){h.AutoZoom=1;h.Hist=1;g=g.replace("AUTOZOOM","")}if(g.indexOf("NOSTAT")!=-1){h.NoStat=1;g=g.replace("NOSTAT","")}if(g.indexOf("LOGX")!=-1){h.Logx=1;g=g.replace("LOGX","")}if(g.indexOf("LOGY")!=-1){h.Logy=1;g=g.replace("LOGY","")}g=g.trim();var j=g.length;if(!j){h.Hist=1}var e=g.indexOf("SPEC");if(e!=-1){h.Scat=0;g=g.replace("SPEC","    ");var i=0;e=g.indexOf("BF(");if(e!=-1){i=parseInt(g)}h.Spec=Math.max(1600,i);return h}if(g.indexOf("GL")!=-1){g=g.replace("GL","  ")}if(g.indexOf("X+")!=-1){h.AxisPos=10;g=g.replace("X+","  ")}if(g.indexOf("Y+")!=-1){h.AxisPos+=1;g=g.replace("Y+","  ")}if((h.AxisPos==10||h.AxisPos==1)&&(j==2)){h.Hist=1}if(h.AxisPos==11&&j==4){h.Hist=1}if(g.indexOf("SAMES")!=-1){if(j==5){h.Hist=1}h.Same=2;g=g.replace("SAMES","     ")}if(g.indexOf("SAME")!=-1){if(j==4){h.Hist=1}h.Same=1;g=g.replace("SAME","    ")}if(g.indexOf("PIE")!=-1){h.Pie=1;g=g.replace("PIE","   ")}e=g.indexOf("LEGO");if(e!=-1){h.Scat=0;h.Lego=1;g=g.replace("LEGO","    ");if(g[e+4]=="1"){h.Lego=11;g[e+4]=" "}if(g[e+4]=="2"){h.Lego=12;g[e+4]=" "}if(g[e+4]=="3"){h.Lego=13;g[e+4]=" "}e=g.indexOf("FB");if(e!=-1){h.FrontBox=0;g=g.replace("FB","  ")}e=g.indexOf("BB");if(e!=-1){h.BackBox=0;g=g.replace("BB","  ")}e=g.indexOf("0");if(e!=-1){h.Zero=1;g=g.replace("0"," ")}}e=g.indexOf("SURF");if(e!=-1){h.Scat=0;h.Surf=1;g=g.replace("SURF","    ");if(g[e+4]=="1"){h.Surf=11;g[e+4]=" "}if(g[e+4]=="2"){h.Surf=12;g[e+4]=" "}if(g[e+4]=="3"){h.Surf=13;g[e+4]=" "}if(g[e+4]=="4"){h.Surf=14;g[e+4]=" "}if(g[e+4]=="5"){h.Surf=15;g[e+4]=" "}if(g[e+4]=="6"){h.Surf=16;g[e+4]=" "}if(g[e+4]=="7"){h.Surf=17;g[e+4]=" "}e=g.indexOf("FB");if(e!=-1){h.FrontBox=0;g=g.replace("FB","  ")}e=g.indexOf("BB");if(e!=-1){h.BackBox=0;g=g.replace("BB","  ")}}e=g.indexOf("TF3");if(e!=-1){e=g.indexOf("FB");if(e!=-1){h.FrontBox=0;g=g.replace("FB","  ")}e=g.indexOf("BB");if(e!=-1){h.BackBox=0;g=g.replace("BB","  ")}}e=g.indexOf("ISO");if(e!=-1){e=g.indexOf("FB");if(e!=-1){h.FrontBox=0;g=g.replace("FB","  ")}e=g.indexOf("BB");if(e!=-1){h.BackBox=0;g=g.replace("BB","  ")}}e=g.indexOf("LIST");if(e!=-1){h.List=1;g=g.replace("LIST","  ")}e=g.indexOf("CONT");if(e!=-1){g=g.replace("CONT","    ");if(f>1){h.Scat=0;h.Contour=1;if(g[e+4]=="1"){h.Contour=11;g[e+4]=" "}if(g[e+4]=="2"){h.Contour=12;g[e+4]=" "}if(g[e+4]=="3"){h.Contour=13;g[e+4]=" "}if(g[e+4]=="4"){h.Contour=14;g[e+4]=" "}if(g[e+4]=="5"){h.Contour=15;g[e+4]=" "}}else{h.Hist=1}}e=g.indexOf("HBAR");if(e!=-1){h.Hist=0;h.Bar=20;g=g.replace("HBAR","    ");if(g[e+4]=="1"){h.Bar=21;g[e+4]=" "}if(g[e+4]=="2"){h.Bar=22;g[e+4]=" "}if(g[e+4]=="3"){h.Bar=23;g[e+4]=" "}if(g[e+4]=="4"){h.Bar=24;g[e+4]=" "}}e=g.indexOf("BAR");if(e!=-1){h.Hist=0;h.Bar=10;g=g.replace("BAR","   ");if(g[e+3]=="1"){h.Bar=11;g[e+3]=" "}if(g[e+3]=="2"){h.Bar=12;g[e+3]=" "}if(g[e+3]=="3"){h.Bar=13;g[e+3]=" "}if(g[e+3]=="4"){h.Bar=14;g[e+3]=" "}}e=g.indexOf("ARR");if(e!=-1){g=g.replace("ARR","   ");if(f>1){h.Arrow=1;h.Scat=0}else{h.Hist=1}}e=g.indexOf("BOX");if(e!=-1){g=g.replace("BOX","   ");if(f>1){Hoption.Scat=0;Hoption.Box=1;if(g[e+3]=="1"){h.Box=11;g[e+3]=" "}}else{h.Hist=1}}e=g.indexOf("COL");if(e!=-1){var b="COL";if(g.charAt(e+3)=="1"){h.Color=1;b+="1";e++}else{if(g.charAt(e+3)=="2"){h.Color=2;b+="2";e++}else{if(g.charAt(e+3)=="3"){h.Color=3;b+="3";e++}else{h.Color=JSROOT.gStyle.DefaultCol}}}if(g.charAt(e+4)=="Z"){h.Zscale=1;b+="Z"}g=g.replace(b,"");if(f==1){h.Hist=1}else{h.Scat=0}}if(g.indexOf("CHAR")!=-1){h.Char=1;g=g.replace("CHAR","    ");h.Scat=0}e=g.indexOf("FUNC");if(e!=-1){h.Func=2;g=g.replace("FUNC","    ");h.Hist=0}e=g.indexOf("HIST");if(e!=-1){h.Hist=2;g=g.replace("HIST","    ");h.Func=0;h.Error=0}if(g.indexOf("AXIS")!=-1){h.Axis=1;g=g.replace("AXIS","    ")}if(g.indexOf("AXIG")!=-1){h.Axis=2;g=g.replace("AXIG","    ")}if(g.indexOf("SCAT")!=-1){h.Scat=1;g=g.replace("SCAT","    ")}e=g.indexOf("TEXT");if(e!=-1){var d=parseInt(g);if(!isNaN(d)){if(d<0){d=0}if(d>90){d=90}h.Text=1000+d}else{h.Text=1}g=g.replace("TEXT","    ");e=g.indexOf("N");if(e!=-1&&this.IsTH2Poly()){h.Text+=3000}h.Scat=0}if(g.indexOf("POL")!=-1){h.System=JSROOT.Painter.Coord.kPOLAR;g=g.replace("POL","   ")}if(g.indexOf("CYL")!=-1){h.System=JSROOT.Painter.Coord.kCYLINDRICAL;g=g.replace("CYL","   ")}if(g.indexOf("SPH")!=-1){h.System=JSROOT.Painter.Coord.kSPHERICAL;g=g.replace("SPH","   ")}e=g.indexOf("PSR");if(e!=-1){h.System=JSROOT.Painter.Coord.kRAPIDITY;g=g.replace("PSR","   ")}e=g.indexOf("TRI");if(e!=-1){h.Scat=0;h.Color=0;h.Tri=1;g=g.replace("TRI","   ");e=g.indexOf("FB");if(e!=-1){h.FrontBox=0;g=g.replace("FB","  ")}e=g.indexOf("BB");if(e!=-1){h.BackBox=0;g=g.replace("BB","  ")}e=g.indexOf("ERR");if(e!=-1){g=g.replace("ERR","   ")}}e=g.indexOf("AITOFF");if(e!=-1){Hoption.Proj=1;g=g.replace("AITOFF","      ")}e=g.indexOf("MERCATOR");if(e!=-1){h.Proj=2;g=g.replace("MERCATOR","        ")}e=g.indexOf("SINUSOIDAL");if(e!=-1){h.Proj=3;g=g.replace("SINUSOIDAL","         ")}e=g.indexOf("PARABOLIC");if(e!=-1){h.Proj=4;g=g.replace("PARABOLIC","         ")}if(h.Proj>0){h.Scat=0;h.Contour=14}if(g.indexOf("A")!=-1){h.Axis=-1}if(g.indexOf("B")!=-1){h.Bar=1}if(g.indexOf("C")!=-1){h.Curve=1;h.Hist=-1}if(g.indexOf("F")!=-1){h.Fill=1}if(g.indexOf("][")!=-1){h.Off=1;h.Hist=1}if(g.indexOf("F2")!=-1){h.Fill=2}if(g.indexOf("L")!=-1){h.Line=1;h.Hist=-1}if(g.indexOf("P")!=-1){h.Mark=1;h.Hist=-1}if(g.indexOf("Z")!=-1){h.Zscale=1}if(g.indexOf("*")!=-1){h.Star=1}if(g.indexOf("H")!=-1){h.Hist=2}if(g.indexOf("P0")!=-1){h.Mark=10}if(this.IsTH2Poly()){if(h.Fill+h.Line+h.Mark!=0){h.Scat=0}}if(g.indexOf("E")!=-1){if(f==1){h.Error=1;if(g.indexOf("E0")!=-1){h.Error=10}if(g.indexOf("E1")!=-1){h.Error=11}if(g.indexOf("E2")!=-1){h.Error=12}if(g.indexOf("E3")!=-1){h.Error=13}if(g.indexOf("E4")!=-1){h.Error=14}if(g.indexOf("E5")!=-1){h.Error=15}if(g.indexOf("E6")!=-1){h.Error=16}if(g.indexOf("X0")!=-1){if(h.Error==1){h.Error+=20}h.Error+=10}if(h.Text&&this.IsTProfile()){h.Text+=2000;h.Error=0}}else{if(h.Error==0){h.Error=100;h.Scat=0}if(h.Text){h.Text+=2000;h.Error=0}}}if(g.indexOf("9")!=-1){h.HighRes=1}if(h.Surf==15){if(h.System==JSROOT.Painter.Coord.kPOLAR||h.System==JSROOT.Painter.Coord.kCARTESIAN){h.Surf=13}}if(h.Bar==1){h.Hist=-1}return h};JSROOT.THistPainter.prototype.GetAutoColor=function(b){if(this.options.AutoColor<=0){return b}var c=this.options.AutoColor;this.options.AutoColor=c%8+1;return JSROOT.Painter.root_colors[c]};JSROOT.THistPainter.prototype.ScanContent=function(){alert("HistPainter.prototype.ScanContent not implemented")};JSROOT.THistPainter.prototype.CheckPadOptions=function(){var b=this.root_pad();if(b!=null){this.options.Logx=b.fLogx;this.options.Logy=b.fLogy;this.options.Logz=b.fLogz;this.options.Gridx=b.fGridx;this.options.Gridy=b.fGridy}if(this.main_painter()!==this){return}this["zoom_xmin"]=0;this["zoom_xmax"]=0;this["zoom_xpad"]=true;this["zoom_ymin"]=0;this["zoom_ymax"]=0;this["zoom_ypad"]=true;if((b!=null)&&("fUxmin" in b)&&!this.create_canvas){this["zoom_xmin"]=b.fUxmin;this["zoom_xmax"]=b.fUxmax;this["zoom_ymin"]=b.fUymin;this["zoom_ymax"]=b.fUymax;if(b.fLogx>0){this["zoom_xmin"]=Math.exp(this["zoom_xmin"]*Math.log(10));this["zoom_xmax"]=Math.exp(this["zoom_xmax"]*Math.log(10))}if(b.fLogy>0){this["zoom_ymin"]=Math.exp(this["zoom_ymin"]*Math.log(10));this["zoom_ymax"]=Math.exp(this["zoom_ymax"]*Math.log(10))}}};JSROOT.THistPainter.prototype.UpdateObject=function(b){if(b._typename!=this.histo._typename){alert("JSROOT.THistPainter.UpdateObject - wrong class "+b._typename+" expected "+this.histo._typename);return false}this.histo.fArray=b.fArray;this.histo.fNcells=b.fNcells;this.histo.fTitle=b.fTitle;this.histo.fXaxis["fNbins"]=b.fXaxis["fNbins"];this.histo.fXaxis["fXmin"]=b.fXaxis["fXmin"];this.histo.fXaxis["fXmax"]=b.fXaxis["fXmax"];this.histo.fYaxis["fXmin"]=b.fYaxis["fXmin"];this.histo.fYaxis["fXmax"]=b.fYaxis["fXmax"];if(this.IsTProfile()){this.histo.fBinEntries=b.fBinEntries;this.histo.fSumw2=b.fSumw2}this.ScanContent();return true};JSROOT.THistPainter.prototype.CreateXY=function(){if(!this.is_main_painter()){this["x"]=this.main_painter()["x"];this["y"]=this.main_painter()["y"];return}var b=this.frame_width(),d=this.frame_height();if(this.histo.fXaxis["fTimeDisplay"]){this.x_time=true;this["timeoffsetx"]=JSROOT.Painter.getTimeOffset(this.histo.fXaxis);this["ConvertX"]=function(g){return new Date(this.timeoffsetx+g*1000)};this["RevertX"]=function(g){return(this.x.invert(g)-this.timeoffsetx)/1000}}else{this.x_time=false;this["ConvertX"]=function(g){return g};this["RevertX"]=function(g){return this.x.invert(g)}}this["scale_xmin"]=this.xmin;this["scale_xmax"]=this.xmax;if(this.zoom_xmin!=this.zoom_xmax){this["scale_xmin"]=this.zoom_xmin;this["scale_xmax"]=this.zoom_xmax}if(this.options.Logx){if(this.scale_xmax<=0){this.scale_xmax=0}if((this.scale_xmin<=0)&&(this.nbinsx>0)){for(var c=0;c<this.nbinsx;c++){var e=this.GetBinX(c);if(e>0){this.scale_xmin=e;break}}}if((this.scale_xmin<=0)||(this.scale_xmin>=this.scale_xmax)){this.scale_xmin=this.scale_xmax*0.0001}this["x"]=d3.scale.log()}else{if(this.x_time){this["x"]=d3.time.scale()}else{this["x"]=d3.scale.linear()}}this.x.domain([this.ConvertX(this.scale_xmin),this.ConvertX(this.scale_xmax)]).range([0,b]);if(this.x_time){this["grx"]=function(g){return this.x(this.ConvertX(g))}}else{if(this.options.Logx){this["grx"]=function(g){return(g<this.scale_xmin)?-5:this.x(g)}}else{this["grx"]=this.x}}this["scale_ymin"]=this.ymin;this["scale_ymax"]=this.ymax;if(this.zoom_ypad){if(this.histo.fMinimum!=-1111){this.zoom_ymin=this.histo.fMinimum}if(this.histo.fMaximum!=-1111){this.zoom_ymax=this.histo.fMaximum}this["zoom_ypad"]=false}if(this.zoom_ymin!=this.zoom_ymax){this["scale_ymin"]=this.zoom_ymin;this["scale_ymax"]=this.zoom_ymax}if(this.histo.fYaxis["fTimeDisplay"]){this.y_time=true;this["timeoffsety"]=JSROOT.Painter.getTimeOffset(this.histo.fYaxis);this["ConvertY"]=function(g){return new Date(this.timeoffsety+g*1000)};this["RevertY"]=function(g){return(this.y.invert(g)-this.timeoffsety)/1000}}else{this.y_time=false;this["ConvertY"]=function(g){return g};this["RevertY"]=function(g){return this.y.invert(g)}}if(this.options.Logy){if(this.scale_ymax<=0){this.scale_ymax=1}if((this.scale_ymin<=0)&&(this.nbinsy>0)){for(var c=0;c<this.nbinsy;c++){var f=this.GetBinY(c);if(f>0){this.scale_ymin=f;break}}}if((this.scale_ymin<=0)&&("ymin_nz" in this)&&(this.ymin_nz>0)){this.scale_ymin=0.3*this.ymin_nz}if((this.scale_ymin<=0)||(this.scale_ymin>=this.scale_ymax)){this.scale_ymin=0.000001*this.scale_ymax}this["y"]=d3.scale.log()}else{if(this.y_time){this["y"]=d3.time.scale()}else{this["y"]=d3.scale.linear()}}this["y"].domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range([d,0]);if(this.y_time){this["gry"]=function(g){return this.y(this.ConvertY(g))}}else{if(this.options.Logy){this["gry"]=function(g){return(g<this.scale_ymin)?d+5:this.y(g)}}else{this["gry"]=this.y}}};JSROOT.THistPainter.prototype.DrawGrids=function(){if(!this.is_main_painter()){return}var c=this.svg_frame().select(".grid_layer");c.selectAll(".xgrid").remove();c.selectAll(".ygrid").remove();if(this.options.Gridx){var d=this.frame_height();var f=this.x.ticks(this.x_nticks);c.selectAll(".xgrid").data(f).enter().append("svg:line").attr("class","xgrid").attr("x1",this.x).attr("y1",d).attr("x2",this.x).attr("y2",0).style("stroke","black").style("stroke-width",1).style("stroke-dasharray",JSROOT.Painter.root_line_styles[11])}if(this.options.Gridy){var b=this.frame_width();var e=this.y.ticks(this.y_nticks);c.selectAll(".ygrid").data(e).enter().append("svg:line").attr("class","ygrid").attr("x1",0).attr("y1",this.y).attr("x2",b).attr("y2",this.y).style("stroke","black").style("stroke-width",1).style("stroke-dasharray",JSROOT.Painter.root_line_styles[11])}};JSROOT.THistPainter.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};JSROOT.THistPainter.prototype.AxisAsText=function(b,c){if(b=="x"){if(this.x_time){c=this.ConvertX(c);if("formatx" in this){return this.formatx(c)}return c.toString()}if(Math.abs(c)<1e-14){if(Math.abs(this.xmax-this.xmin)>0.00001){c=0}}return c.toPrecision(4)}if(b=="y"){if("dfy" in this){return this.dfy(new Date(this.timeoffsety+c*1000))}if(Math.abs(c)<1e-14){if(Math.abs(this.ymax-this.ymin)>0.00001){c=0}}return c.toPrecision(4)}return c.toPrecision(4)};JSROOT.THistPainter.prototype.DrawAxes=function(g){if(!this.is_main_painter()){return}var I=this.frame_width(),K=this.frame_height();var M=this.svg_frame().selectAll(".xaxis_container");if(M.empty()){M=this.svg_frame().select(".axis_layer").append("svg:g").attr("class","xaxis_container")}M.selectAll("*").remove();M.attr("transform","translate(0,"+K+")");var G=this.svg_frame().selectAll(".yaxis_container");if(G.empty()){G=this.svg_frame().select(".axis_layer").append("svg:g").attr("class","yaxis_container")}G.selectAll("*").remove();var c=this.histo.fXaxis["fNdivisions"];this["x_nticks"]=c%100;var t=(c%10000-this.x_nticks)/100;var n=c/10000;var b=this.histo.fYaxis["fNdivisions"];this["y_nticks"]=b%100;var r=(b%10000-this.y_nticks)/100;var m=b/10000;var i=JSROOT.Painter.getFontDetails(this.histo.fXaxis["fLabelFont"],this.histo.fXaxis["fLabelSize"]*K);var E=3+(this.histo.fXaxis["fLabelOffset"]*K);if(this.histo.fXaxis["fTitle"].length>0){this.StartTextDrawing(this.histo.fXaxis["fTitleFont"],this.histo.fXaxis["fTitleSize"]*K,M);var C=this.DrawText("end",I,E+i.size*(1+this.histo.fXaxis["fTitleOffset"]),0,0,this.histo.fXaxis["fTitle"],null,1,M);if(C<=0){g=true}this.FinishTextDrawing(M)}var B=3+(this.histo.fYaxis["fLabelOffset"]*I);var s=JSROOT.Painter.getFontDetails(this.histo.fYaxis["fLabelFont"],this.histo.fYaxis["fLabelSize"]*K);if(this.histo.fYaxis["fTitle"].length>0){this.StartTextDrawing(this.histo.fYaxis["fTitleFont"],this.histo.fYaxis["fTitleSize"]*K,G);var C=this.DrawText("end",0,-B-(1+this.histo.fYaxis["fTitleOffset"])*s.size-G.property("text_font").size,0,-270,this.histo.fYaxis["fTitle"],null,1,G);if(C<=0){g=true}this.FinishTextDrawing(G)}var L=this.histo.fXaxis["fAxisColor"];var j=this.histo.fXaxis["fTickLength"]*K;var d=this.histo.fYaxis["fAxisColor"];var x=this.histo.fYaxis["fTickLength"]*I;var u=this;delete this["formatx"];if(this.x_time){if(this.x_nticks>8){this.x_nticks=8}var D=this.scale_xmax-this.scale_xmin;var A=JSROOT.Painter.getTimeFormat(this.histo.fXaxis);if((A.length==0)||(D<0.1*(this.xmax-this.xmin))){A=JSROOT.Painter.chooseTimeFormat(D,this.x_nticks)}if(A.length>0){this["formatx"]=d3.time.format(A)}}else{if(this.options.Logx){var f=this.histo.fXaxis.TestBit(JSROOT.EAxisBits.kNoExponent);if(this.scale_xmax<100&&this.scale_xmin>0&&this.scale_xmax/this.scale_xmin<100){f=true}var l=this.histo.fXaxis.TestBit(JSROOT.EAxisBits.kMoreLogLabels);this["formatx"]=function(N){var w=parseFloat(N);var h=Math.abs(JSROOT.Math.log10(w));if(l){if(h%1<0.7||h%1>0.9999){if(f){return w.toFixed()}else{return JSROOT.Painter.formatExp(w.toExponential(0))}}else{return null}}else{if(h%1<0.0001||h%1>0.9999){if(f){return w.toFixed()}else{return JSROOT.Painter.formatExp(w.toExponential(0))}}else{return null}}}}else{this["formatx"]=function(h){if((Math.abs(h)<1e-14)&&(Math.abs(this.xmax-this.xmin)>0.00001)){h=0}return parseFloat(h.toPrecision(12))}}}var o=d3.svg.axis().scale(this.x).orient("bottom").tickPadding(E).tickSize(-j,-j/2,-j/4).ticks(this.x_nticks);if("formatx" in this){o.tickFormat(function(h){return u.formatx(h)})}delete this["formaty"];if(this.y_time){if(this.y_nticks>8){this.y_nticks=8}var z=JSROOT.Painter.getTimeFormat(this.histo.fYaxis);if((z.length==0)||(scale_yrange<0.1*(this.ymax-this.ymin))){z=JSROOT.Painter.chooseTimeFormat(scale_yrange,this.y_nticks)}if(z.length>0){this["formaty"]=d3.time.format(z)}}else{if(this.options.Logy){var e=this.histo.fYaxis.TestBit(JSROOT.EAxisBits.kNoExponent);var k=this.histo.fYaxis.TestBit(JSROOT.EAxisBits.kMoreLogLabels);if(this.scale_ymax<100&&this.scale_ymin>0&&this.scale_ymax/this.scale_ymin<100){e=true}this["formaty"]=function(N){var w=parseFloat(N);var h=Math.abs(JSROOT.Math.log10(w));if(k){if(h%1<0.7||h%1>0.9999){if(e){return w.toFixed()}else{return JSROOT.Painter.formatExp(w.toExponential(0))}}else{return null}}else{if(h%1<0.0001||h%1>0.9999){if(e){return w.toFixed()}else{return JSROOT.Painter.formatExp(w.toExponential(0))}}else{return null}}}}else{if(this.y_nticks>=10){this.y_nticks-=2}this["formaty"]=function(h){if((Math.abs(h)<1e-14)&&(Math.abs(u.ymax-u.ymin)>0.00001)){h=0}return parseFloat(h.toPrecision(12))}}}var J=d3.svg.axis().scale(this.y).orient("left").tickPadding(B).tickSize(-x,-x/2,-x/4).ticks(this.y_nticks);if("formaty" in this){J.tickFormat(function(h){return u.formaty(h)})}M.append("svg:g").attr("class","xaxis").call(o);if((t>0)&&!this.options.Logx){var v=d3.svg.axis().scale(this.x).orient("bottom").tickPadding(E).innerTickSize(-j/2).tickFormat(function(h){return}).ticks(this.x.ticks(this.x_nticks).length*t);M.append("svg:g").attr("class","xaxis").call(v)}G.append("svg:g").attr("class","yaxis").call(J);if((r>0)&&!this.options.Logy){var F=d3.svg.axis().scale(this.y).orient("left").tickPadding(B).innerTickSize(-x/2).tickFormat(function(h){return}).ticks(this.y.ticks(this.y_nticks).length*r);G.append("svg:g").attr("class","yaxis").call(F)}M.call(i.func);G.call(s.func);if(JSROOT.gStyle.Zooming){M.append("svg:rect").attr("class","xaxis_zoom").attr("x",0).attr("y",0).attr("width",I).attr("height",i.size+3).style("opacity","0");G.append("svg:rect").attr("class","yaxis_zoom").attr("x",-2*s.size-3).attr("y",0).attr("width",2*s.size+3).attr("height",K).style("opacity","0")}if((g==null)&&typeof G.node()["getBoundingClientRect"]=="function"){var q=G.node().getBoundingClientRect();var p=this.svg_pad().node().getBoundingClientRect();var H=q.left-p.left;var y=0;if(H<0){y=-H/I+0.001;this.shrink_frame_left+=y}else{if((this.shrink_frame_left>0)&&(H/I>this.shrink_frame_left)){y=-this.shrink_frame_left;this.shrink_frame_left=0}}if(y!=0){this.svg_frame().property("frame_painter").Shrink(y,0);this.svg_frame().property("frame_painter").Redraw();this.CreateXY();this.DrawAxes(true)}}};JSROOT.THistPainter.prototype.DrawTitle=function(){var b=this.FindPainterFor(null,"title");if(b!=null){b.pavetext.Clear();b.pavetext.AddText(this.histo.fTitle)}else{var c=JSROOT.Create("TPaveText");JSROOT.extend(c,{fName:"title",fX1NDC:0.2809483,fY1NDC:0.9339831,fX2NDC:0.7190517,fY2NDC:0.995});c.AddText(this.histo.fTitle);b=JSROOT.Painter.drawPaveText(this.divid,c)}};JSROOT.THistPainter.prototype.ToggleStat=function(){var b=this.FindStat();if(b==null){b=this.CreateStat();this.Redraw();return}var c=this.FindPainterFor(b);if(c==null){alert("Did not found painter for existing stat??");return}c.Enabled=!c.Enabled;c.Redraw()};JSROOT.THistPainter.prototype.GetSelectIndex=function(d,c,g){var e=0;var f=this.main_painter();if(f==null){f=this}var b=0;if(!g){g=0}if(d=="x"){b=this.nbinsx;if(f.zoom_xmin!=f.zoom_xmax){if(c=="left"){e=Math.floor((f.zoom_xmin-this.xmin)/this.binwidthx+g)}else{e=Math.round((f.zoom_xmax-this.xmin)/this.binwidthx+0.5+g)}}else{e=(c=="left")?0:b}}else{if(d=="y"){b=this.nbinsy;if(f.zoom_ymin!=f.zoom_ymax){if(c=="left"){e=Math.floor((f.zoom_ymin-this.ymin)/this.binwidthy+g)}else{e=Math.round((f.zoom_ymax-this.ymin)/this.binwidthy+0.5+g)}}else{e=(c=="left")?0:b}}}if(c=="left"){if(e<0){e=0}}else{if(e>b){e=b}}return e};JSROOT.THistPainter.prototype.FindStat=function(){if("fFunctions" in this.histo){for(var b in this.histo.fFunctions.arr){var c=this.histo.fFunctions.arr[b];if(c._typename=="TPaveText"||c._typename=="TPaveStats"){return c}}}return null};JSROOT.THistPainter.prototype.CreateStat=function(){if(!this.draw_content){return null}if(this.FindStat()!=null){return null}var b=JSROOT.Create("TPaveStats");JSROOT.extend(b,{_AutoCreated:true,fName:"stats",fOptStat:JSROOT.gStyle.OptStat,fBorderSize:1});JSROOT.extend(b,JSROOT.gStyle.StatNDC);JSROOT.extend(b,JSROOT.gStyle.StatText);JSROOT.extend(b,JSROOT.gStyle.StatFill);if(this.histo._typename&&(this.histo._typename.match(/^TProfile/)||this.histo._typename.match(/^TH2/))){b.fY1NDC=0.67}b.AddText(this.histo.fName);if(!"fFunctions" in this.histo){this.histo.fFunctions=JSROOT.Create("TList")}this.histo.fFunctions.arr.push(b);return b};JSROOT.THistPainter.prototype.DrawFunctions=function(){if(!("fFunctions" in this.histo)){return}if(this.histo.TestBit(JSROOT.TH1StatusBits.kNoStats)||(this.options.Same==1)||(this.options.NoStat==1)){return}var h=this;var f=JSROOT.BIT(9);var b={kCanDelete:JSROOT.BIT(0),kMustCleanup:JSROOT.BIT(3),kObjInCanvas:JSROOT.BIT(3),kIsReferenced:JSROOT.BIT(4),kHasUUID:JSROOT.BIT(5),kCannotPick:JSROOT.BIT(6),kNoContextMenu:JSROOT.BIT(8),kInvalidObject:JSROOT.BIT(13)};for(var d in this.histo.fFunctions.arr){var g=this.histo.fFunctions.arr[d];var e=this.FindPainterFor(g);if(e!=null){continue}if(g._typename=="TPaveText"||g._typename=="TPaveStats"){e=JSROOT.Painter.drawPaveText(this.divid,g)}else{if(g._typename=="TF1"){var c=this.root_pad()!=null;if((!c&&!g.TestBit(f))||(c&&g.TestBit(b.kObjInCanvas))){e=JSROOT.Painter.drawFunction(this.divid,g)}}else{if(g._typename=="TPaletteAxis"){e=JSROOT.Painter.drawPaletteAxis(this.divid,g)}}}}};JSROOT.THistPainter.prototype.Redraw=function(){this.CreateXY();this.DrawAxes();this.DrawGrids();this.DrawBins();if(this.create_canvas){this.DrawTitle()}};JSROOT.THistPainter.prototype.Unzoom=function(e,c){var b=this.main_painter();if(!b){b=this}var d=false;if(e){if(b.zoom_xmin!=b.zoom_xmax){d=true}b.zoom_xmin=0;b.zoom_xmax=0}if(c){if(b.zoom_ymin!=b.zoom_ymax){d=true}b.zoom_ymin=0;b.zoom_ymax=0}if(d){this.RedrawPad()}};JSROOT.THistPainter.prototype.Zoom=function(f,c,d,b){var g=this.main_painter();if(!g){g=this}var e=false;if((f!=c)&&(Math.abs(c-f)>g.binwidthx*2)){g.zoom_xmin=f;g.zoom_xmax=c;e=true}if((d!=b)&&(Math.abs(b-d)>(("binwidthy" in g)?(g.binwidthy*2):Math.abs(g.ymax-g.ymin)*0.000001))){g.zoom_ymin=d;g.zoom_ymax=b;e=true}if(e){this.RedrawPad()}};JSROOT.THistPainter.prototype.AddInteractive=function(){if(!JSROOT.gStyle.Zooming||!this.is_main_painter()){return}var q=this.frame_width(),o=this.frame_height();var t,u,s=null,c=null;var n=new Date(0);var i=0;var l=false;var h=this;function g(){JSROOT.Painter.closeMenu();if(c!=null){c.remove();c=null}i=0;if(l){JSROOT.gStyle.Tooltip=true;l=false}}function p(){d3.event.preventDefault();if(i>100){return}var e=d3.event;g();JSROOT.Painter.createMenu(function(v){v.painter=h;v.add("header:"+h.histo.fName);h.FillContextMenu(v);v.show(e)})}function f(){if(i!=0){d3.event.preventDefault();d3.event.stopPropagation();return}q=Number(h.svg_frame().attr("width"));o=Number(h.svg_frame().attr("height"));t=this;var v=d3.touches(t);if(v.length==1){var w=new Date();var x=w.getTime()-n.getTime();if((x<300)&&(s!=null)&&(Math.abs(s[0]-v[0][0])<30)&&(Math.abs(s[1]-v[0][1])<30)){d3.event.preventDefault();d3.event.stopPropagation();g();h.Unzoom(true,true)}else{n=w;s=v[0]}}if(v.length!=2){return}d3.event.preventDefault();g();var e=v[0];var y=v[1];s=new Array;u=new Array;s.push(Math.min(e[0],y[0]));s.push(Math.min(e[1],y[1]));u.push(Math.max(e[0],y[0]));u.push(Math.max(e[1],y[1]));if(s[0]<0){i=103;s[0]=0;u[0]=q}else{if(u[1]>o){i=102;s[1]=0;u[1]=o}else{i=101}}c=h.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",s[0]).attr("y",s[1]).attr("width",u[0]-s[0]).attr("height",u[1]-s[1]);d3.select(window).on("touchmove.zoomRect",d).on("touchcancel.zoomRect",j).on("touchend.zoomRect",j,true);d3.event.stopPropagation()}function d(){if(i<100){return}d3.event.preventDefault();var v=d3.touches(t);if(v.length!=2){g();i=0;return}var e=v[0];var w=v[1];if(i!=103){s[0]=Math.min(e[0],w[0]);u[0]=Math.max(e[0],w[0])}if(i!=102){s[1]=Math.min(e[1],w[1]);u[1]=Math.max(e[1],w[1])}c.attr("x",s[0]).attr("y",s[1]).attr("width",u[0]-s[0]).attr("height",u[1]-s[1]);if(JSROOT.gStyle.Tooltip&&((u[0]-s[0]>10)||(u[1]-s[1]>10))){JSROOT.gStyle.Tooltip=false;l=true}d3.event.stopPropagation()}function j(){if(i<100){return}d3.event.preventDefault();d3.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);d3.select("body").classed("noselect",false);var y=0,v=0,w=0,e=0;var x=false;if((i!=103)&&(Math.abs(s[0]-u[0])>10)){y=Math.min(h.RevertX(u[0]),h.RevertX(s[0]));v=Math.max(h.RevertX(u[0]),h.RevertX(s[0]));x=true}if((i!=102)&&(Math.abs(s[1]-u[1])>10)){w=Math.min(h.y.invert(u[1]),h.y.invert(s[1]));e=Math.max(h.y.invert(u[1]),h.y.invert(s[1]));x=true}d3.select("body").style("-webkit-user-select","auto");if(l){JSROOT.gStyle.Tooltip=true}c.remove();c=null;i=0;if(x){h.Zoom(y,v,w,e)}d3.event.stopPropagation()}function r(){if(i>100){return}d3.event.preventDefault();q=Number(h.svg_frame().attr("width"));o=Number(h.svg_frame().attr("height"));g();t=this;u=d3.mouse(t);s=new Array;s.push(Math.max(0,Math.min(q,u[0])));s.push(Math.max(0,Math.min(o,u[1])));if(u[0]<0){i=3;u[0]=0;u[1]=s[1];s[0]=q;s[1]+=1}else{if(u[1]>o){i=2;u[0]=s[0];u[1]=0;s[0]+=1;s[1]=o}else{i=1;u[0]=s[0];u[1]=s[1]}}c=h.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect");h.svg_frame().on("dblclick",m);d3.select(window).on("mousemove.zoomRect",k).on("mouseup.zoomRect",b,true);d3.event.stopPropagation()}function m(){d3.event.preventDefault();var e=d3.mouse(t);g();if(e[0]<0){h.Unzoom(false,true)}else{if(e[1]>o){h.Unzoom(true,false)}else{h.Unzoom(true,true);h.svg_frame().on("dblclick",null)}}}function k(){if((i==0)||(i>100)){return}d3.event.preventDefault();var e=d3.mouse(t);e[0]=Math.max(0,Math.min(q,e[0]));e[1]=Math.max(0,Math.min(o,e[1]));switch(i){case 1:s[0]=e[0];s[1]=e[1];break;case 2:s[0]=e[0];break;case 3:s[1]=e[1];break}c.attr("x",Math.min(u[0],s[0])).attr("y",Math.min(u[1],s[1])).attr("width",Math.abs(s[0]-u[0])).attr("height",Math.abs(s[1]-u[1]));if(JSROOT.gStyle.Tooltip&&((Math.abs(s[0]-u[0])>10)||(Math.abs(s[1]-u[1])>10))){JSROOT.gStyle.Tooltip=false;l=true}}function b(){if((i==0)||(i>100)){return}d3.event.preventDefault();d3.select(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);d3.select("body").classed("noselect",false);var v=d3.mouse(t);v[0]=Math.max(0,Math.min(q,v[0]));v[1]=Math.max(0,Math.min(o,v[1]));switch(i){case 1:s[0]=v[0];s[1]=v[1];break;case 2:s[0]=v[0];break;case 3:s[1]=v[1];break}var z=0,w=0,x=0,e=0;var y=false;if((i!=3)&&(Math.abs(s[0]-u[0])>10)){z=Math.min(h.RevertX(u[0]),h.RevertX(s[0]));w=Math.max(h.RevertX(u[0]),h.RevertX(s[0]));y=true}if((i!=2)&&(Math.abs(s[1]-u[1])>10)){x=Math.min(h.y.invert(u[1]),h.y.invert(s[1]));e=Math.max(h.y.invert(u[1]),h.y.invert(s[1]));y=true}d3.select("body").style("-webkit-user-select","auto");if(l){JSROOT.gStyle.Tooltip=true;l=false}c.remove();c=null;i=0;if(y){h.Zoom(z,w,x,e)}}this.svg_frame().on("mousedown",r);this.svg_frame().on("touchstart",f);this.svg_frame().on("contextmenu",p)};JSROOT.THistPainter.prototype.FillContextMenu=function(c){c.add("Unzoom X",function(){c.painter.Unzoom(true,false)});c.add("Unzoom Y",function(){c.painter.Unzoom(false,true)});c.add("Unzoom",function(){c.painter.Unzoom(true,true)});c.add(JSROOT.gStyle.Tooltip?"Disable tooltip":"Enable tooltip",function(){JSROOT.gStyle.Tooltip=!JSROOT.gStyle.Tooltip;c.painter.RedrawPad()});if(this.options){var b=this.options.Logx>0?"Linear X":"Log X";c.add(b,function(){c.painter.options.Logx=1-c.painter.options.Logx;c.painter.RedrawPad()});var b=this.options.Logy>0?"Linear Y":"Log Y";c.add(b,function(){c.painter.options.Logy=1-c.painter.options.Logy;c.painter.RedrawPad()})}if(this.draw_content){c.add("Toggle stat",function(){c.painter.ToggleStat()})}};JSROOT.TH1Painter=function(b){JSROOT.THistPainter.call(this,b)};JSROOT.TH1Painter.prototype=Object.create(JSROOT.THistPainter.prototype);JSROOT.TH1Painter.prototype.ScanContent=function(){this.fill=this.createAttFill(this.histo);if(this.fill.color=="white"){this.fill.color="none"}this.attline=JSROOT.Painter.createAttLine(this.histo);var e=this.main_painter();if(e!=null){this.attline.color=e.GetAutoColor(this.attline.color)}var d=0,b=0,h=0,g=0;var c=this.IsTProfile();this.nbinsx=this.histo.fXaxis["fNbins"];for(var f=0;f<this.nbinsx;++f){var j=this.histo.getBinContent(f+1);g+=c?this.histo.fBinEntries[f+1]:j;if(f==0){d=h=j}if(j<d){d=j}else{if(j>h){h=j}}if(j>0){if((b==0)||(j<b)){b=j}}}if(c){g+=this.histo.fBinEntries[0]+this.histo.fBinEntries[this.nbinsx+1]}else{g+=this.histo.getBinContent(0)+this.histo.getBinContent(this.nbinsx+1)}this.stat_entries=g;this.xmin=this.histo.fXaxis["fXmin"];this.xmax=this.histo.fXaxis["fXmax"];this.binwidthx=(this.xmax-this.xmin);if(this.nbinsx>0){this.binwidthx=this.binwidthx/this.nbinsx}this["GetBinX"]=function(i){return this.xmin+i*this.binwidthx};this.ymin=this.histo.fYaxis["fXmin"];this.ymax=this.histo.fYaxis["fXmax"];this.ymin_nz=b;if((this.nbinsx==0)||((Math.abs(d)<1e-300&&Math.abs(h)<1e-300))){if(this.histo.fMinimum!=-1111){this.ymin=this.histo.fMinimum}if(this.histo.fMaximum!=-1111){this.ymax=this.histo.fMaximum}this.draw_content=false}else{if(this.histo.fMinimum!=-1111){d=this.histo.fMinimum}if(this.histo.fMaximum!=-1111){h=this.histo.fMaximum}if(d>=h){if(d==0){this.ymax=0;this.ymax=1}else{if(d<0){this.ymin=2*d;this.ymax=0}else{this.ymin=0;this.ymax=d*2}}}else{var k=(h-d)*0.1;this.ymin=d-k;if((this.ymin<0)&&(d>=0)){this.ymin=0}this.ymax=h+k}this.draw_content=true}if(this.options.Bar==0&&this.options.Hist==0&&this.options.Error==0&&this.options.Same==0){this.draw_content=false}if(this.options.Axis>0){this.draw_content=false}};JSROOT.TH1Painter.prototype.CountStat=function(n){var d=this.IsTProfile();var e=0,k=0,q=0,j=0,h=0;var c=this.GetSelectIndex("x","left");var p=this.GetSelectIndex("x","right");var b=0,o=0,g=null,m=null;for(var f=c;f<p;f++){b=this.GetBinX(f+0.5);if((n!=null)&&!n(b)){continue}if(d){o=this.histo.fBinEntries[f+1];j+=this.histo.fArray[f+1];h+=this.histo.fSumw2[f+1]}else{o=this.histo.getBinContent(f+1)}if((g==null)||(o>m)){g=b;m=o}e+=o;k+=o*b;q+=o*b*b}var l={meanx:0,meany:0,rmsx:0,rmsy:0,integral:e,entries:this.stat_entries,xmax:0,wmax:0};if(e>0){l.meanx=k/e;l.meany=j/e;l.rmsx=Math.sqrt(q/e-l.meanx*l.meanx);l.rmsy=Math.sqrt(h/e-l.meany*l.meany)}if(g!=null){l.xmax=g;l.wmax=m}return l};JSROOT.TH1Painter.prototype.FillStatistic=function(g,h){if(!this.histo){return false}var f=this.CountStat();var l=Math.floor(h%10);var n=Math.floor(h/10)%10;var j=Math.floor(h/100)%10;var o=Math.floor(h/1000)%10;var b=Math.floor(h/10000)%10;var c=Math.floor(h/100000)%10;var d=Math.floor(h/1000000)%10;var i=Math.floor(h/10000000)%10;var e=Math.floor(h/100000000)%10;if(l>0){g.AddLine(this.histo.fName)}if(this.IsTProfile()){if(n>0){g.AddLine("Entries = "+JSROOT.gStyle.StatEntriesFormat(f.entries))}if(j>0){g.AddLine("Mean = "+JSROOT.gStyle.StatFormat(f.meanx));g.AddLine("Mean y = "+JSROOT.gStyle.StatFormat(f.meany))}if(o>0){g.AddLine("RMS = "+JSROOT.gStyle.StatFormat(f.rmsx));g.AddLine("RMS y = "+JSROOT.gStyle.StatFormat(f.rmsy))}}else{if(n>0){g.AddLine("Entries = "+JSROOT.gStyle.StatEntriesFormat(f.entries))}if(j>0){g.AddLine("Mean = "+JSROOT.gStyle.StatFormat(f.meanx))}if(o>0){g.AddLine("RMS = "+JSROOT.gStyle.StatFormat(f.rmsx))}if(b>0){var k=0;if(this.histo.fArray.length>0){k=this.histo.fArray[0]}g.AddLine("Underflow = "+JSROOT.gStyle.StatFormat(k))}if(c>0){var k=0;if(this.histo.fArray.length>0){k=this.histo.fArray[this.histo.fArray.length-1]}g.AddLine("Overflow = "+JSROOT.gStyle.StatFormat(k))}if(d>0){g.AddLine("Integral = "+JSROOT.gStyle.StatEntriesFormat(f.integral))}if(i>0){g.AddLine("Skew = not avail")}if(e>0){g.AddLine("Kurt = not avail")}}var m=g.pavetext.fLines.arr.length;var p=m*JSROOT.gStyle.StatFontSize;if(p<=0||3==(JSROOT.gStyle.StatFont%10)){p=0.25*m*JSROOT.gStyle.StatH;g.pavetext.fY1NDC=0.93-p;g.pavetext.fY2NDC=0.93}return true};JSROOT.TH1Painter.prototype.CreateDrawBins=function(o,m,q){var f=this.GetSelectIndex("x","left",-1);var u=this.GetSelectIndex("x","right",2);var c=new Array;var v=((JSROOT.gStyle.OptimizeDraw>0)&&(u-f>5000))||((JSROOT.gStyle.OptimizeDraw>1)&&(u-f>2*o));var t,s=this.GetBinX(f);var g=-1111,d=-1111,e;var p=null;var h=false;var k=this.main_painter();var w=this.GetItemName();if((w==null)||(w=="")){w=this.histo.fName}for(var r=f;r<u;r++){t=s;s=this.GetBinX(r+1);if(this.options.Logx&&(t<=0)){continue}g=d;d=k.grx(s);if(g<0){g=k.grx(t)}var l=r,b=this.histo.getBinContent(r+1);if(v){h=!h;while((r+1<u)&&(k.grx(this.GetBinX(r+2))<d+0.5)){r++;s=this.GetBinX(r+1);var j=this.histo.getBinContent(r+1);if(h?j>b:j<b){b=j;l=r}}d=k.grx(s)}if(q&&(b==0)){continue}if(this.options.Logy&&(b<this.scale_ymin)){e=m+10}else{e=k.gry(b)}p={x:g,y:e};if(this.options.Error>0){p.xerr=(d-g)/2;p.yerr=e-k.gry(b+this.histo.getBinError(l+1))}if(this.options.Error>0){p.x=(g+d)/2;p.tip=w+"\nx = "+this.AxisAsText("x",(t+s)/2)+"\ny = "+this.AxisAsText("y",b)+"\nerror x = "+((s-t)/2).toPrecision(4)+"\nerror y = "+this.histo.getBinError(l+1).toPrecision(4)}else{p.width=d-g;p.tip=w+"\nbin = "+(l+1)+"\nx = ["+this.AxisAsText("x",t)+", "+this.AxisAsText("x",s)+"]\nentries = "+b}c.push(p)}if((u==this.nbinsx)&&(this.options.Error==0)&&(p!=null)){var n=JSROOT.extend({},p);n.x=d;c.push(n)}return c};JSROOT.TH1Painter.prototype.DrawAsMarkers=function(g,c,e){var g=this.CreateDrawBins(c,e,this.IsTProfile()||(this.Mark==10));var d=this.draw_g.selectAll("g").data(g).enter().append("svg:g").attr("transform",function(h){return"translate("+h.x.toFixed(1)+","+h.y.toFixed(1)+")"});if(JSROOT.gStyle.Tooltip){d.append("svg:title").text(function(h){return h.tip})}var i=null,f=null;if(this.options.Error>0){d.append("svg:line").attr("x1",function(h){return(-h.xerr).toFixed(1)}).attr("y1",0).attr("x2",function(h){return h.xerr.toFixed(1)}).attr("y2",0).call(this.attline.func)}if(this.options.Error==11){d.append("svg:line").attr("y1",-3).attr("x1",function(h){return(-h.xerr).toFixed(1)}).attr("y2",3).attr("x2",function(h){return(-h.xerr).toFixed(1)}).call(this.attline.func);d.append("svg:line").attr("y1",-3).attr("x1",function(h){return h.xerr.toFixed(1)}).attr("y2",3).attr("x2",function(h){return h.xerr.toFixed(1)}).call(this.attline.func)}if(this.options.Error>0){d.append("svg:line").attr("x1",0).attr("y1",function(h){return(-h.yerr).toFixed(1)}).attr("x2",0).attr("y2",function(h){return h.yerr.toFixed(1)}).call(this.attline.func)}if(this.options.Error==11){d.append("svg:line").attr("x1",-3).attr("y1",function(h){return(-h.yerr).toFixed(1)}).attr("x2",3).attr("y2",function(h){return(-h.yerr).toFixed(1)}).call(this.attline.func);d.append("svg:line").attr("x1",-3).attr("y1",function(h){return h.yerr.toFixed(1)}).attr("x2",3).attr("y2",function(h){return h.yerr.toFixed(1)}).call(this.attline.func)}if((this.histo.fMarkerStyle==1)&&(this.options.Error>0)){return}var b=JSROOT.Painter.createAttMarker(this.histo);d.append("svg:path").call(b.func)};JSROOT.TH1Painter.prototype.DrawBins=function(){var d=this.frame_width(),b=this.frame_height();if(!this.draw_content||(d<=0)||(b<=0)){this.RemoveDrawG();return}this.RecreateDrawG();if(this.IsTProfile()||(this.options.Error>0)||(this.options.Mark>0)){return this.DrawAsMarkers(d,b)}var f=this.CreateDrawBins(d,b);if(this.fill.color!="none"){var e=d3.svg.area().x(function(g){return g.x.toFixed(1)}).y0(function(g){return g.y.toFixed(1)}).y1(function(g){return b}).interpolate("step-after");this.draw_g.append("svg:path").attr("d",e(f)).style("pointer-events","none").call(this.attline.func).call(this.fill.func)}else{var c=d3.svg.line().x(function(g){return g.x.toFixed(1)}).y(function(g){return g.y.toFixed(1)}).interpolate("step-after");this.draw_g.append("svg:path").attr("d",c(f)).call(this.attline.func).style("fill","none")}if(JSROOT.gStyle.Tooltip){this.draw_g.selectAll("selections").data(f).enter().append("svg:line").attr("x1",function(g){return g.x+g.width/2}).attr("y1",function(g){return Math.max(0,g.y)}).attr("x2",function(g){return g.x+g.width/2}).attr("y2",function(g){return b}).style("opacity",0).style("stroke","#4572A7").style("stroke-width",function(g){return g.width}).on("mouseover",function(){if(JSROOT.gStyle.Tooltip&&(d3.select(this).style("opacity")=="0")){d3.select(this).transition().duration(100).style("opacity","0.3")}}).on("mouseout",function(){d3.select(this).transition().duration(100).style("opacity","0")}).append("svg:title").text(function(g){return g.tip})}};JSROOT.TH1Painter.prototype.FillContextMenu=function(b){JSROOT.THistPainter.prototype.FillContextMenu.call(this,b);if(this.draw_content){b.add("Auto zoom-in",function(){b.painter.AutoZoom()})}};JSROOT.TH1Painter.prototype.AutoZoom=function(){var e=this.GetSelectIndex("x","left",-1);var c=this.GetSelectIndex("x","right",1);var f=(c-e);if(f==0){return}var b=this.histo.getBinContent(e+1);for(var d=e;d<c;d++){if(this.histo.getBinContent(d+1)<b){b=this.histo.getBinContent(d+1)}}if(b>0){return}while((e<c)&&(this.histo.getBinContent(e+1)<=b)){e++}while((e<c)&&(this.histo.getBinContent(c)<=b)){c--}if((c-e<f)&&(e<c)){this.Zoom(this.GetBinX(e),this.GetBinX(c),0,0)}};JSROOT.Painter.drawHistogram1D=function(e,c,d){var b=new JSROOT.TH1Painter(c);b.SetDivId(e,1);b.options=b.DecodeOptions(d);b.CheckPadOptions();b.ScanContent();b.CreateXY();b.DrawAxes();b.DrawGrids();b.DrawBins();if(b.create_canvas){b.DrawTitle()}if(JSROOT.gStyle.AutoStat&&b.create_canvas){b.CreateStat()}b.DrawFunctions();b.AddInteractive();if(b.options.AutoZoom){b.AutoZoom()}return b};JSROOT.TH2Painter=function(b){JSROOT.THistPainter.call(this,b);this.paletteColors=[]};JSROOT.TH2Painter.prototype=Object.create(JSROOT.THistPainter.prototype);JSROOT.TH2Painter.prototype.FillContextMenu=function(b){JSROOT.THistPainter.prototype.FillContextMenu.call(this,b);b.add("Auto zoom-in",function(){b.painter.AutoZoom()});b.add("Draw in 3D",function(){b.painter.Draw3D()});b.add("Toggle col",function(){if(b.painter.options.Color==0){b.painter.options.Color=JSROOT.gStyle.DefaultCol}else{b.painter.options.Color=-1*b.painter.options.Color}b.painter.RedrawPad()});if(this.options.Color>0){b.add("Toggle colz",function(){b.painter.ToggleColz()})}};JSROOT.TH2Painter.prototype.FindPalette=function(b){if("fFunctions" in this.histo){for(var c in this.histo.fFunctions.arr){var d=this.histo.fFunctions.arr[c];if(d._typename!="TPaletteAxis"){continue}if(b){this.histo.fFunctions.arr.splice(c,1);return null}return d}}return null};JSROOT.TH2Painter.prototype.ToggleColz=function(){if(this.FindPalette()==null){var b=this.CreatePalette(0.04);this.svg_frame().property("frame_painter").Shrink(0,b);this.options.Zscale=1;JSROOT.Painter.drawPaletteAxis(this.divid,this.FindPalette())}else{if(this.options.Zscale>0){this.options.Zscale=0}else{this.options.Zscale=1}}this.RedrawPad()};JSROOT.TH2Painter.prototype.AutoZoom=function(){var h=this.GetSelectIndex("x","left",-1);var g=this.GetSelectIndex("x","right",1);var r=this.GetSelectIndex("y","left",-1);var q=this.GetSelectIndex("y","right",1);if((h==g)||(r==q)){return}var l=this.histo.getBinContent(h+1,r+1);for(var o=h;o<g;o++){for(var m=r;m<q;m++){if(this.histo.getBinContent(o+1,m+1)<l){l=this.histo.getBinContent(o+1,m+1)}}}if(l>0){return}var e=g,d=h,b=q,k=r;for(var o=h;o<g;o++){for(var m=r;m<q;m++){if(this.histo.getBinContent(o+1,m+1)>l){if(o<e){e=o}if(o>=d){d=o+1}if(m<b){b=m}if(m>=k){k=m+1}}}}var c=0,n=0,p=0,f=0;if((e>h||d<g)&&(e<d-1)){c=this.GetBinX(e);n=this.GetBinX(d)}if((b>r||k<q)&&(b<k-1)){p=this.GetBinY(b);f=this.GetBinY(k)}this.Zoom(c,n,p,f)};JSROOT.TH2Painter.prototype.CreatePalette=function(n){if(this.FindPalette()!=null){return 0}if(!n||n<=0){n=0.04}var o={};o._typename="TPaletteAxis";o.fName="palette";o._AutoCreated=true;var m=this.svg_frame().property("NDC");o.fX1NDC=m.x2-n;o.fY1NDC=m.y1;o.fX2NDC=m.x2;o.fY2NDC=m.y2;o.fInit=1;o.fShadowColor=1;o.fCorenerRadius=0;o.fResizing=false;o.fBorderSize=4;o.fName="TPave";o.fOption="br";o.fLineColor=1;o.fLineSyle=1;o.fLineWidth=1;o.fFillColor=1;o.fFillSyle=1;var f={};f._typename="TGaxis";f.fTickSize=0.03;f.fLabelOffset=0.005;f.fLabelSize=0.035;f.fTitleOffset=1;f.fTitleSize=0.035;f.fNdiv=8;f.fLabelColor=1;f.fLabelFont=42;f.fChopt="";f.fName="";f.fTitle="";f.fTimeFormat="";f.fFunctionName="";f.fWmin=0;f.fWmax=100;f.fLineColor=1;f.fLineSyle=1;f.fLineWidth=1;f.fTextAngle=0;f.fTextSize=0.04;f.fTextAlign=11;f.fTextColor=1;f.fTextFont=42;o.fAxis=f;if(!"fFunctions" in this.histo){this.histo.fFunctions=JSROOT.Create("TList")}this.histo.fFunctions.arr.unshift(o);var c=this.frame_width(),p=this.frame_height();var k=Math.round(f.fLabelOffset*c);var h=Math.round(f.fTickSize*c);var b=JSROOT.Painter.getFontDetails(f.fLabelFont,f.fLabelSize*p);var l=d3.scale.linear().clamp(true).domain([this.minbin,this.maxbin]).range([p,0]).nice().ticks(f.fNdiv%100);var e=0;for(var g in l){var j=b.stringWidth(this.svg_frame(),l[g]);if(j>e){e=j}}var q=(e+k)/c;if(o.fX2NDC+q>0.98){var d=o.fX2NDC+q-0.98;o.fX1NDC-=d;o.fX2NDC-=d;n+=d}return n+0.01};JSROOT.TH2Painter.prototype.ScanContent=function(){this.fillcolor=JSROOT.Painter.root_colors[this.histo.fFillColor];this.attline=JSROOT.Painter.createAttLine(this.histo);if(this.attline.color=="none"){this.attline.color="#4572A7"}this.nbinsx=this.histo.fXaxis["fNbins"];this.nbinsy=this.histo.fYaxis["fNbins"];this.xmin=this.histo.fXaxis["fXmin"];this.xmax=this.histo.fXaxis["fXmax"];this.ymin=this.histo.fYaxis["fXmin"];this.ymax=this.histo.fYaxis["fXmax"];this.binwidthx=(this.xmax-this.xmin);if(this.nbinsx>0){this.binwidthx=this.binwidthx/this.nbinsx}this["GetBinX"]=function(e){return this.xmin+e*this.binwidthx};this.binwidthy=(this.ymax-this.ymin);if(this.nbinsy>0){this.binwidthy=this.binwidthy/this.nbinsy}this["GetBinY"]=function(e){return this.ymin+e*this.binwidthy};this.gmaxbin=this.histo.getBinContent(1,1);this.gminbin=this.gmaxbin;for(var c=0;c<this.nbinsx;++c){for(var b=0;b<this.nbinsy;++b){var d=this.histo.getBinContent(c+1,b+1);if(d<this.gminbin){this.gminbin=d}else{if(d>this.gmaxbin){this.gmaxbin=d}}}}this.draw_content=this.gmaxbin>0};JSROOT.TH2Painter.prototype.CountStat=function(h){var d=0,g=0,p=0,f=0,o=0,i=0;var v={entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[],xmax:0,ymax:0,wmax:null};for(var m=0;m<9;m++){v.matrix.push(0)}var c=this.GetSelectIndex("x","left");var l=this.GetSelectIndex("x","right");var s=this.GetSelectIndex("y","left");var r=this.GetSelectIndex("y","right");for(var k=0;k<=this.nbinsx+1;k++){var b=(k<=c)?0:(k>l?2:1);var e=this.GetBinX(k-0.5);for(var u=0;u<=this.nbinsx+1;u++){var q=(u<=s)?0:(u>r?2:1);var j=this.ymin+(u-0.5)*this.binwidthy;var t=this.histo.getBinContent(k,u);v.entries+=t;v.matrix[q*3+b]+=t;if((b!=1)||(q!=1)){continue}if((h!=null)&&!h(e,j)){continue}if((v.wmax==null)||(t>v.wmax)){v.wmax=t;v.xmax=e;v.ymax=j}d+=t;g+=e*t;p+=j*t;f+=e*e*t;o+=j*j*t;i+=e*j*t}}if(d>0){v.meanx=g/d;v.meany=p/d;v.rmsx=Math.sqrt(f/d-v.meanx*v.meanx);v.rmsy=Math.sqrt(o/d-v.meany*v.meany)}if(v.wmax==null){v.wmax=0}v.integral=d;return v};JSROOT.TH2Painter.prototype.FillStatistic=function(h,i){if(!this.histo){return false}var g=this.CountStat();var l=Math.floor(i%10);var o=Math.floor(i/10)%10;var k=Math.floor(i/100)%10;var p=Math.floor(i/1000)%10;var b=Math.floor(i/10000)%10;var c=Math.floor(i/100000)%10;var e=Math.floor(i/1000000)%10;var j=Math.floor(i/10000000)%10;var f=Math.floor(i/100000000)%10;if(l>0){h.AddLine(this.histo.fName)}if(o>0){h.AddLine("Entries = "+JSROOT.gStyle.StatEntriesFormat(g.entries))}if(k>0){h.AddLine("Mean x = "+JSROOT.gStyle.StatFormat(g.meanx));h.AddLine("Mean y = "+JSROOT.gStyle.StatFormat(g.meany))}if(p>0){h.AddLine("RMS x = "+JSROOT.gStyle.StatFormat(g.rmsx));h.AddLine("RMS y = "+JSROOT.gStyle.StatFormat(g.rmsy))}if(e>0){h.AddLine("Integral = "+JSROOT.gStyle.StatEntriesFormat(g.matrix[4]))}if(j>0){h.AddLine("Skewness x = <undef>");h.AddLine("Skewness y = <undef>")}if(f>0){h.AddLine("Kurt = <undef>")}if((b>0)||(c>0)){var d=g.matrix;h.AddLine(""+d[6].toFixed(0)+" | "+d[7].toFixed(0)+" | "+d[7].toFixed(0));h.AddLine(""+d[3].toFixed(0)+" | "+d[4].toFixed(0)+" | "+d[5].toFixed(0));h.AddLine(""+d[0].toFixed(0)+" | "+d[1].toFixed(0)+" | "+d[2].toFixed(0))}var n=h.pavetext.fLines.arr.length;var q=n*JSROOT.gStyle.StatFontSize;if(q<=0||3==(JSROOT.gStyle.StatFont%10)){q=0.25*n*JSROOT.gStyle.StatH;h.pavetext.fY1NDC=0.93-q;h.pavetext.fY2NDC=0.93}return true};JSROOT.TH2Painter.prototype.getValueColor=function(m){var l=this.minbin,n=this.maxbin;var e=l,j=n;var k=this.histo.fContour.length;if(k<16){k=16}var u=k/(j-e);if(this.options.Logz){if(l<=0&&n>0){l=Math.min(1,0.001*n)}e=Math.log(l)/Math.log(10);j=Math.log(n)/Math.log(10)}if(this.paletteColors.length==0){var g=1,t=0.5,o=280,c=0,h=50;for(var q=0;q<h;q++){var f=(o-(q+1)*((o-c)/h))/360;var d=JSROOT.Painter.HLStoRGB(f,t,g);this.paletteColors.push(d)}}if(this.options.Logz){m=Math.log(m)/Math.log(10)}if(m<e){m=e}var r=this.paletteColors.length;var p=Math.round(0.01+(m-e)*u);var b=Math.round((p+0.99)*r/k)-1;var s=b%r;if(s<0){s=0}return this.paletteColors[s]};JSROOT.TH2Painter.prototype.CreateDrawBins=function(n,z,g,B){var t=this.GetSelectIndex("x","left",0);var r=this.GetSelectIndex("x","right",0);var c=this.GetSelectIndex("y","left",0);var b=this.GetSelectIndex("y","right",0);var C,e,A,d,k,q,f,p,l,E,D,o,s,G,F;this.maxbin=this.minbin=this.histo.getBinContent(t+1,c+1);for(var v=t;v<r;v++){for(var u=c;u<b;u++){o=this.histo.getBinContent(v+1,u+1);if(o>this.maxbin){this.maxbin=o}else{if(o<this.minbin){this.minbin=o}}}}var m=1,y=1;if(g==1){m=0.5*n/(r-t)/(this.maxbin-this.minbin);y=0.5*z/(b-c)/(this.maxbin-this.minbin)}var x=new Array;A=this.GetBinX(t);f=-11111;for(var v=t;v<r;v++){C=A;A=this.GetBinX(v+1);if(this.options.Logx&&(C<=0)){continue}k=f;if(k<0){k=this.grx(C)}f=this.grx(A);d=this.GetBinY(c);p=-1111;for(var u=c;u<b;u++){e=d;d=this.GetBinY(u+1);if(this.options.Logy&&(e<=0)){continue}q=p;if(q<0){q=this.gry(e)}p=this.gry(d);o=this.histo.getBinContent(v+1,u+1);if((o==0)||(o<this.minbin)){continue}switch(g){case 0:s={x:k,y:p,width:f-k+1,height:q-p+1,stroke:"none",fill:this.getValueColor(o)};s.tipcolor=(s.fill=="black")?"grey":"black";break;case 1:E=m*(this.maxbin-o);D=y*(this.maxbin-o);s={x:k+E,y:p+D,width:f-k-2*E,height:q-p-2*D,stroke:this.attline.color,fill:this.fillcolor};s.tipcolor=(s.fill=="black")?"grey":"black";break;case 2:s={x:(C+A)/2,y:(e+d)/2,z:o};break}if(B==1){s.tip="x = ["+this.AxisAsText("x",C)+", "+this.AxisAsText("x",A)+"]\ny = ["+this.AxisAsText("y",e)+", "+this.AxisAsText("y",d)+"]\nentries = "+o}else{if(B==2){s.tip="x = "+this.AxisAsText("x",C)+"\ny = "+this.AxisAsText("y",e)+"\nentries = "+o}}x.push(s)}}return x};JSROOT.TH2Painter.prototype.DrawSimpleCanvas=function(m,x){var t=this.GetSelectIndex("x","left",0);var s=this.GetSelectIndex("x","right",0);var d=this.GetSelectIndex("y","left",0);var b=this.GetSelectIndex("y","right",0);this.maxbin=this.minbin=this.histo.getBinContent(t+1,d+1);for(var v=t;v<s;v++){for(var u=d;u<b;u++){binz=this.histo.getBinContent(v+1,u+1);if(binz>this.maxbin){this.maxbin=binz}else{if(binz<this.minbin){this.minbin=binz}}}}var n=s-t,l=b-d;var k=this.draw_g.append("foreignObject").attr("width",m).attr("height",x);this.SetForeignObjectPosition(k,0,0);var f=k.append("xhtml:canvas").attr("width",n).attr("height",l).attr("style","width: "+m+"px; height: "+x+"px");var e=f.node().getContext("2d");var o=e.createImageData(n,l);var r=-1;for(var u=b-1;u>=d;u--){for(var v=t;v<s;v++){var q=this.histo.getBinContent(v+1,u+1);var g=q>this.minbin?this.getValueColor(q):"white";var y=d3.rgb(g);o.data[++r]=y.r;o.data[++r]=y.g;o.data[++r]=y.b;o.data[++r]=255}}e.putImageData(o,0,0)};JSROOT.TH2Painter.prototype.DrawNormalCanvas=function(c,k){var j=this.CreateDrawBins(c,k,0,0);var g=this.draw_g.append("foreignObject").attr("width",c).attr("height",k);this.SetForeignObjectPosition(g,0,0);var d=g.append("xhtml:canvas").attr("width",c).attr("height",k);var b=d.node().getContext("2d");for(var f in j){var e=j[f];b.fillStyle=e.fill;b.fillRect(e.x,e.y,e.width,e.height)}b.stroke()};JSROOT.TH2Painter.prototype.DrawBins=function(){this.RecreateDrawG();var k=this.frame_width(),i=this.frame_height();if((this.options.Color==2)&&!JSROOT.browser.isIE){return this.DrawSimpleCanvas(k,i)}if((this.options.Color==3)&&!JSROOT.browser.isIE){return this.DrawNormalCanvas(k,i)}var f=(this.options.Scat>0&&this.histo.fMarkerStyle>1);var d=(this.options.Color>0)||f;var j=0;if(JSROOT.gStyle.Tooltip){j=f?2:1}var c=this.CreateDrawBins(k,i,d?0:1,j);if(f){var g=JSROOT.Painter.createAttMarker(this.histo);var e=this.draw_g.selectAll(".marker").data(c).enter().append("svg:path").attr("class","marker").attr("transform",function(h){return"translate("+h.x.toFixed(1)+","+h.y.toFixed(1)+")"}).call(g.func);if(JSROOT.gStyle.Tooltip){e.append("svg:title").text(function(h){return h.tip})}}else{var b=this.draw_g.selectAll(".bins").data(c).enter().append("svg:rect").attr("class","bins").attr("x",function(h){return h.x.toFixed(1)}).attr("y",function(h){return h.y.toFixed(1)}).attr("width",function(h){return h.width.toFixed(1)}).attr("height",function(h){return h.height.toFixed(1)}).style("stroke",function(h){return h.stroke}).style("fill",function(h){this["f0"]=h.fill;this["f1"]=h.tipcolor;return h.fill});if(JSROOT.gStyle.Tooltip){b.on("mouseover",function(){if(JSROOT.gStyle.Tooltip){d3.select(this).transition().duration(100).style("fill",this["f1"])}}).on("mouseout",function(){d3.select(this).transition().duration(100).style("fill",this["f0"])}).append("svg:title").text(function(h){return h.tip})}}delete c};JSROOT.TH2Painter.prototype.Draw2D=function(){if(this.options.Lego>0){this.options.Lego=0}if(this["done2d"]){return}if((this.FindPalette()==null)&&this.create_canvas&&(this.options.Zscale>0)){var b=this.CreatePalette(0.04);this.svg_frame().property("frame_painter").Shrink(0,b);this.svg_frame().property("frame_painter").Redraw();this.CreateXY()}else{if(this.options.Zscale==0){this.FindPalette(true)}}if(JSROOT.gStyle.AutoStat&&this.create_canvas){this.CreateStat()}this.DrawAxes();this.DrawGrids();this.DrawBins();if(this.create_canvas){this.DrawTitle()}this.DrawFunctions();this.AddInteractive();if(this.options.AutoZoom){this.AutoZoom()}this["done2d"]=true};JSROOT.TH2Painter.prototype.Draw3D=function(){if(this.options.Lego<=0){this.options.Lego=1}var b=this;JSROOT.AssertPrerequisites("3d",function(){JSROOT.Painter.real_drawHistogram2D(b)})};JSROOT.Painter.drawHistogram2D=function(e,c,d){var b=new JSROOT.TH2Painter(c);b.SetDivId(e,1);b.options=b.DecodeOptions(d);b.CheckPadOptions();b.ScanContent();b.CreateXY();if(b.options.Lego>0){b.Draw3D()}else{b.Draw2D()}return b};JSROOT.Painter.drawHistogram3D=function(d,c,b){JSROOT.AssertPrerequisites("3d",function(){JSROOT.Painter.real_drawHistogram3D(d,c,b)})};JSROOT.THStackPainter=function(b){JSROOT.TObjectPainter.call(this,b);this.stack=b;this.nostack=false;this.firstpainter=null;this.painters=new Array};JSROOT.THStackPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.THStackPainter.prototype.GetObject=function(){return this.stack};JSROOT.THStackPainter.prototype.drawStack=function(c){var f=this.root_pad();var k=this.stack.fHists;var r=k.arr.length;if(c==null){c=""}else{c=c.toLowerCase()}var j=false;if(c.indexOf("same")!=-1){j=true;c.replace("same","")}var m,n;var b=0,l=0,p=0,e=0;for(var m=0;m<r;++m){n=k.arr[m];if(m==0||n.fXaxis["fXmin"]<b){b=n.fXaxis["fXmin"]}if(m==0||n.fXaxis["fXmax"]>l){l=n.fXaxis["fXmax"]}if(m==0||n.fYaxis["fXmin"]<p){p=n.fYaxis["fXmin"]}if(m==0||n.fYaxis["fXmax"]>e){e=n.fYaxis["fXmax"]}}this.nostack=c.indexOf("nostack")==-1?false:true;if(!this.nostack){this.stack.buildStack()}var o,q;if(this.stack.fMaximum==-1111){q=this.stack.getMaximum(c)}else{q=this.stack.fMaximum}if(this.stack.fMinimum==-1111){o=this.stack.getMinimum(c);if(f&&f.fLogy){if(o>0){o*=0.9}else{o=q*0.001}}else{if(o>0){o=0}}}else{o=this.stack.fMinimum}if(!("fHistogram" in this.stack)){n=this.stack.fHists.arr[0];this.stack.fHistogram=JSROOT.Create("TH1I");this.stack.fHistogram["fName"]="unnamed";this.stack.fHistogram["fXaxis"]=JSROOT.clone(n.fXaxis);this.stack.fHistogram["fYaxis"]=JSROOT.clone(n.fYaxis);this.stack.fHistogram["fXaxis"]["fXmin"]=b;this.stack.fHistogram["fXaxis"]["fXmax"]=l;this.stack.fHistogram["fYaxis"]["fXmin"]=p;this.stack.fHistogram["fYaxis"]["fXmax"]=e}this.stack.fHistogram["fTitle"]=this.stack.fTitle;var g=this.stack.fHistogram;if(!g.TestBit(JSROOT.TH1StatusBits.kIsZoomed)){if(this.nostack&&this.stack.fMaximum!=-1111){g.fMaximum=this.stack.fMaximum}else{if(f&&f.fLogy){g.fMaximum=q*(1+0.2*JSROOT.Math.log10(q/o))}else{g.fMaximum=1.05*q}}if(this.nostack&&this.stack.fMinimum!=-1111){g.fMinimum=this.stack.fMinimum}else{if(f&&f.fLogy){g.fMinimum=o/(1+0.5*JSROOT.Math.log10(q/o))}else{g.fMinimum=o}}}if(!j){var s=g.fOption;if((c!="")&&(s.indexOf(c)==-1)){s+=c}if(g._typename.match(/^TH1/)){this.firstpainter=JSROOT.Painter.drawHistogram1D(this.divid,g,s)}else{if(g._typename.match(/^TH2/)){this.firstpainter=JSROOT.Painter.drawHistogram2D(this.divid,g,s)}}}for(var m=0;m<r;++m){if(this.nostack){n=k.arr[m]}else{n=this.stack.fStack.arr[r-m-1]}var s=n.fOption;if((c!="")&&(s.indexOf(c)==-1)){s+=c}s+="same";if(n._typename.match(/^TH1/)){var d=JSROOT.Painter.drawHistogram1D(this.divid,n,s);this.painters.push(d)}}};JSROOT.THStackPainter.prototype.UpdateObject=function(g){var f=false;if(this.firstpainter){if(this.firstpainter.UpdateObject(g.fHistogram)){f=true}}var c=g.fHists;var b=c.arr.length;for(var d=0;d<b;++d){var e=null;if(this.nostack){e=c.arr[d]}else{e=g.fStack.arr[b-d-1]}if(this.painters[d].UpdateObject(e)){f=true}}return f};JSROOT.Painter.drawHStack=function(e,b,d){if(!"fHists" in b){return}if(b.fHists.arr.length==0){return}var c=new JSROOT.THStackPainter(b);c.SetDivId(e);c.drawStack(d);return c};JSROOT.TLegendPainter=function(b){JSROOT.TObjectPainter.call(this,b);this.legend=b};JSROOT.TLegendPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TLegendPainter.prototype.GetObject=function(){return this.legend};JSROOT.TLegendPainter.prototype.drawLegend=function(){this.RecreateDrawG(true,".text_layer");var u=this.svg_pad();var l=this.legend;var n=0,m=0,q=0,B=0;if(l.fInit==0){n=l.fX1*Number(u.attr("width"));m=Number(u.attr("height"))-l.fY1*Number(u.attr("height"));q=(l.fX2-l.fX1)*Number(u.attr("width"));B=(l.fY2-l.fY1)*Number(u.attr("height"))}else{n=l.fX1NDC*Number(u.attr("width"));m=Number(u.attr("height"))-l.fY1NDC*Number(u.attr("height"));q=(l.fX2NDC-l.fX1NDC)*Number(u.attr("width"));B=(l.fY2NDC-l.fY1NDC)*Number(u.attr("height"))}m-=B;var C=l.fBorderSize?l.fBorderSize:0;var z=this.createAttFill(l);var F=JSROOT.Painter.createAttLine(l,C);var t=l.fPrimitives.arr.length;this.draw_g.attr("x",n).attr("y",m).attr("width",q).attr("height",B).attr("transform","translate("+n+","+m+")");this.StartTextDrawing(l.fTextFont,B/(t*1.2));this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",q).attr("height",B).call(z.func).style("stroke-width",C?1:0).style("stroke",F.color);var H=JSROOT.Painter.root_colors[l.fTextColor];var g=Math.round(l.fMargin*q);var s=Math.round(0.03*q);var r=Math.round(0.03*B);var o=this;var p=(B-2*r)/t;for(var A=0;A<t;++A){var D=l.fPrimitives.arr[A];var e=D.fOption.toLowerCase();var b=Math.round(r+A*p);var G=Math.round(r+(A+0.5)*p);var j=D;var E=D;var d=D;var v=D.fObject;if((v!=null)&&(typeof v=="object")){if("fLineColor" in v){d=v}if("fFillColor" in v){j=v}if("fMarkerColor" in v){E=v}}var z=this.createAttFill(j);var f=JSROOT.Painter.createAttLine(d);if(e.indexOf("f")!=-1){this.draw_g.append("svg:rect").attr("x",s).attr("y",Math.round(b+p*0.1)).attr("width",g-2*s).attr("height",Math.round(p*0.8)).call(f.func).call(z.func)}if(e.indexOf("l")!=-1){this.draw_g.append("svg:line").attr("x1",s).attr("y1",G).attr("x2",g-s).attr("y2",G).call(f.func)}if(e.indexOf("e")!=-1&&(e.indexOf("l")==-1||e.indexOf("f")!=-1)){}if(e.indexOf("p")!=-1){var k=JSROOT.Painter.createAttMarker(E);this.draw_g.append("svg:path").attr("transform",function(h){return"translate("+g/2+","+G+")"}).call(k.func)}var c=g;if((e.indexOf("h")>=0)||(e.length==0)){c=s}this.DrawText("start",c,b,q-c-s,p,D.fLabel,H)}this.FinishTextDrawing();if(C&&C>1){this.draw_g.append("svg:line").attr("x1",q+(C/2)).attr("y1",C+1).attr("x2",q+(C/2)).attr("y2",B+C-1).call(F.func);this.draw_g.append("svg:line").attr("x1",C+1).attr("y1",B+(C/2)).attr("x2",q+C-1).attr("y2",B+(C/2)).call(F.func)}this.AddDrag({obj:l,redraw:"drawLegend"})};JSROOT.TLegendPainter.prototype.Redraw=function(){this.drawLegend()};JSROOT.Painter.drawLegend=function(e,d,c){var b=new JSROOT.TLegendPainter(d);b.SetDivId(e);b.Redraw();return b};JSROOT.TMultiGraphPainter=function(b){JSROOT.TObjectPainter.call(this,b);this.mgraph=b;this.firstpainter=null;this.painters=new Array};JSROOT.TMultiGraphPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TMultiGraphPainter.prototype.GetObject=function(){return this.mgraph};JSROOT.TMultiGraphPainter.prototype.UpdateObject=function(f){if((f==null)||(f._typename!="TMultiGraph")){return false}var c=f.fHistogram;var b=f.fGraphs;var e=false;if(this.firstpainter&&c){if(this.firstpainter.UpdateObject(c)){e=true}}for(var d in b.arr){if(d>=this.painters.length){break}if(this.painters[d].UpdateObject(b.arr[d])){e=true}}return e};JSROOT.TMultiGraphPainter.prototype.drawMultiGraph=function(b){var t,p,y=0,c=0,f=0,g=0,s=0,u=0,m,l;var n=this.mgraph.fHistogram;var k=this.mgraph.fGraphs;var j=1,h=1;var x=false,w=false;var d=true;var v=this.root_pad();if(v!=null){y=v.fUxmin;c=v.fUxmax;f=v.fUymin;g=v.fUymax;x=v.fLogx;w=v.fLogy}if(n!=null){p=n.fYaxis["fXmin"];t=n.fYaxis["fXmax"];if(v){s=JSROOT.Painter.padtoX(v,y);u=JSROOT.Painter.padtoX(v,c)}}else{for(var q=0;q<k.arr.length;++q){var o=k.arr[q].ComputeRange();if((q==0)||(o.xmin<y)){y=o.xmin}if((q==0)||(o.ymin<f)){f=o.ymin}if((q==0)||(o.xmax>c)){c=o.xmax}if((q==0)||(o.ymax>g)){g=o.ymax}}if(y==c){c+=1}if(f==g){g+=1}m=0.05*(c-y);l=0.05*(g-f);s=y-m;u=c+m;if(w){if(f<=0){f=0.001*g}p=f/(1+0.5*JSROOT.Math.log10(g/f));t=g*(1+0.2*JSROOT.Math.log10(g/f))}else{p=f-l;t=g+l}if(p<0&&f>=0){p=0}if(t>0&&g<=0){t=0}}if(this.mgraph.fMinimum!=-1111){f=p=this.mgraph.fMinimum}if(this.mgraph.fMaximum!=-1111){g=t=this.mgraph.fMaximum}if(s<0&&y>=0){if(x){s=0.9*y}}if(u>0&&c<=0){if(x){u=1.1*c}}if(p<0&&f>=0){if(w){p=0.9*f}}if(t>0&&g<=0){if(w){t=1.1*g}}if(p<=0&&w){p=0.001*t}if(s<=0&&x){if(u>1000){s=1}else{s=0.001*u}}f=p;g=t;if(n!=null){n.fYaxis["fXmin"]=f;n.fYaxis["fXmax"]=g}if(!n){n=JSROOT.Create("TH1I");n.fXaxis["fXmin"]=y;n.fXaxis["fXmax"]=c;n.fYaxis["fXmin"]=f;n.fYaxis["fXmax"]=g}this.firstpainter=JSROOT.Painter.drawHistogram1D(this.divid,n);for(var q in k.arr){var e=JSROOT.Painter.drawGraph(this.divid,k.arr[q]);this.painters.push(e)}};JSROOT.Painter.drawMultiGraph=function(e,d,c){var b=new JSROOT.TMultiGraphPainter(d);b.SetDivId(e);b.drawMultiGraph(c);return b};JSROOT.TTextPainter=function(b){JSROOT.TObjectPainter.call(this,b);this.text=b};JSROOT.TTextPainter.prototype=Object.create(JSROOT.TObjectPainter.prototype);JSROOT.TTextPainter.prototype.GetObject=function(){return this.text};JSROOT.TTextPainter.prototype.drawPaveLabel=function(){this.RecreateDrawG(true,".text_layer");var g=this.text;var i=this.pad_width(),p=this.pad_height();var c=g.fX1NDC*i;var b=(1-g.fY1NDC)*p;var n=Math.abs(g.fX2NDC-g.fX1NDC)*i;var l=Math.abs(g.fY2NDC-g.fY1NDC)*p;b-=l;var d=this.createAttFill(g);var t=JSROOT.Painter.root_colors[g.fTextColor];var q=JSROOT.Painter.root_colors[g.fShadowColor];var o="start",j=Math.round(g.fTextAlign/10);var k="bottom",e=g.fTextAlign%10;if(j==1){o="start"}else{if(j==2){o="middle"}else{if(j==3){o="end"}}}if(e==1){k="bottom"}else{if(e==2){k="middle"}else{if(e==3){k="top"}}}var r=g.fBorderSize?g.fBorderSize:0;var s=JSROOT.Painter.createAttLine(g,r);var f=this.draw_g.attr("x",c).attr("y",b).attr("width",n).attr("height",l).attr("transform","translate("+c+","+b+")");f.append("svg:rect").attr("x",0).attr("y",0).attr("width",n).attr("height",l).call(d.func).style("stroke-width",r?1:0).style("stroke",s.color);this.StartTextDrawing(g.fTextFont,l/1.7);this.DrawText(o,0.02*n,0,0.96*n,l,g.fLabel,t);this.FinishTextDrawing();if(r&&r>1){f.append("svg:line").attr("x1",n+(r/2)).attr("y1",r+1).attr("x2",n+(r/2)).attr("y2",l+r-1).call(s.func);f.append("svg:line").attr("x1",r+1).attr("y1",l+(r/2)).attr("x2",n+r-1).attr("y2",l+(r/2)).call(s.func)}var m=this;this.AddDrag({obj:g,redraw:"drawPaveLabel"})};JSROOT.TTextPainter.prototype.drawText=function(){var j=JSROOT.BIT(14);var g=this.pad_width(),f=this.pad_height(),e=true;var c=this.text.fX,l=this.text.fY;if(this.text.TestBit(j)){c=c*g;l=(1-l)*f}else{if(this.main_painter()!=null){g=this.frame_width();f=this.frame_height();e=false;c=this.main_painter().grx(c);l=this.main_painter().gry(l)}else{if(this.root_pad()!=null){var d=this.root_pad();if(d.fLogx){c=(c>0)?JSROOT.Math.log10(c):d.fUxmin}if(d.fLogy){l=(l>0)?JSROOT.Math.log10(l):d.fUymin}c=((Math.abs(d.fX1)+c)/(d.fX2-d.fX1))*g;l=(1-((Math.abs(d.fY1)+l)/(d.fY2-d.fY1)))*f}else{console.log("Cannot draw text at x/y coordinates without real TPad object");c=g/2;l=f/2}}}this.RecreateDrawG(e,e?".text_layer":".upper_layer",true);var i=JSROOT.Painter.root_colors[this.text.fTextColor];var b=0,k=1;if(this.text._typename=="TLatex"){b=1;k=0.9}else{if(this.text._typename=="TMathText"){b=2;k=0.8}}this.StartTextDrawing(this.text.fTextFont,this.text.fTextSize*Math.min(g,f)*k);this.DrawText(this.text.fTextAlign,c,l,0,0,this.text.fTitle,i,b);this.FinishTextDrawing()};JSROOT.TTextPainter.prototype.UpdateObject=function(b){if(this.text._typename!=b._typename){return false}if(this.text._typename=="TPaveLabel"){this.text.fLabel=b.fLabel}else{this.text.fTitle=b.fTitle}return true};JSROOT.TTextPainter.prototype.Redraw=function(){if(this.text._typename=="TPaveLabel"){this.drawPaveLabel()}else{this.drawText()}};JSROOT.Painter.drawText=function(d,c){var b=new JSROOT.TTextPainter(c);b.SetDivId(d);b.Redraw();return b};JSROOT.Painter.drawStreamerInfo=function(d,c){d3.select("#"+d).style("overflow","auto");var b=new JSROOT.HierarchyPainter("sinfo",d);b.ShowStreamerInfo(c);return b};JSROOT.RawTextPainter=function(b){JSROOT.TBasePainter.call(this);this.txt=b;return this};JSROOT.RawTextPainter.prototype=Object.create(JSROOT.TBasePainter.prototype);JSROOT.RawTextPainter.prototype.RedrawObject=function(b){this.txt=b;this.Draw();return true};JSROOT.RawTextPainter.prototype.Draw=function(){var g=d3.select("#"+this.divid);var c=this.txt.value;if(c==null){c="<undefined>"}var f="mathjax" in this.txt;if(!f&&!("as_is" in this.txt)){var b=c.split("\n");c="";for(var e in b){c+="<pre>"+b[e]+"</pre>"}}g.html("<div style='overflow:hidden'>"+c+"</div>");this.SetDivId(this.divid);if(f){if(this["loading_mathjax"]){return}this["loading_mathjax"]=true;var d=this;JSROOT.AssertPrerequisites("mathjax",function(){d.loading_mathjax=false;if(typeof MathJax=="object"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,g.node()])}})}};JSROOT.Painter.drawRawText=function(e,b,d){var c=new JSROOT.RawTextPainter(b);c.SetDivId(e);c.Draw();return c};JSROOT.HierarchyPainter=function(b,c){JSROOT.TBasePainter.call(this);this.name=b;this.frameid=c;this.h=null;this.files_monitoring=(c==null)};JSROOT.HierarchyPainter.prototype=Object.create(JSROOT.TBasePainter.prototype);JSROOT.HierarchyPainter.prototype.Cleanup=function(){this.clear(true)};JSROOT.HierarchyPainter.prototype.ListHierarchy=function(e,b){e._childs=[];for(var c in b.arr){var f=b.arr[c];var d={_name:f.fName,_kind:"ROOT."+f._typename,_readobj:f};e._childs.push(d)}};JSROOT.HierarchyPainter.prototype.StreamerInfoHierarchy=function(h,b){h._childs=[];for(var d in b.arr){var g=b.arr[d];if(typeof(g.fName)=="undefined"){console.log("strange element in StreamerInfo with name "+g.fName);continue}var f={_name:g.fName,_kind:"",_childs:[]};h._childs.push(f);f._childs.push({_name:"Checksum: "+g.fCheckSum});f._childs.push({_name:"Class version: "+g.fClassVersion});if(g.fTitle!=""){f._childs.push({_name:"Title: "+g.fTitle})}if(typeof g.fElements=="undefined"){continue}for(var c in g.fElements["arr"]){var e=g.fElements["arr"][c];if((e==null)||(typeof(e.fName)=="undefined")){continue}var j=e.fTypeName+" "+e.fName+";";if(e.fTitle!=""){j+=" // "+e.fTitle}f._childs.push({_name:j})}}};JSROOT.HierarchyPainter.prototype.TreeHierarchy=function(g,k){g._childs=[];for(var e in k.fBranches.arr){var f=k.fBranches.arr[e];var b=f.fLeaves.arr.length;if(b==1&&f.fLeaves.arr[0]["fName"]==f.fName){b=0}var c={_name:f.fName,_kind:b>0?"ROOT.TBranch":"ROOT.TLeafF"};g._childs.push(c);if(b>0){c._childs=[];for(var d=0;d<b;++d){var h={_name:f.fLeaves.arr[d]["fName"],_kind:"ROOT.TLeafF"};c._childs.push(h)}}}};JSROOT.HierarchyPainter.prototype.KeysHierarchy=function(b,j,d,f){b._childs=[];var g=this;for(var e in j){var h=j[e];var k={_name:h.fName+";"+h.fCycle,_kind:"ROOT."+h.fClassName,_title:h.fTitle,_keyname:h.fName,_readobj:null,_parent:b};if("fRealName" in h){k._realname=h.fRealName+";"+h.fCycle}if((h.fClassName=="TTree"||h.fClassName=="TNtuple")){k._more=true;k._expand=function(i,l){g.TreeHierarchy(i,l);return true}}else{if(h.fClassName=="TDirectory"||h.fClassName=="TDirectoryFile"){var c=null;if((f!=null)&&(d!=null)){c=d.GetDir(f+h.fName)}k._isdir=true;if(c==null){k._more=true;k._expand=function(i,l){g.KeysHierarchy(i,l.fKeys);return true}}else{k._name=h.fName;g.KeysHierarchy(k,c.fKeys,d,f+h.fName+"/")}}else{if((h.fClassName=="TList")&&(h.fName=="StreamerInfo")){k._name="StreamerInfo";k._kind="ROOT.TStreamerInfoList";k._title="List of streamer infos for binary I/O";k._readobj=d.fStreamerInfos}else{if(h.fClassName=="TList"||h.fClassName=="TObjArray"||h.fClassName=="TClonesArray"){k._more=true;k._expand=function(i,l){g.ListHierarchy(i,l);return true}}}}}b._childs.push(k)}};JSROOT.HierarchyPainter.prototype.FileHierarchy=function(c){var b=this;var d={_name:c.fFileName,_kind:"ROOT.TFile",_file:c,_fullurl:c.fFullURL,_had_direct_read:false,_get:function(f,i,h){var e=this;if((f!=null)&&(f._readobj!=null)){return JSROOT.CallBack(h,f,f._readobj)}if(f!=null){i=b.itemFullName(f,e)}function g(j){if(e._file==null){e._file=j}if(j==null){return JSROOT.CallBack(h,f,null)}j.ReadObject(i,function(n){if((f==null)&&(n!=null)){var k=b.Find({name:i,top:e,last_exists:true,check_keys:true});if((k!=null)&&(k!=e)){var l=j.GetDir(b.itemFullName(k,e));if(l){k._name=k._keyname;var m=b.itemFullName(k,e);b.KeysHierarchy(k,l.fKeys,j,m+"/")}}else{b.KeysHierarchy(e,j.fKeys,j,"")}f=b.Find({name:i,top:e})}if(f!=null){f._readobj=n;if("_expand" in f){f._name=f._keyname}}JSROOT.CallBack(h,f,n)})}if(e._file!=null){g(e._file)}else{new JSROOT.TFile(e._fullurl,g)}}};this.KeysHierarchy(d,c.fKeys,c,"");return d};JSROOT.HierarchyPainter.prototype.ForEach=function(d,c){if(c==null){c=this.h}if((c==null)||(typeof d!="function")){return}function b(e){d(e);if("_childs" in e){for(var f in e._childs){e._childs[f]._parent=e;b(e._childs[f])}}}b(c)};JSROOT.HierarchyPainter.prototype.Find=function(b){function c(j,f){if(!f||f.length==0){return j}var m=-1;function k(i){i._parent=j;if((m+1==f.length)||(m<0)){return i}return c(i,f.substr(m+1))}do{m=f.indexOf("/",m+1);var h=(m<0)?f:f.substr(0,m);for(var g in j._childs){if(j._childs[g]._name==h){return k(j._childs[g])}}if("check_keys" in b){for(var g in j._childs){if(j._childs[g]._name.indexOf(h+";")==0){return k(j._childs[g])}}}if("force" in b){if(!("_childs" in j)){j._childs=[]}var l={_name:h};j._childs.push(l);return k(l)}}while(m>0);return("last_exists" in b)?j:null}var d=this.h;var e="";if(typeof b=="string"){e=b;b={}}else{if(typeof b=="object"){e=b.name;if("top" in b){d=b.top}}else{return null}}return c(d,e)};JSROOT.HierarchyPainter.prototype.itemFullName=function(c,d){var b="";while("_parent" in c){if(b.length>0){b="/"+b}b=c._name+b;c=c._parent;if((d!=null)&&(c==d)){break}}return b};JSROOT.HierarchyPainter.prototype.CheckCanDo=function(d){var c={expand:false,display:false,scan:true,open:false,img1:"",img2:"",html:"",ctxt:false,typename:"",execute:false};var b=d._kind;if(b==null){b=""}if(b.indexOf("ROOT.")==0){c.typename=b.slice(5)}c.expand=("_more" in d);if(d===this.h){c.ctxt=true}if(b=="ROOT.Session"){c.img1="img_globe"}else{if(b=="JSROOT.TopFolder"){c.img1="img_base"}else{if(b=="Command"){c.ctxt=true;c.execute=true;c.img1="img_execute"}else{if(b=="Text"){c.ctxt=true;c.display=true;c.img1="img_text"}else{if(b.match(/^ROOT.TH1/)){c.img1="img_histo1d";c.scan=false;c.display=true}else{if(b.match(/^ROOT.TH2/)){c.img1="img_histo2d";c.scan=false;c.display=true}else{if(b.match(/^ROOT.TH3/)){c.img1="img_histo3d";c.scan=false;c.display=true}else{if(b=="ROOT.TCanvas"){c.img1="img_canvas";c.display=true}else{if(b=="ROOT.TProfile"){c.img1="img_profile";c.display=true}else{if(b.match(/^ROOT.TGraph/)||(b=="TCutG")){c.img1="img_graph";c.display=true}else{if(b=="ROOT.TF1"){c.img1="img_graph";c.display=true}else{if(b=="ROOT.TTree"){c.img1="img_tree"}else{if((b=="ROOT.TFile")||(b=="ROOT.TMemFile")){c.img1="img_file"}else{if(b=="ROOT.TFolder"){c.img1="img_folder";c.img2="img_folderopen"}else{if(b=="ROOT.TNtuple"){c.img1="img_tree"}else{if(b=="ROOT.TBranch"){c.img1="img_branch"}else{if(b.match(/^ROOT.TLeaf/)){c.img1="img_leaf"}else{if(b=="ROOT.TStreamerInfoList"){c.img1="img_question";c.expand=false;c.display=true}else{if((c.typename!="")&&JSROOT.canDraw(c.typename)){c.img1="img_histo1d";c.scan=false;c.display=true}else{if(JSROOT.canDraw("kind:"+b)){c.img1="img_leaf";c.scan=false;c.display=true}}}}}}}}}}}}}}}}}}}}if((c.img1.length==0)&&("_online" in d)){c.img1="img_globe"}if("_player" in d){c.display=true}if("_icon" in d){c.img1=d._icon}if("_icon2" in d){c.img2=d._icon2}return c};JSROOT.HierarchyPainter.prototype.FindFastCommands=function(){var b=[];this.ForEach(function(c){if(("_fastcmd" in c)&&(c._kind=="Command")){b.push(c)}});return b.length>0?b:null};JSROOT.HierarchyPainter.prototype.ExecuteCommand=function(f,e){var c=this.Find(f);var b=f+"/cmd.json";if((e!=null)&&(typeof e=="object")){e.css("background","yellow");if(c&&c._title){e.attr("title","Executing "+c._title)}}var d=JSROOT.NewHttpRequest(b,"text",function(h){if(typeof e=="function"){return e(h)}if((e!=null)&&(typeof e=="object")){var g=((h!=null)&&(h!="false"))?"green":"red";if(c&&c._title){e.attr("title",c._title+" lastres="+h)}e.animate({backgroundColor:g},2000,function(){e.css("background","")})}});d.send()};JSROOT.HierarchyPainter.prototype.RefreshHtml=function(c){if(this.frameid==null){return JSROOT.CallBack(c)}var b=this;JSROOT.AssertPrerequisites("jq2d",function(){b.RefreshHtml(c)})};JSROOT.HierarchyPainter.prototype.toggle=function(c){var b=this;var d=function(e){if(e!=b.h){if(c){e._isopen=true}else{delete e._isopen}}if("_childs" in e){for(var f in e._childs){d(e._childs[f])}}};d(this.h);this.RefreshHtml()};JSROOT.HierarchyPainter.prototype.get=function(h,g,c){var e=this.Find(h);if(e==null){var d=this.Find({name:h,last_exists:true});while(d!=null){if("_get" in d){var b=this.itemFullName(d);if(b.length>0){h=h.substr(b.length+1)}break}if(!("_parent" in d)){d=null;break}d=d._parent}if(d==null){d=this.h}if("_get" in d){return d._get(null,h,g)}}var f=e;while(f!=null){if(("_get" in f)&&(typeof(f._get)=="function")){return f._get(e,null,g)}f=("_parent" in f)?f._parent:null}JSROOT.CallBack(g,e,null)};JSROOT.HierarchyPainter.prototype.draw=function(d,c,b){return JSROOT.draw(d,c,b)};JSROOT.HierarchyPainter.prototype.player=function(g,c,f){var d=this.Find(g);if(!d||!("_player" in d)){return JSROOT.CallBack(f,null)}var e=this;var b=("_prereq" in d)?d._prereq:"";JSROOT.AssertPrerequisites(b,function(){var h=JSROOT.findFunction(d._player);if(h==null){return JSROOT.CallBack(f,null)}e.CreateDisplay(function(j){var i=null;if(j){i=h(e,g,c)}JSROOT.CallBack(f,i)})})};JSROOT.HierarchyPainter.prototype.display=function(e,b,d){var c=this;c.CreateDisplay(function(i){if(!i){return JSROOT.CallBack(d,null,e)}var f=(b=="update");var h=c.Find(e);if(h!=null){var g=c.CheckCanDo(h);if(!g.display||("_player" in h)){return c.player(e,b,function(){JSROOT.CallBack(d,null,e)})}}if(f){if((h==null)||("_doing_update" in h)){return JSROOT.CallBack(d,null,e)}h._doing_update=true}c.get(e,function(k,l){if(f&&k){delete k._doing_update}if(l==null){return JSROOT.CallBack(d,null,e)}var j=null;var o=b?b.indexOf("divid:"):-1;if(o>=0){var n=b.slice(o+6);b=b.slice(0,o);j=c.draw(n,l,b)}else{i.ForEachPainter(function(q,r){if(q.GetItemName()!=e){return}j=q;i.ActivateFrame(r);j.RedrawObject(l)})}if(j==null){if(f){console.log("something went wrong - did not found painter when doing update of "+e)}else{var m=i.FindFrame(e,true);j=c.draw(d3.select(m).attr("id"),l,b);i.ActivateFrame(m);c.enable_dropping(m,e)}}if(j){j.SetItemName(e)}JSROOT.CallBack(d,j,e)})})};JSROOT.HierarchyPainter.prototype.enable_dropping=function(b,c){};JSROOT.HierarchyPainter.prototype.dropitem=function(f,e,c){var b=this;var d=b.disp;b.get(f,function(h,i){if(i!=null){var g=b.draw(e,i,"same");if(g){g.SetItemName(f)}}JSROOT.CallBack(c)});return true};JSROOT.HierarchyPainter.prototype.updateAll=function(){var e=this["disp"];if(e==null){return}var d=[],c=[];e.ForEachPainter(function(f){if((f.GetItemName()!=null)&&(d.indexOf(f.GetItemName())<0)){d.push(f.GetItemName());c.push("update")}},true);var b=this;if(this.files_monitoring){this.ForEachRootFile(function(f){b.ForEach(function(g){delete g._readobj},f);delete f._file})}this.displayAll(d,c)};JSROOT.HierarchyPainter.prototype.displayAll=function(b,c,e){if((b==null)||(b.length==0)){return JSROOT.CallBack(e)}var d=this;d.CreateDisplay(function(l){if(!l){return JSROOT.CallBack(e)}if(c==null){c=[]}while(c.length<b.length){c.push("")}var h=new Array(b.length);for(var g in b){h[g]=null;if(d.Find(b[g])){continue}if(d.Find(b[g]+";1")){b[g]+=";1";continue}var k=b[g].indexOf("+");if(k>0){h[g]=b[g].split("+");b[g]=h[g].shift();for(var f in h[g]){var k=h[g][f].indexOf("_same_");if((k>0)&&(d.Find(h[g][f])==null)){h[g][f]=h[g][f].substr(0,k)+b[g].substr(k)}}}var k=b[g].indexOf("_same_");if((k>0)&&!d.Find(b[g])&&(g>0)){b[g]=b[g].substr(0,k)+b[0].substr(k)}}for(var g in b){if(c[g]!="update"){l.CreateFrame(b[g])}}for(var g in b){d.display(b[g],c[g],function(i,n){var m=b.indexOf(n);if(m<0){return console.log("did not found item "+n)}b[m]="---";function j(){if((i!=null)&&(h[m]!=null)&&(h[m].length>0)){return d.dropitem(h[m].shift(),i.divid,j)}var p=false;for(var o in b){if(b[o]!="---"){p=true}}if(!p){JSROOT.CallBack(e)}}j()})}})};JSROOT.HierarchyPainter.prototype.reload=function(){if("_online" in this.h){this.OpenOnline(this.h._online)}};JSROOT.HierarchyPainter.prototype.expand=function(b){alert("expand "+b+" can be used only jquery part loaded")};JSROOT.HierarchyPainter.prototype.GetTopOnlineItem=function(){if(this.h==null){return null}if("_online" in this.h){return this.h}if((this.h._childs!=null)&&("_online" in this.h._childs[0])){return this.h._childs[0]}return null};JSROOT.HierarchyPainter.prototype.ForEachRootFile=function(c){if(this.h==null){return}if((this.h._kind=="ROOT.TFile")&&(this.h._file!=null)){return JSROOT.CallBack(c,this.h)}if(this.h._childs!=null){for(var d in this.h._childs){var b=this.h._childs[d];if((b._kind=="ROOT.TFile")&&("_fullurl" in b)){JSROOT.CallBack(c,b)}}}};JSROOT.HierarchyPainter.prototype.OpenRootFile=function(e,d){var c=false;this.ForEachRootFile(function(f){if(f._fullurl==e){c=true}});if(c){return JSROOT.CallBack(d)}var b=this;JSROOT.AssertPrerequisites("io",function(){new JSROOT.TFile(e,function(h){if(h==null){return JSROOT.CallBack(d)}var g=b.FileHierarchy(h);g._isopen=true;if(b.h==null){b.h=g}else{if(b.h._kind=="JSROOT.TopFolder"){b.h._childs.push(g)}else{var i=b.h;var f=(i._kind=="ROOT.TFile")?"Files":"Items";b.h={_name:f,_kind:"JSROOT.TopFolder",_childs:[i,g]}}}b.RefreshHtml(d)})})};JSROOT.HierarchyPainter.prototype.GetFileProp=function(d){var b=this.Find(d);if(b==null){return null}var c=b._name;while(b._parent!=null){b=b._parent;if("_file" in b){return{fileurl:b._file.fURL,itemname:c}}c=b._name+"/"+c}return null};JSROOT.HierarchyPainter.prototype.CompleteOnline=function(b){return JSROOT.CallBack(b)};JSROOT.HierarchyPainter.prototype.GetOnlineItem=function(f,i,h){var c=i,b=false,e="root.json.gz?compact=3";if(f!=null){var g=f;while((g!=null)&&(!("_online" in g))){g=g._parent}c=this.itemFullName(f,g);if("_doing_expand" in f){b=true;e="h.json?compact=3"}else{if(f._kind.indexOf("ROOT.")!=0){e="get.json.gz?compact=3"}}}if(c.length>0){c+="/"}c+=e;var d=JSROOT.NewHttpRequest(c,"object",function(j){if((f!=null)&&(j!=null)&&!b&&(f._name==="StreamerInfo")&&(j._typename==="TList")){j._typename="TStreamerInfoList"}JSROOT.CallBack(h,f,j)});d.send(null)};JSROOT.HierarchyPainter.prototype.OpenOnline=function(d,f){var b=this;var g=function(h){b.h=h;if(b.h==null){return}h._isopen=true;b.h._online=d;b.h._get=function(i,k,j){b.GetOnlineItem(i,k,j)};b.h._expand=function(i,j){if((j!=null)&&(i!=null)&&("_childs" in j)){i._childs=j._childs;j._childs=null;return true}return false};b.CompleteOnline(function(){b.RefreshHtml(function(){JSROOT.CallBack(f,b)})})};if(!d){d=""}if(typeof d=="object"){var c=d;d="";g(c);return}var e=JSROOT.NewHttpRequest(d+"h.json?compact=3","object",g);e.send(null)};JSROOT.HierarchyPainter.prototype.GetOnlineProp=function(d){var b=this.Find(d);if(b==null){return null}var c=b._name;while(b._parent!=null){b=b._parent;if("_online" in b){return{server:b._online,itemname:c}}c=b._name+"/"+c}return null};JSROOT.HierarchyPainter.prototype.FillOnlineMenu=function(c,h,g){var j=this;var d=this.Find(g);var f=this.CheckCanDo(d);var b=JSROOT.getDrawOptions(f.typename,"nosame");if(f.display){c.addDrawMenu("Draw",b,function(k){j.display(g,k)})}if(f.expand||f.display){c.add("Expand",function(){j.expand(g)})}if(f.execute){c.add("Execute",function(){j.ExecuteCommand(g,c.tree_node)})}var i=h.server+h.itemname+"/draw.htm";var e="?";if(this.IsMonitoring()){i+=e+"monitoring="+this.MonitoringInterval();e="&"}if(f.display){c.addDrawMenu("Draw in new window",b,function(k){window.open(i+e+"opt="+k)})}if(f.display){c.add("Draw as png",function(){window.open(h.server+h.itemname+"/root.png?w=400&h=300&opt=")})}if("_player" in d){c.add("Player",function(){j.player(g)})}};JSROOT.HierarchyPainter.prototype.ShowStreamerInfo=function(b){this.h={_name:"StreamerInfo"};this.StreamerInfoHierarchy(this.h,b);this.RefreshHtml()};JSROOT.HierarchyPainter.prototype.Adopt=function(b){this.h=b;this.RefreshHtml()};JSROOT.HierarchyPainter.prototype.SetMonitoring=function(b){this["_monitoring_on"]=false;this["_monitoring_interval"]=3000;if((b!=null)&&(b!="0")){this["_monitoring_on"]=true;this["_monitoring_interval"]=parseInt(b);if((this["_monitoring_interval"]==NaN)||(this["_monitoring_interval"]<100)){this["_monitoring_interval"]=3000}}};JSROOT.HierarchyPainter.prototype.MonitoringInterval=function(b){return("_monitoring_interval" in this)?this["_monitoring_interval"]:3000};JSROOT.HierarchyPainter.prototype.EnableMonitoring=function(b){this["_monitoring_on"]=b};JSROOT.HierarchyPainter.prototype.IsMonitoring=function(){return this["_monitoring_on"]};JSROOT.HierarchyPainter.prototype.SetDisplay=function(c,b){this["disp_kind"]=c;this["disp_frameid"]=b};JSROOT.HierarchyPainter.prototype.clear=function(b){if("disp" in this){this["disp"].Reset();delete this["disp"]}if(b){d3.select("#"+this.frameid).html("");delete this.h}};JSROOT.HierarchyPainter.prototype.GetDisplay=function(){return("disp" in this)?this["disp"]:null};JSROOT.HierarchyPainter.prototype.CreateDisplay=function(c){var b=this;if("disp" in this){if(b.disp.NumDraw()>0){return JSROOT.CallBack(c,b.disp)}b.disp.Reset();delete b.disp}if(document.getElementById(this["disp_frameid"])==null){return JSROOT.CallBack(c,null)}if(b.disp_kind=="simple"){b.disp=new JSROOT.SimpleDisplay(b.disp_frameid)}else{if(b.disp_kind.search("grid")==0){b.disp=new JSROOT.GridDisplay(b.disp_frameid,b.disp_kind)}}if(b.disp!=null){JSROOT.CallBack(c,b.disp)}else{JSROOT.AssertPrerequisites("jq2d",function(){b.CreateDisplay(c)})}};JSROOT.HierarchyPainter.prototype.CheckResize=function(b){if("disp" in this){this["disp"].CheckResize()}};JSROOT.HierarchyPainter.prototype.StartGUI=function(m,g){var f=this;var h=JSROOT.GetUrlOptionAsArray("file;files");var e=JSROOT.GetUrlOption("path");if(e!=null){for(var j in h){h[j]=e+h[j]}}var b=JSROOT.GetUrlOptionAsArray("item;items");var d=JSROOT.GetUrlOptionAsArray("opt;opts");var n=JSROOT.GetUrlOption("monitoring");var k=JSROOT.GetUrlOption("layout");if(!this["disp_kind"]||(k!=null)){this["disp_kind"]=(k&&k.length>0)?k:"simple"}if(JSROOT.GetUrlOption("files_monitoring")!=null){this.files_monitoring=true}JSROOT.RegisterForResize(this);this.SetMonitoring(n);function l(){if(h.length>0){f.OpenRootFile(h.shift(),l)}else{f.displayAll(b,d,function(){f.RefreshHtml();JSROOT.RegisterForResize(f);setInterval(function(){if(f.IsMonitoring()){f.updateAll()}},f.MonitoringInterval());JSROOT.CallBack(g)})}}function c(){if(("_monitoring" in f.h)&&(n==null)){f.SetMonitoring(f.h._monitoring)}if(("_layout" in f.h)&&(k==null)){f.disp_kind=f.h._layout}if(("_loadfile" in f.h)&&(h.length==0)){h=JSROOT.ParseAsArray(f.h._loadfile)}if(("_drawitem" in f.h)&&(b.length==0)){b=JSROOT.ParseAsArray(f.h._drawitem);d=JSROOT.ParseAsArray(f.h._drawopt)}l()}if(m!=null){f.OpenOnline(m,c)}else{l()}};JSROOT.BuildNobrowserGUI=function(){var b=d3.select("#simpleGUI");var c=false;if(b.empty()){b=d3.select("#onlineGUI");if(b.empty()){return alert("no div for simple nobrowser gui found")}c=true}JSROOT.Painter.readStyleFromURL();d3.select("html").style("height","100%");d3.select("body").style({"min-height":"100%",margin:"0px",overflow:"hidden"});b.style({position:"absolute",left:"1px",top:"1px",bottom:"1px",right:"1px"});var f=new JSROOT.HierarchyPainter("root",null);f.SetDisplay("simple",b.attr("id"));var d=null;if(c){var e=JSROOT.findFunction("GetCachedHierarchy");if(typeof e=="function"){d=e()}if(typeof d!="object"){d=""}}f.StartGUI(d,function(){})};JSROOT.MDIDisplay=function(b){this.frameid=b;d3.select("#"+this.frameid).property("mdi",this)};JSROOT.MDIDisplay.prototype.ForEachFrame=function(b,c){alert("ForEachFrame not implemented")};JSROOT.MDIDisplay.prototype.ForEachPainter=function(b,c){this.ForEachFrame(function(e){var d=new JSROOT.TObjectPainter();d.SetDivId(d3.select(e).attr("id"),-1);d.ForEachPainter(function(f){b(f,e)})},c)};JSROOT.MDIDisplay.prototype.NumDraw=function(){var b=0;this.ForEachFrame(function(){b++});return b};JSROOT.MDIDisplay.prototype.FindFrame=function(c,d){var b=null;this.ForEachFrame(function(e){if(d3.select(e).attr("title")==c){b=e}});if((b==null)&&d){b=this.CreateFrame(c)}return b};JSROOT.MDIDisplay.prototype.ActivateFrame=function(b){};JSROOT.MDIDisplay.prototype.CheckResize=function(){var b=null;this.ForEachPainter(function(c,d){if((c.GetItemName()!=null)&&(typeof c.CheckResize=="function")){if(b===d){return}c.CheckResize();b=d}})};JSROOT.MDIDisplay.prototype.Reset=function(){this.ForEachPainter(function(b){if((b.GetItemName()!=null)&&(typeof b.Clenaup=="function")){b.Clenaup()}});d3.select("#"+this.frameid).html("").property("mdi",null)};JSROOT.MDIDisplay.prototype.Draw=function(e,c,b){if(!c){return}if(!JSROOT.canDraw(c._typename,b)){return}var d=this.FindFrame(e,true);this.ActivateFrame(d);return JSROOT.redraw(d3.select(d).attr("id"),c,b)};JSROOT.SimpleDisplay=function(b){JSROOT.MDIDisplay.call(this,b)};JSROOT.SimpleDisplay.prototype=Object.create(JSROOT.MDIDisplay.prototype);JSROOT.SimpleDisplay.prototype.ForEachFrame=function(b,d){var c=d3.select("#"+this.frameid);if(!c.empty()&&c.property("title")!=""){JSROOT.CallBack(b,c.node())}};JSROOT.SimpleDisplay.prototype.CreateFrame=function(b){return d3.select("#"+this.frameid).html("").property("title",b).node()};JSROOT.SimpleDisplay.prototype.Reset=function(){JSROOT.MDIDisplay.prototype.Reset.call(this);d3.select("#"+this.frameid).property("title","").style("background","").classed({"ui-droppable":false,"ui-state-default":false})};JSROOT.GridDisplay=function(d,c,b){JSROOT.MDIDisplay.call(this,d);this.cnt=0;if(typeof c=="string"){if(c.search("grid")==0){c=c.slice(4).trim()}var e=c.search("x");if(e>0){b=parseInt(c.slice(e+1));c=parseInt(c.slice(0,e))}else{c=parseInt(c);b=c}if(c==NaN){c=3}if(b==NaN){b=3}}if(!c){c=3}if(!b){b=c}this.sizex=c;this.sizey=b};JSROOT.GridDisplay.prototype=Object.create(JSROOT.MDIDisplay.prototype);JSROOT.GridDisplay.prototype.IsSingle=function(){return(this.sizex==1)&&(this.sizey==1)};JSROOT.GridDisplay.prototype.ForEachFrame=function(b,e){for(var c=0;c<this.sizex*this.sizey;c++){var d=this.IsSingle()?d3.select("#"+this.frameid):d3.select("#"+this.frameid+"_grid_"+c);if(!d.empty()&&d.property("title")!=""){JSROOT.CallBack(b,d.node())}}};JSROOT.GridDisplay.prototype.CreateFrame=function(m){var c=d3.select("#"+this.frameid);if(c.empty()){return null}if(!this.IsSingle()){var f=this.frameid+"_grid";if(d3.select("#"+f).empty()){var l=c.node().getBoundingClientRect();var g=Math.floor(l.height/this.sizey)-1;var n=Math.floor(l.width/this.sizex)-1;var k="<div style='width:100%; height:100%; margin:0; padding:0; border:0; overflow:hidden'>";k+="<table id='"+f+"' style='width:100%; height:100%; table-layout:fixed; border-collapse: collapse;'>";var b=0;for(var e=0;e<this.sizey;e++){k+="<tr>";for(var d=0;d<this.sizex;d++){k+="<td><div id='"+f+"_"+b+++"' class='grid_cell'></div></td>"}k+="</tr>"}k+="</table></div>";c.html(k);c.selectAll(".grid_cell").style({width:n+"px",height:g+"px"})}c=d3.select("#"+f+"_"+this.cnt);if(++this.cnt>=this.sizex*this.sizey){this.cnt=0}}return c.html("").property("title",m).node()};JSROOT.GridDisplay.prototype.Reset=function(){JSROOT.MDIDisplay.prototype.Reset.call(this);if(this.IsSingle()){d3.select("#"+this.frameid).property("title",null)}this.cnt=0};JSROOT.GridDisplay.prototype.CheckResize=function(){if(!this.IsSingle()){var b=d3.select("#"+this.frameid);var e=b.node().getBoundingClientRect();var d=Math.floor(e.height/this.sizey)-1;var c=Math.floor(e.width/this.sizex)-1;b.selectAll(".grid_cell").style({width:c+"px",height:d+"px"})}JSROOT.MDIDisplay.prototype.CheckResize.call(this)};JSROOT.RegisterForResize=function(e,c){var f=null;var h=-1;var b=c?c/2.5:100;if(b<20){b=20}function d(){if(h<0){return}h+=1;if(h<3){return}if(f!=null){clearInterval(f);f=null}h=-1;if(e==null){return}document.body.style.cursor="wait";if(typeof e=="function"){e()}else{if((typeof e=="object")&&(typeof e.CheckResize=="function")){e.CheckResize()}else{if(typeof e=="string"){var i=d3.select("#"+e);if(!i.empty()){var l=i.property("mdi");if(l){l.CheckResize()}else{var j=new JSROOT.TObjectPainter();var k=true;j.SetDivId(e,-1);j.ForEachPainter(function(m){if(k&&(typeof m.CheckResize=="function")){k=false;m.CheckResize()}})}}}}}document.body.style.cursor="auto"}function g(){if(f==null){f=setInterval(d,b)}h=0}window.addEventListener("resize",g)};JSROOT.addDrawFunc("TCanvas",JSROOT.Painter.drawCanvas);JSROOT.addDrawFunc("TPad",JSROOT.Painter.drawPad);JSROOT.addDrawFunc("TFrame",JSROOT.Painter.drawFrame);JSROOT.addDrawFunc("TLegend",JSROOT.Painter.drawLegend);JSROOT.addDrawFunc("TPaveText",JSROOT.Painter.drawPaveText);JSROOT.addDrawFunc("TPaveStats",JSROOT.Painter.drawPaveText);JSROOT.addDrawFunc("TLatex",JSROOT.Painter.drawText);JSROOT.addDrawFunc("TMathText",JSROOT.Painter.drawText);JSROOT.addDrawFunc("TText",JSROOT.Painter.drawText);JSROOT.addDrawFunc("TPaveLabel",JSROOT.Painter.drawText);JSROOT.addDrawFunc(/^TH1/,JSROOT.Painter.drawHistogram1D,";P;P0;same");JSROOT.addDrawFunc("TProfile",JSROOT.Painter.drawHistogram1D,";E1");JSROOT.addDrawFunc(/^TH2/,JSROOT.Painter.drawHistogram2D,";COL;COLZ;COL3;LEGO;same");JSROOT.addDrawFunc(/^TH3/,JSROOT.Painter.drawHistogram3D);JSROOT.addDrawFunc("THStack",JSROOT.Painter.drawHStack);JSROOT.addDrawFunc("TF1",JSROOT.Painter.drawFunction);JSROOT.addDrawFunc(/^TGraph/,JSROOT.Painter.drawGraph,";L;P");JSROOT.addDrawFunc("TCutG",JSROOT.Painter.drawGraph,";L;P");JSROOT.addDrawFunc(/^RooHist/,JSROOT.Painter.drawGraph,";L;P");JSROOT.addDrawFunc(/^RooCurve/,JSROOT.Painter.drawGraph,";L;P");JSROOT.addDrawFunc("TMultiGraph",JSROOT.Painter.drawMultiGraph);JSROOT.addDrawFunc("TStreamerInfoList",JSROOT.Painter.drawStreamerInfo);JSROOT.addDrawFunc("kind:Text",JSROOT.Painter.drawRawText);JSROOT.getDrawFunc=function(g,c){if(typeof g!="string"){return null}var f=null;for(var d in JSROOT.fDrawFunc){if((typeof JSROOT.fDrawFunc[d].name)==="string"){if(JSROOT.fDrawFunc[d].name!=g){continue}}else{if(!g.match(JSROOT.fDrawFunc[d].name)){continue}}if(f==null){f=JSROOT.fDrawFunc[d].func}if((typeof c=="string")&&(c!="")){if(JSROOT.fDrawFunc[d].opt==null){continue}var e=JSROOT.fDrawFunc[d].opt.split(";");for(var b in e){e[b]=e[b].toLowerCase()}if(e.indexOf(c.toLowerCase())<0){continue}}return JSROOT.fDrawFunc[d].func}return f};JSROOT.getDrawOptions=function(g,b){if((typeof g!="string")||(g=="")){return null}var f=null,e=false;for(var c in JSROOT.fDrawFunc){if((typeof JSROOT.fDrawFunc[c].name)==="string"){if(JSROOT.fDrawFunc[c].name!=g){continue}}else{if(!g.match(JSROOT.fDrawFunc[c].name)){continue}}e=true;if(JSROOT.fDrawFunc[c].opt==null){continue}var d=JSROOT.fDrawFunc[c].opt.split(";");for(var c in d){d[c]=d[c].toLowerCase();if((b=="nosame")&&(d[c].indexOf("same")==0)){continue}if(f==null){f=new Array}if(f.indexOf(d[c])<0){f.push(d[c])}}}if(e&&(f==null)){f=new Array;f.push("")}return f};JSROOT.canDraw=function(b){return JSROOT.getDrawFunc(b)!=null};JSROOT.draw=function(e,d,b){if(typeof d!="object"){return null}var c=null;if("_typename" in d){c=JSROOT.getDrawFunc(d._typename,b)}else{if("_kind" in d){c=JSROOT.getDrawFunc("kind:"+d._kind,b)}}if(c==null){return null}return c(e,d,b)};JSROOT.redraw=function(h,f,d){if(f==null){return}var e=d3.select("#"+h+" .root_canvas");var b=e.empty()?null:e.property("pad_painter");if(b!=null){if(f._typename=="TCanvas"){b.RedrawObject(f);return b}for(var c in b.painters){var g=b.painters[c].GetObject();if((g!=null)&&(g._typename==f._typename)){if(b.painters[c].UpdateObject(f)){b.RedrawPad();return b.painters[c]}}}}if(b){console.log("Cannot find painter to update object of type "+f._typename)}d3.select("#"+h).html("");return JSROOT.draw(h,f,d)}})();